<!DOCTYPE html>
<!-- saved from url=(0036)https://betaxis.com.br/padrao2o.html -->
<html lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador de Padr√µes - Betaxis</title>

  <script async="" src="./Buscador de Padr√µes - Betaxis_files/js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZWM48YPVNL');
  </script>

  <style>
    :root{
      --primary-color:#2a2e35;--secondary-color:#3a3f47;--accent-color:#00ff88;--text-color:#e0e0e0;
      --table-header:#3a3f47;--cell-green:#1f8f3a;--cell-red:#b43232;--cell-grey:#5a5f67;--cell-neutral:#3a3f47;
      --cell-compact: 0;
    }
    body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(45deg,#1a1e23,#2a2e35);color:var(--text-color);margin:0;padding:20px;min-height:100vh}
    .container{max-width:1400px;margin:0 auto}
    h1,h2{color:var(--accent-color);margin:1.2rem 0;text-align:center;text-transform:uppercase;letter-spacing:1px}

    .filters{background:var(--primary-color);padding:1.2rem;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.3);margin-bottom:1.2rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
    label{display:block;margin-bottom:.5rem;color:var(--accent-color);font-weight:500}
    select,input[type="text"]{width:100%;padding:.8rem;border:2px solid var(--secondary-color);border-radius:8px;background:var(--primary-color);color:var(--text-color)}
    select:hover,input[type="text"]{border-color:var(--accent-color)}

    table{width:100%;border-collapse:collapse;background:var(--primary-color);border-radius:12px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.3);margin-bottom:1.4rem}
    th,td{padding:.6rem;text-align:left;vertical-align:middle;font-size:.85rem}
    th{background:var(--table-header);color:var(--accent-color);font-weight:600;text-transform:uppercase;font-size:.85em;letter-spacing:.4px;position:sticky;top:0}
    tr{border-bottom:1px solid var(--secondary-color)}
    tr:last-child{border-bottom:none}
    tr:hover{background:var(--secondary-color)}
    #status-atualizacao{background:var(--primary-color);color:var(--accent-color);padding:.6rem;border-radius:8px;margin:.6rem 0;text-align:center;font-weight:bold;display:none}

    .custom-button{width:100%;padding:.5rem;border:1px solid var(--secondary-color);border-radius:8px;background:var(--primary-color);color:var(--text-color);cursor:pointer}
    .custom-button:hover{border-color:var(--accent-color)}

    .mosaic,.recent-bar{display:inline-flex;gap:6px;flex-wrap:wrap}
    .recent-wrap{display:flex;flex-direction:column;align-items:center;margin:-2px 0 10px}
    .recent-caption{font-size:.85rem;opacity:.8;margin-bottom:4px}

    .cell{
      min-width:64px;min-height:18px;
      padding:6px 8px;display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:.9rem;color:#fff;border-radius:8px;user-select:none;
      flex-direction:column; line-height:1.1; gap:2px;
    }
    .cell-green{background:var(--cell-green)}
    .cell-red{background:var(--cell-red)}
    .cell-grey{background:var(--cell-grey);color:#e5e5e5}
    .cell-neutral{background:var(--cell-neutral)}
    .cell .team{font-size:.75rem;font-weight:600;opacity:.95;white-space:nowrap;text-overflow:ellipsis;max-width:120px;overflow:hidden}
    .cell .score{font-size:.9rem;font-weight:800}

    .sortable{cursor:pointer}
    .sortable:after{content:" ‚ü∑";color:#aaa}
    .sortable.asc:after{content:" ‚Üë"}
    .sortable.desc:after{content:" ‚Üì"}

    .row-colored{ --hit: #38bdf8; border-left:6px solid var(--hit); }
    .row-active{ outline:2px solid var(--hit); }
    .cell-hit{ position:relative; }
    .cell-hit::after{
      content:""; position:absolute; inset:-3px; border-radius:10px;
      box-shadow:0 0 0 3px var(--hit), 0 0 10px var(--hit);
      pointer-events:none;
    }
    .recent-bar.focus .cell{ opacity:.25; filter:grayscale(.6); }
    .recent-bar.focus .cell.cell-focus{ opacity:1; filter:none; }
    .recent-bar.focus .cell.cell-focus.cell-hit::after{
      box-shadow:0 0 0 3px var(--hit), 0 0 14px var(--hit);
    }

    @media (max-width:768px){
      .filters{grid-template-columns:1fr}
      .cell{min-width:58px;font-size:.85rem}
    }

    .cell .time{ font-size:.68rem;font-weight:600;opacity:.85;line-height:1;}

    .recent-bar{ display:inline-flex; gap:6px; flex-wrap:wrap-reverse; align-content:flex-start; }
    .recent-bar .breaker{ flex-basis:100%; height:0; padding:0; margin:0; }

    .tables-3col{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:12px; align-items:start; margin-top:8px; }
    .market-caption{ text-align:center; margin-bottom:6px; font-weight:700; color:var(--accent-color); }

    .future-bar .score{ font-size:.85rem; padding:0 4px; border-radius:6px; background:rgba(0,0,0,.25); margin:1px 0; }

    .kickoff-badge {
      position: absolute;
      left: 6px;
      bottom: 6px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      line-height: 1;
      background: transparent;
      color: #fff;
      font-weight: 600;
      pointer-events: none;
      user-select: none;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
      z-index: 3;
    }
    .future-bar .cell {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
      gap: 2px;
      padding-right: 6px;
    }
    .future-bar .entry-badge{
      position: relative;
      display: block;
      font-size: .85rem;
      font-weight: 700;
      padding: 0 4px;
      border-radius: 6px;
      pointer-events: auto;
    }

    /* ==== Overlay "Calculando..." ==== */
    .busy {
      position: fixed; inset: 0;
      display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.35); z-index: 9999; backdrop-filter: blur(1px);
    }
    .busy .box {
      display:flex; align-items:center; gap:10px;
      background:#2a2e35; color:#fff; padding:14px 18px;
      border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.4);
      font-weight:700;
    }
    .spinner {
      width:16px; height:16px;
      border:3px solid rgba(255,255,255,.25);
      border-top-color: var(--accent-color);
      border-radius:50%; animation: spin .8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body inject_vt_svd="true">
<div class="container">
  <h1>üìä Buscador de Padr√µes - Betaxis</h1>

  <div class="filters">
    <!-- üîÅ Mercados -->
    <div>
      <label for="mercado1">Mercado 1 (cor dos recentes):</label>
      <select id="mercado1">
        <option value="over3.5">Over 3.5</option>
        <option value="over2.5" selected="">Over 2.5</option>
        <option value="over1.5">Over 1.5</option>
        <option value="under1.5">Under 1.5</option>
        <option value="under2.5">Under 2.5</option>
        <option value="under3.5">Under 3.5</option>
        <option value="ambas">Ambas Marcam</option>
        <option value="ambasnao">Ambas n√£o</option>
        <option value="casa">Casa vence</option>
        <option value="empate">Empate</option>
        <option value="fora">Fora vence</option>
        <option value="casa_marca">Casa marca</option>
        <option value="fora_marca">Fora marca</option>
        <option value="gols_0">0 gol</option>
        <option value="gols_1">1 gol</option>
        <option value="gols_2">2 gols</option>
        <option value="gols_3">3 gols</option>
        <option value="gols_4">4 gols</option>
        <option value="gols_5_plus">5+ gols</option>
        <option value="ht_0_0">HT 0-0</option>
        <option value="ht_0_1">HT 0-1</option>
        <option value="ht_1_0">HT 1-0</option>
        <option value="ht_1_1">HT 1-1</option>
        <option value="ht_0_2">HT 0-2</option>
        <option value="ht_2_0">HT 2-0</option>
        <option value="ht_out">HT OUT</option>
      </select>
    </div>
    <div>
      <label for="mercado2">Mercado 2 (opcional):</label>
      <select id="mercado2">
        <option value="" selected="">‚Äî Desativado ‚Äî</option>
        <option value="over3.5">Over 3.5</option>
        <option value="over2.5">Over 2.5</option>
        <option value="over1.5">Over 1.5</option>
        <option value="under1.5">Under 1.5</option>
        <option value="under2.5">Under 2.5</option>
        <option value="under3.5">Under 3.5</option>
        <option value="ambas">Ambas Marcam</option>
        <option value="ambasnao">Ambas n√£o</option>
        <option value="casa">Casa vence</option>
        <option value="empate">Empate</option>
        <option value="fora">Fora vence</option>
        <option value="casa_marca">Casa marca</option>
        <option value="fora_marca">Fora marca</option>
        <option value="gols_0">0 gol</option>
        <option value="gols_1">1 gol</option>
        <option value="gols_2">2 gols</option>
        <option value="gols_3">3 gols</option>
        <option value="gols_4">4 gols</option>
        <option value="gols_5_plus">5+ gols</option>
        <option value="ht_0_0">HT 0-0</option>
        <option value="ht_0_1">HT 0-1</option>
        <option value="ht_1_0">HT 1-0</option>
        <option value="ht_1_1">HT 1-1</option>
        <option value="ht_0_2">HT 0-2</option>
        <option value="ht_2_0">HT 2-0</option>
        <option value="ht_out">HT OUT</option>
      </select>
    </div>
    <div>
      <label for="mercado3">Mercado 3 (opcional):</label>
      <select id="mercado3">
        <option value="" selected="">‚Äî Desativado ‚Äî</option>
        <option value="over3.5">Over 3.5</option>
        <option value="over2.5">Over 2.5</option>
        <option value="over1.5">Over 1.5</option>
        <option value="under1.5">Under 1.5</option>
        <option value="under2.5">Under 2.5</option>
        <option value="under3.5">Under 3.5</option>
        <option value="ambas">Ambas Marcam</option>
        <option value="ambasnao">Ambas n√£o</option>
        <option value="casa">Casa vence</option>
        <option value="empate">Empate</option>
        <option value="fora">Fora vence</option>
        <option value="casa_marca">Casa marca</option>
        <option value="fora_marca">Fora marca</option>
        <option value="gols_0">0 gol</option>
        <option value="gols_1">1 gol</option>
        <option value="gols_2">2 gols</option>
        <option value="gols_3">3 gols</option>
        <option value="gols_4">4 gols</option>
        <option value="gols_5_plus">5+ gols</option>
        <option value="ht_0_0">HT 0-0</option>
        <option value="ht_0_1">HT 0-1</option>
        <option value="ht_1_0">HT 1-0</option>
        <option value="ht_1_1">HT 1-1</option>
        <option value="ht_0_2">HT 0-2</option>
        <option value="ht_2_0">HT 2-0</option>
        <option value="ht_out">HT OUT</option>
      </select>
    </div>

    <div>
      <label for="placar_jogos">Tipo de Padr√£o (auto):</label>
      <select id="placar_jogos">
        <option value="1">1 jogo</option>
        <option value="2">2 jogos (sequencial)</option>
        <option value="3">3 jogos (sequencial)</option>
        <option value="4">4 jogos (n√£o est√° em combinado)</option>
        <option value="1_pula_1">1 Pula 1</option>
        <option value="1_pula_1_pula_1">1 Pula 1 Pula 1</option>
        <option value="combinado" selected="">Combinado (todos)</option>
      </select>
    </div>

    <div>
      <label for="tiros">Tiros:</label>
      <select id="tiros">
        <option value="1">1</option>
        <option value="2" selected="">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </div>

    <div>
      <label for="linhas">N√∫mero de Jogos (linhas):</label>
      <select id="linhas">
        <option value="60">60</option>
        <option value="120" selected="">120</option>
        <option value="180">180</option>
        <option value="240">240</option>
        <option value="480">480</option>
        <option value="960">960 (lento)</option>
        <option value="1440">1440 (muito lento)</option>
        <option value="1920">1920 (pode travar)</option>
      </select>
    </div>

    <div>
      <label for="intervalo_jogos">Intervalo (pular antes dos tiros):</label>
      <select id="intervalo_jogos">
        <option value="mesma_linha" selected="">Mesma Linha (1-10)</option>
        <option value="mesma_linha2">Mesma Linha (11-20)</option>
        <option value="linha_acima">Linha Acima (21-30)</option>
        <option value="2_linhas_acima">2 Linhas Acima (41-50)</option>
        <option value="3_linhas_acima">3 Linhas Acima (61-70)</option>
      </select>
    </div>

    <div>
      <label for="modo-padrao">Composi√ß√£o do Padr√£o:</label>
      <select id="modo-padrao">
        <option value="todos" selected="">Todas as op√ß√µes (default)</option>
        <option value="equipes">Somente equipes</option>
        <option value="mercados">Somente mercados</option>
        <option value="placares">Somente placares</option>
        <option value="placares_equipes">Placares e equipes</option>
        <option value="placares_mercados">Placares e mercados</option>
        <option value="equipes_mercados">Equipes e mercados</option>
      </select>
    </div>

    <div>
      <label>üìä Carregar Dados</label>
      <button id="togglestats" class="custom-button">Carregar Dados</button>
    </div>

    <div class="switch-container">
      <label for="auto-atualizar" style="display:flex;align-items:center;gap:.6rem;">
        <span>Auto-atualizar a cada 3 minuto:</span>
        <input type="checkbox" id="auto-atualizar" checked="">
      </label>
      Pr√≥xima atualiza√ß√£o em: <span id="contador">180</span> segundos
    </div>

    <div>
      <label for="equipes">Equipes (filtro opcional):</label>
      <input id="equipes" type="text" placeholder="Ex.: Barcelona, Real Madrid, Boca">
    </div>

    <div style="grid-column:1/-1;display:flex;flex-wrap:wrap;gap:.8rem;margin-top:.4rem">
      <label><input type="checkbox" value="copares.csv" checked=""> Copa</label>
      <label><input type="checkbox" value="eurores.csv"> Euro</label>
      <label><input type="checkbox" value="premierres.csv"> Premier</label>
      <label><input type="checkbox" value="sulares.csv"> Sula</label>
      <label><input type="checkbox" value="superres.csv"> Champions</label>
      <label><input type="checkbox" value="expressres.csv"> Express</label>
      <label><input type="checkbox" value="CopaAmericabet.csv"> Betano - Copa America</label>
      <label><input type="checkbox" value="Eurobet.csv"> Betano - Euro</label>
      <label><input type="checkbox" value="Brasileiraobet.csv"> Betano - Brasileir√£o</label>
      <label><input type="checkbox" value="Italianobet.csv"> Betano - Italiano</label>
      <label><input type="checkbox" value="kiron-ita.csv"> Kiron - Italiano</label>
      <label><input type="checkbox" value="kiron-eng.csv"> Kiron - Ingl√™s</label>
      <label><input type="checkbox" value="kiron-esp.csv"> Kiron - Espanhol</label>
    </div>
  </div>
</div>

<div id="resultados"></div>

<!-- Overlay de busy -->
<div id="busy" class="busy">
  <div class="box">
    <div class="spinner" aria-hidden="true"></div>
    <span id="busy-text">Calculando os padr√µes‚Ä¶</span>
  </div>
</div>

<script>
/* ===== Estado ===== */
let intervaloAtualizacao, contadorSegundos=180;

const PALETA = ['#38bdf8','#22c55e','#f59e0b','#ef4444','#a78bfa','#14b8a6','#e879f9','#f97316','#84cc16','#06b6d4','#e11d48','#10b981'];

/* ‚òÖ Estado (equipes + modo de padr√£o) */
let equipesFiltro = [];
let modoPadrao = 'todos';
let incPlacares = true, incMercados = true, incEquipes = true;

/* ===== Busy UI ===== */
function showBusy(text='Calculando os padr√µes‚Ä¶'){
  const o=document.getElementById('busy'); if(!o) return;
  const t=o.querySelector('#busy-text'); if(t) t.textContent=text;
  o.style.display='flex';
}
function hideBusy(){ const o=document.getElementById('busy'); if(o) o.style.display='none'; }

function buildFutureBarHTML(count=9){
  const cells = Array.from({length:count}, () =>
    `<span class="cell cell-grey"></span>`
  ).join('');
  return `<div class="recent-caption">Pr√≥ximos ${count}</div>
          <div class="recent-bar future-bar">${cells}</div>`;
}

function reexibir(){
  if(window.ULTIMO_PAC && Array.isArray(window.ULTIMO_PAC)){
    exibirResultados(window.ULTIMO_PAC, !!window.ULTIMO_COMBINADO, window.ULTIMO_ACTIVE_MARKETS || []);
  }
}

/* ===== Cache de arquivos ===== */
window.CACHE_ARQUIVOS = window.CACHE_ARQUIVOS || {};

function detectarProviderPorNome(arquivo){
  if (/kiron-/i.test(arquivo)) return 'kiron';
  if (/bet/i.test(arquivo))    return 'betano';
  return 'other';
}

/* Converte o CSV cru em dados (aplica +1h se betano/kiron) */
function parseCSVRawToDados(rawTexto, arquivo, numLinhas){
  const linhas = rawTexto.split('\n').filter(Boolean).slice(-numLinhas);

  const provider = detectarProviderPorNome(arquivo);
  const offsetMin = PAST_TIME_OFFSET_BY_PROVIDER[provider] || 0;

  const dados=[];
  for(const l of linhas){
    const p=l.trim().split(',');
    if(p.length>=5){
      const a=parseInt(p[1]), b=parseInt(p[2]);
      const mandante=(p[3]||'').trim();
      const visitante=(p[4]||'').trim();
      const htRaw=(p[6]||'').trim();
      if(Number.isFinite(a)&&Number.isFinite(b)){
        let horario = extrairHorarioDeCol0(p[0], arquivo) || (p[7]||'').replace('.', ':');
        if(offsetMin && horario){
          horario = shiftTimeStr(horario, offsetMin);
        }
        const ht = normalizarHT(htRaw);
        dados.push([a,b,a+b, mandante, visitante, horario, ht]);
      }
    }
  }
  return {dados, provider};
}

/* ================== CONFIG ================== */
const LEAGUE_INTERVAL_MIN = {
  express: 1,
  kiron: 2,
  default: 3
};

/* Betano e Kiron: +1 hora nos passados */
const PAST_TIME_OFFSET_BY_PROVIDER = {
  betano: 60,
  kiron:  60,
  other:   0
};

/* ================ HELPERS =================== */
function pad2(n){ return String(n).padStart(2,'0'); }
function isHHMM(s){ return /^\d{1,2}:\d{2}$/.test(String(s||'').trim()); }

function formatHHMM(date){
  return `${pad2(date.getHours())}:${pad2(date.getMinutes())}`;
}
function parseHHMM(hhmm, baseDate = new Date()){
  const [h, m] = hhmm.split(':').map(Number);
  const d = new Date(baseDate);
  d.setSeconds(0,0);
  d.setHours(h, m, 0, 0);
  return d;
}
function addMinutes(date, minutes){
  const d = new Date(date);
  d.setMinutes(d.getMinutes() + minutes);
  return d;
}
function shiftTimeStr(hhmm, minutes){
  if(!isHHMM(hhmm)) return hhmm;
  return formatHHMM(addMinutes(parseHHMM(hhmm), minutes));
}

function adjustPastTimesInDOM(target, provider, getter, setter){
  const offset = PAST_TIME_OFFSET_BY_PROVIDER[provider] ?? 0;
  if (!offset) return;

  const nodes = typeof target === 'string'
    ? document.querySelectorAll(target)
    : (target instanceof Element ? [target] : target);

  const read  = getter || (el => (el.getAttribute('data-time') || el.innerText).trim());
  const write = setter || ((el, v) => {
    if (el.hasAttribute('data-time')) el.setAttribute('data-time', v);
    el.innerText = v;
  });

  nodes.forEach(el => {
    const raw = read(el);
    if (!isHHMM(raw)) return;
    const fixed = shiftTimeStr(raw, offset);
    write(el, fixed);
  });
}

/* PR√ìXIMOS hor√°rios */
function computeNextKickoffTimes(lastKickStr, count, leagueKind = 'default'){
  const step = LEAGUE_INTERVAL_MIN[leagueKind] ?? LEAGUE_INTERVAL_MIN.default;
  const base = parseHHMM(lastKickStr);
  const out = [];
  for (let i=1;i<=count;i++){
    out.push(formatHHMM(addMinutes(base, i*step)));
  }
  return out;
}
function renderKickoffBadges(cardNodes, kickoffHHMM){
  const cards = Array.from(cardNodes);
  cards.forEach((card, idx) => {
    card.querySelectorAll('.kickoff-badge').forEach(n => n.remove());
    const t = kickoffHHMM[idx];
    if (!t) return;
    const badge = document.createElement('div');
    badge.className = 'kickoff-badge';
    badge.textContent = t;
    card.appendChild(badge);
  });
}
function drawUpcomingKickoffTimes(lastKickStr, upcomingCardsSelectorOrNodes, leagueKind='default'){
  const nodes = typeof upcomingCardsSelectorOrNodes === 'string'
    ? document.querySelectorAll(upcomingCardsSelectorOrNodes)
    : upcomingCardsSelectorOrNodes;
  const count = nodes.length;
  const times = computeNextKickoffTimes(lastKickStr, count, leagueKind);
  renderKickoffBadges(nodes, times);
}

function aplicarModoPadrao(){
  incPlacares = (modoPadrao==='placares' || modoPadrao==='placares_equipes' || modoPadrao==='placares_mercados' || modoPadrao==='todos');
  incMercados = (modoPadrao==='mercados' || modoPadrao==='placares_mercados' || modoPadrao==='equipes_mercados' || modoPadrao==='todos');
  incEquipes  = (modoPadrao==='equipes' || modoPadrao==='placares_equipes' || modoPadrao==='equipes_mercados' || modoPadrao==='todos');
}

function getRecentCountByInterval(){
  const v = document.getElementById('intervalo_jogos').value;
  if(v==='mesma_linha') return 20;
  if(v==='mesma_linha2') return 40;
  if(v==='linha_acima') return 40;
  if(v==='2_linhas_acima') return 60;
  if(v==='3_linhas_acima') return 80;
  return 30;
}

/* ===== Util ===== */
function tokensDoJogo(a,b,total, mandante, visitante, ht){
  const t=new Set();

  if(incPlacares){ t.add(`${a}-${b}`); }

  if(incMercados){
    t.add(a>0&&b>0 ? 'ambas' : 'ambasnao');
    t.add(total>=3 ? 'over2.5' : 'under2.5');
    if(total<2) t.add('under1.5');
    if(total>=4) t.add('over3.5');
    if(total<4) t.add('under3.5');
    if(a>b) t.add('casa'); else if(a===b) t.add('empate'); else t.add('fora');
    if(a>0) t.add('casa_marca');
    if(b>0) t.add('fora_marca');
    if(total===0) t.add('0 gol');
    else if(total===1) t.add('1 gol');
    else if(total===2) t.add('2 gols');
    else if(total===3) t.add('3 gols');
    else if(total===4) t.add('4 gols');
    else t.add('5+ gols');

    if(ht){
      if(ht==='0-0') t.add('ht_0_0');
      else if(ht==='0-1') t.add('ht_0_1');
      else if(ht==='1-0') t.add('ht_1_0');
      else if(ht==='1-1') t.add('ht_1_1');
      else if(ht==='0-2') t.add('ht_0_2');
      else if(ht==='2-0') t.add('ht_2_0');
      else if(ht==='OUT') t.add('ht_out');
    }
  }

  if(incEquipes){
    if(mandante) t.add(mandante.toLowerCase());
    if(visitante) t.add(visitante.toLowerCase());
  }
  return Array.from(t);
}

/* GREEN por mercado (inclui HT) */
function isGreenForMarket(m,a,b,total,ht){
  if(m==='ambas') return a>0 && b>0;
  if(m==='ambasnao') return !(a>0 && b>0);
  if(m==='under1.5') return total<2;
  if(m==='under2.5') return total<3;
  if(m==='under3.5') return total<4;
  if(m==='over1.5')  return total>=2;
  if(m==='over2.5')  return total>=3;
  if(m==='over3.5')  return total>=4;
  if(m==='casa')    return a>b;
  if(m==='empate')  return a===b;
  if(m==='fora')    return a<b;
  if(m==='casa_marca') return a>0;
  if(m==='fora_marca') return b>0;
  if(m==='gols_0')       return total===0;
  if(m==='gols_1')       return total===1;
  if(m==='gols_2')       return total===2;
  if(m==='gols_3')       return total===3;
  if(m==='gols_4')       return total===4;
  if(m==='gols_5_plus')  return total>=5;

  if(m==='ht_0_0') return ht==='0-0';
  if(m==='ht_0_1') return ht==='0-1';
  if(m==='ht_1_0') return ht==='1-0';
  if(m==='ht_1_1') return ht==='1-1';
  if(m==='ht_0_2') return ht==='0-2';
  if(m==='ht_2_0') return ht==='2-0';
  if(m==='ht_out') return ht==='OUT';

  return false;
}

function marketLabel(v){
  const M = {
    'ambas':'Ambas marcam','ambasnao':'Ambas n√£o',
    'over1.5':'Over 1.5','over2.5':'Over 2.5','over3.5':'Over 3.5',
    'under1.5':'Under 1.5','under2.5':'Under 2.5','under3.5':'Under 3.5',
    'casa':'Casa vence','empate':'Empate','fora':'Fora vence',
    'casa_marca':'Casa marca','fora_marca':'Fora marca',
    'gols_0':'0 gol','gols_1':'1 gol','gols_2':'2 gols','gols_3':'3 gols','gols_4':'4 gols','gols_5_plus':'5+ gols',
    'ht_0_0':'HT 0-0','ht_0_1':'HT 0-1','ht_1_0':'HT 1-0','ht_1_1':'HT 1-1','ht_0_2':'HT 0-2','ht_2_0':'HT 2-0','ht_out':'HT OUT'
  };
  return v ? (M[v]||v) : 'Desativado';
}

function normalizarHT(s){
  const t = (s||'').replace(/\s/g,'').replace(':','-').toUpperCase();
  const whitelist = new Set(['0-0','0-1','1-0','1-1','0-2','2-0']);
  if(whitelist.has(t)) return t;
  if(!t) return '';
  return 'OUT';
}

/* auto-atualiza√ß√£o */
function iniciarAnalise(){
  carregarDados(true);
  const auto  = document.getElementById('auto-atualizar');
  const status= document.getElementById('status-atualizacao');

  if (intervaloAtualizacao) clearInterval(intervaloAtualizacao);

  if(auto && auto.checked){
    contadorSegundos=180; atualizarContador();
    intervaloAtualizacao=setInterval(atualizarContador,1000);
    if(status) status.style.display='block';
  } else if(status){
    status.style.display='none';
  }
}
function atualizarContador(){
  contadorSegundos--;
  const el=document.getElementById('contador');
  if(el) el.textContent=contadorSegundos;
  if(contadorSegundos<=0){ contadorSegundos=180; carregarDados(true); }
}

/* filtros */
function definirEquipesEModo(){
  const raw = (document.getElementById('equipes')?.value || '').trim();
  equipesFiltro = raw ? raw.split(',').map(s => s.trim().toLowerCase()).filter(Boolean) : [];
  const sel = document.getElementById('modo-padrao');
  modoPadrao = sel ? sel.value : 'todos';
  aplicarModoPadrao();
}

function obterNomeLiga(a){
  if(a.includes("copares"))return"Copa";
  if(a.includes("premierres"))return"Premier";
  if(a.includes("eurores"))return"Euro";
  if(a.includes("sulares"))return"Sula";
  if(a.includes("superres"))return"Champions";
  if(a.includes("expressres"))return"Express";
  if(a.includes("CopaAmericabet"))return"Copa America";
  if(a.includes("Eurobet"))return"Betano Euro";
  if(a.includes("Italianobet"))return"Betano Italiano";
  if(a.includes("Brasileiraobet"))return"Betano Brasileir√£o";
  if(a.includes("kiron-ita"))return"Kiron Italiano";
  if(a.includes("kiron-eng"))return"Kiron Ingl√™s";
  if(a.includes("kiron-esp"))return"Kiron Espanhol";
  return a;
}

/* Download CSV cru */
async function baixarArquivoRaw(arquivo){
  const resp = await fetch(`${arquivo}?t=${Date.now()}`);
  if(!resp.ok){
    throw new Error(`Falha ao baixar ${arquivo}: HTTP ${resp.status}`);
  }
  const raw = await resp.text();
  window.CACHE_ARQUIVOS[arquivo] = {
    raw,
    provider: detectarProviderPorNome(arquivo),
    lastFetched: Date.now()
  };
}

/* Garante cache (ou for√ßa novo download) */
async function garantirCacheArquivo(arquivo, { forceFresh=false } = {}){
  if (forceFresh || !window.CACHE_ARQUIVOS[arquivo]) {
    await baixarArquivoRaw(arquivo);
  }
  return window.CACHE_ARQUIVOS[arquivo];
}

/* LER HOR√ÅRIO CSV */
function extrairHorarioDeCol0(col0, arquivo){
  const raw = (col0 || '').trim();

  if(/copares|eurores|sulares|premierres|superres/i.test(arquivo)){
    const partes = raw.split(' - ');
    if(partes.length > 1){
      return partes[1].replace('.', ':');
    }
  }
  const h = raw.replace('.', ':').match(/\b\d{1,2}:\d{2}\b/);
  return h ? h[0] : '';
}

/* filtro equipes p/ janelas */
function janelaContemEquipe(jogos){
  if(equipesFiltro.length===0) return true;
  for(const j of jogos){
    const m=(j[3]||'').toLowerCase(), v=(j[4]||'').toLowerCase();
    for(const alvo of equipesFiltro){ if(m.includes(alvo)||v.includes(alvo)) return true; }
  }
  return false;
}

/* === (as rotinas pesadas agora v√£o para o Worker) === */

function obterIntervalo(){
  const v=document.getElementById('intervalo_jogos').value;
  if(v==='mesma_linha2') return {inicio:11,fim:20};
  if(v==='linha_acima') return {inicio:21,fim:30};
  if(v==='2_linhas_acima') return {inicio:41,fim:50};
  if(v==='3_linhas_acima') return {inicio:61,fim:70};
  return {inicio:1,fim:10};
}
function getOffsetsByTipo(t){
  if(t==='1') return [0];
  if(t==='2') return [0,1];
  if(t==='3') return [0,1,2];
  if(t==='4') return [0,1,2,3];
  if(t==='5') return [0,1,2,3,4];
  if(t==='1_pula_1') return [0,2];
  if(t==='1_pula_1_pula_1') return [0,2,4];
  return [0,1];
}

/* Barra √∫ltimos N */
function buildRecentResultsBarHTML(
  dados,
  count = 80,
  indexColorMap = new Map(),
  maxPerLine = 20,
  marketForPaint = 'over2.5',
  ligaNomeGlobal = ''
){
  const total = dados.length;
  const start = Math.max(0, total - count);
  const ultimos = dados.slice(start);
  const cells = [];
  const isKiron = /^Kiron/i.test(ligaNomeGlobal || '');

  for(let i = 0; i < ultimos.length; i++){
    const item = ultimos[i];
    const idx = start + i;
    const [a,b,sum,mand,vis,horario,ht] = item;

    const green = isGreenForMarket(marketForPaint, a,b,sum,ht);
    const hitColor = indexColorMap.get(idx);

    const title = (mand||vis)
      ? `${horario ? (horario+' ¬∑ ') : ''}${mand} ${a}x${b} ${vis}`
      : `${horario ? (horario+' ¬∑ ') : ''}${a}x${b}`;

    let base = `
      <span class="time">${horario || ''}</span>
      <span class="team">${mand || ''}</span>
      <span class="score">${a}x${b}</span>
    `;

    if(ht && !isKiron){
      base += `<span class="time">${ht}</span>`;
    }
    base += `<span class="team">${vis || ''}</span>`;

    if(hitColor){
      cells.push(
        `<span class="cell ${green?'cell-green':'cell-red'} cell-hit" data-base-hit="1" data-idx="${idx}" title="${title}" style="--hit:${hitColor}">${base}</span>`
      );
    }else{
      cells.push(
        `<span class="cell ${green?'cell-green':'cell-red'}" data-idx="${idx}" title="${title}">${base}</span>`
      );
    }

    if(maxPerLine > 0 && (i+1) % maxPerLine === 0 && i < ultimos.length - 1){
      cells.push('<i class="breaker"></i>');
    }
  }

  return `<div class="recent-caption">√öltimos ${ultimos.length} resultados (antigo ‚ûú recente)</div><div class="recent-bar">${cells.join('')}</div>`;
}

/* sort (Pular, Ocorr√™ncias, Percentual) */
function attachSortingHandlers(tabela){
  const ths=[...tabela.querySelectorAll('th')];
  const idxP=ths.findIndex(th=>th.textContent.trim().toLowerCase().startsWith('pular'));
  const idxO=ths.findIndex(th=>th.textContent.trim().toLowerCase().startsWith('ocorr'));
  const idxPerc=ths.findIndex(th=>th.textContent.trim().toLowerCase().startsWith('percentual'));
  [idxP,idxO,idxPerc].forEach(idx=>{
    if(idx>=0){
      const th=ths[idx]; th.classList.add('sortable');
      th.addEventListener('click',()=>{
        const dir=th.classList.contains('asc')?'desc':'asc';
        ths.forEach(x=>x.classList.remove('asc','desc')); th.classList.add(dir);
        const rows=[...tabela.querySelectorAll('tr')].slice(1);
        rows.sort((A,B)=>{
          const a=A.children[idx].textContent.trim(), b=B.children[idx].textContent.trim();
          const na=parseFloat(a.replace('%','').replace(',','.'))||parseInt(a)||0;
          const nb=parseFloat(b.replace('%','').replace(',','.'))||parseInt(b)||0;
          return dir==='asc'? na-nb : nb-na;
        });
        rows.forEach(r=>tabela.appendChild(r));
      });
    }
  });
}

/* render principal */
function exibirResultados(conjuntos, combinado, activeMarkets=[]){
  window.recentCountByLeague = window.recentCountByLeague || {};

  const root=document.getElementById('resultados'); root.innerHTML='';

  const prettyList = activeMarkets.map((m, i)=>`(M${i+1}) ${marketLabel(m.val)}`).join(' | ');
  const info = document.createElement('div');
  info.style.fontWeight='bold'; info.style.marginBottom='10px';
  info.textContent = `Mercados ativos: ${prettyList || '(apenas M1)'} ‚Äî *Recentes pintam pelo primeiro ativo*`;
  root.appendChild(info);

  const modo=document.getElementById('placar_jogos').value;
  const map={'mesma_linha':'Mesma Linha (1-10)','mesma_linha2':'Mesma Linha (11-20)','linha_acima':'Linha Acima (21-30)','2_linhas_acima':'2 Linhas Acima (41-50)','3_linhas_acima':'3 Linhas Acima (61-70)'};
  const info2=document.createElement('div'); info2.style.fontWeight='bold'; info2.style.marginBottom='6px';
  info2.textContent=`Modo: ${combinado?'Combinado (todos)':`Padr√£o ${modo}`} | Intervalo: ${map[document.getElementById('intervalo_jogos').value]}`;
  root.appendChild(info2);

  if(equipesFiltro.length>0){
    const tag=document.createElement('div');
    tag.style.marginBottom='14px';
    const comp = {
      todos: 'placares, mercados e equipes',
      equipes: 'apenas equipes',
      mercados: 'apenas mercados',
      placares: 'apenas placares',
      placares_equipes: 'placares e equipes',
      placares_mercados: 'placares e mercados',
      equipes_mercados: 'equipes e mercados'
    }[modoPadrao] || 'todas as op√ß√µes';
    tag.innerHTML = `<strong>Filtro de equipes:</strong> ${equipesFiltro.join(', ')} ‚Äî <em>composi√ß√£o do padr√£o: ${comp}</em>`;
    root.appendChild(tag);
  }

  if(activeMarkets.length===0){
    const m1Only = document.getElementById('mercado1').value;
    activeMarkets = [{val:m1Only, idx:0}];
  }

  for(const conjunto of conjuntos){
    const { liga: nomeLiga, resultadosPorAtivo, dadosCru } = conjunto;
    const indexColorMap=new Map();

    // Header por liga
    const header=document.createElement('div');
    header.style.display='flex';
    header.style.alignItems='center';
    header.style.gap='10px';
    header.style.justifyContent='center';

    const h2=document.createElement('h2'); h2.textContent=nomeLiga;
    const sel=document.createElement('select');
    [10,20,30,40,60,80].forEach(n=>{
      const o=document.createElement('option'); o.value=n; o.textContent=`Mostrar ${n}`;
      sel.appendChild(o);
    });
    const defaultCount = window.recentCountByLeague[nomeLiga] ?? getRecentCountByInterval();
    sel.value = defaultCount;
    sel.addEventListener('change', ()=>{
      window.recentCountByLeague[nomeLiga] = parseInt(sel.value,10);
      reexibir();
    });

    header.appendChild(h2);
    header.appendChild(sel);
    root.appendChild(header);

    // ===== PR√ìXIMOS =====
    const futureWrap=document.createElement('div');
    futureWrap.className='recent-wrap';
    futureWrap.innerHTML = buildFutureBarHTML(9);
    const futureBar = futureWrap.querySelector('.future-bar');
    root.appendChild(futureWrap);

    function clearFutureBar(){
      if(!futureBar) return;
      futureBar.querySelectorAll('.cell').forEach(c=>{
        c.classList.remove('cell-hit','cell-focus');
        c.style.removeProperty('--hit');
        c.innerHTML = '';
      });
    }
    function addMarkerToFutureSlot(f, color, label){
      if(!futureBar) return;
      if(f<0 || f>=9) return;
      const c = futureBar.querySelectorAll('.cell')[f];
      if(!c) return;

      if(!c.classList.contains('cell-hit')){
        c.classList.add('cell-hit');
        c.style.setProperty('--hit', color);
      }
      const badge = document.createElement('span');
      badge.className = 'entry-badge';
      badge.textContent = label;
      badge.setAttribute('data-e-label', label);
      badge.style.background = color;
      badge.style.color = '#fff';
      c.appendChild(badge);
    }

    // ===== RECENTES =====
    const recent=document.createElement('div');
    recent.className='recent-wrap';

    const qtd = window.recentCountByLeague[nomeLiga] ?? getRecentCountByInterval();
    const lookback = qtd;
    const maxPerLine = /^Kiron/i.test(nomeLiga) ? 30 : 20;

    const wrapTables = document.createElement('div');
    wrapTables.className='tables-3col';

    const allLineGroups = [];
    const marketOffsets = [0,4,8];

    resultadosPorAtivo.forEach(({marketIndex, marketValue, resultados}, posAtivo)=>{
      const colorBaseOffset = marketOffsets[posAtivo % marketOffsets.length];
      const linhasInfo=[];
      const tabela=document.createElement('table');
      const cap=document.createElement('div');
      cap.className='market-caption';
      cap.textContent = `M${posAtivo+1}: ${marketLabel(marketValue)}`;
      tabela.innerHTML=`<tr>
        <th>Padr√£o (mosaico)</th>
        <th>Pular Jogos</th>
        <th>Ocorr√™ncias</th>
        <th>Greens</th>
        <th>Percentual</th>
      </tr>`;

      resultados.forEach((r,i)=>{
        const offsets=r.offsets?.length?r.offsets:getOffsetsByTipo(r.tipo_padrao||modo);
        const color = PALETA[(colorBaseOffset + i) % PALETA.length];

        const hits=findPatternHitsInLast(dadosCru, r.padrao, offsets, lookback);
        const hitSet=new Set();
        hits.forEach(arr=>arr.forEach(ix=>{
          if(!indexColorMap.has(ix)) indexColorMap.set(ix, color);
          hitSet.add(ix);
        }));

        const tr=document.createElement('tr');
        tr.className='row-colored'; tr.style.setProperty('--hit', color);

        tr.innerHTML=`
          <td>${buildPatternMosaicHTML(r.padrao, offsets)}</td>
          <td>${r.pular_jogos}</td>
          <td>${r.ocorrencias}</td>
          <td>${r.greens}</td>
          <td>${r.percentual}%</td>
        `;
        tabela.appendChild(tr);
        linhasInfo.push({
          tr, color, hitSet, hits,
          offsets,
          pular: r.pular_jogos,
          lastOffset: offsets[offsets.length-1],
          marketDisplayIndex: posAtivo
        });
      });

      attachSortingHandlers(tabela);

      const holder=document.createElement('div');
      holder.appendChild(cap);
      holder.appendChild(tabela);
      wrapTables.appendChild(holder);

      allLineGroups.push(linhasInfo);
    });

    const paintMarket = resultadosPorAtivo[0]?.marketValue || activeMarkets[0]?.val || document.getElementById('mercado1').value;
    recent.innerHTML = buildRecentResultsBarHTML(dadosCru, qtd, indexColorMap, maxPerLine, paintMarket);
    const recentBar = recent.querySelector('.recent-bar');

    root.appendChild(recent);
    root.appendChild(wrapTables);

    let activeRow=null;

    function setActiveRow(row){
      if(activeRow && activeRow!==row){
        activeRow.classList.remove('row-active');
        activeRow.style.removeProperty('box-shadow');
      }
      activeRow = row;
      if(row){
        row.classList.add('row-active');
        row.style.boxShadow = 'inset 0 0 0 2px var(--hit)';
      }
    }

    function clearSelectionAll(){
      if(!recentBar) return;
      recentBar.classList.remove('focus');
      recentBar.querySelectorAll('.cell').forEach(c=>{ c.classList.remove('cell-focus'); });
      recentBar.querySelectorAll('.cell.cell-hit').forEach(c=>{
        if(!c.hasAttribute('data-base-hit')){
          c.classList.remove('cell-hit');
          c.style.removeProperty('--hit');
        }
      });
      if(activeRow){
        activeRow.classList.remove('row-active');
        activeRow.style.removeProperty('box-shadow');
        activeRow=null;
      }
      clearFutureBar();
      // restaura todos os Es
      markInitialFutureEntries();
    }

    function applyPatternSelection(lineInfo){
      clearSelectionAll();
      const { hitSet, color } = lineInfo;
      if(!recentBar) return;
      recentBar.classList.add('focus');
      recentBar.querySelectorAll('.cell').forEach(c=>{
        const idx=parseInt(c.getAttribute('data-idx'));
        if(hitSet.has(idx)){
          c.classList.add('cell-focus','cell-hit');
          c.style.setProperty('--hit', color);
        }
      });
    }

    function applyOccurrenceSelection(lineInfo, arr){
      clearSelectionAll();
      setActiveRow(lineInfo.tr);
      if(!recentBar) return;
      recentBar.classList.add('focus');
      arr.forEach(idx=>{
        const c = recentBar.querySelector(`.cell[data-idx="${idx}"]`);
        if(c){
          c.classList.add('cell-focus','cell-hit');
          c.style.setProperty('--hit', lineInfo.color);
        }
      });
    }

    const futureSlotMap = new Map();

    function markFutureEntriesForLine(lineInfo){
      const { hits, offsets, pular, lastOffset, color, marketDisplayIndex } = lineInfo;
      const futureBase = dadosCru.length;
      clearFutureBar();
      hits.forEach(arr=>{
        const iBase = arr[0] - offsets[0];
        const entrada = iBase + lastOffset + 1 + pular;
        const f = entrada - futureBase;
        if(f>=0 && f<9){
          if(!futureSlotMap.has(f)) futureSlotMap.set(f, []);
          futureSlotMap.get(f).push({ lineInfo, arr, marketDisplayIndex });
          addMarkerToFutureSlot(f, color, `E${marketDisplayIndex+1}`);
        }
      });
      desenharHorariosFuturos();
    }

    function markInitialFutureEntries(){
      const futureBase = dadosCru.length;
      clearFutureBar();
      futureSlotMap.clear();

      allLineGroups.forEach((linhasInfo)=>{
        for(const li of linhasInfo){
          const { hits, offsets, pular, lastOffset, color, marketDisplayIndex } = li;
          for(const arr of hits){
            const iBase = arr[0] - offsets[0];
            const entrada = iBase + lastOffset + 1 + pular;
            const f = entrada - futureBase;
            if(f>=0 && f<9){
              if(!futureSlotMap.has(f)) futureSlotMap.set(f, []);
              const already = futureSlotMap.get(f).some(x=>x.lineInfo===li);
              if(!already){
                futureSlotMap.get(f).push({ lineInfo: li, arr, marketDisplayIndex });
                addMarkerToFutureSlot(f, color, `E${marketDisplayIndex+1}`);
              }
            }
          }
        }
      });

      desenharHorariosFuturos();
    }
    // chama na carga inicial
    markInitialFutureEntries();

    function desenharHorariosFuturos(){
      if(!futureBar) return;
      const lastHorario = (dadosCru[dadosCru.length-1]?.[5]) || null;
      if(!isHHMM(lastHorario)) return;

      const nome = (nomeLiga||'').toLowerCase();
      const leagueKind = nome.includes('express') ? 'express'
                        : (nome.includes('kiron') ? 'kiron' : 'default');

      const slots = futureBar.querySelectorAll('.cell');
      const times = computeNextKickoffTimes(lastHorario, slots.length, leagueKind);
      slots.forEach((slot, i)=>{
        slot.querySelectorAll('.kickoff-badge').forEach(n=>n.remove());
        const t = times[i];
        if(!t) return;
        const badge = document.createElement('div');
        badge.className = 'kickoff-badge';
        badge.textContent = t;
        slot.appendChild(badge);
      });
    }

    allLineGroups.flat().forEach((li)=>{
      const {tr} = li;
      tr.addEventListener('click', ()=>{
        if(activeRow===tr){ return; }
        applyPatternSelection(li);
        setActiveRow(tr);
        markFutureEntriesForLine(li);
        tr.scrollIntoView({behavior:'smooth', block:'nearest'});
      });
    });

    recentBar.addEventListener('click', (e)=>{
      const cell = e.target.closest('.cell');
      if(!cell){ clearSelectionAll(); return; }
      const idx = parseInt(cell.getAttribute('data-idx'));
      const match = allLineGroups.flat().find(li => li.hitSet.has(idx));
      if(!match){ clearSelectionAll(); return; }

      applyPatternSelection(match);
      setActiveRow(match.tr);

      const { hits, offsets, pular, lastOffset, color, marketDisplayIndex } = match;
      const futureBase = dadosCru.length;
      clearFutureBar();
      hits.forEach(arr=>{
        if(!arr.includes(idx)) return;
        const k = arr.findIndex(v => v===idx);
        const base = arr[k] - offsets[k];
        const entrada = base + lastOffset + 1 + pular;
        const f = entrada - futureBase;
        if(f>=0 && f<9){
          if(!futureSlotMap.has(f)) futureSlotMap.set(f, []);
          futureSlotMap.get(f).push({ lineInfo: match, arr, marketDisplayIndex });
          addMarkerToFutureSlot(f, color, `E${marketDisplayIndex+1}`);
        }
      });

      desenharHorariosFuturos();
      match.tr.scrollIntoView({behavior:'smooth', block:'nearest'});
    });

    futureBar.addEventListener('click', (e)=>{
      const span = e.target.closest('.entry-badge');
      const cell = e.target.closest('.cell');
      if(!cell) return;
      const f = [...futureBar.querySelectorAll('.cell')].indexOf(cell);
      if(f<0) return;

      if(!futureSlotMap.has(f)) return;
      const arrList = futureSlotMap.get(f);

      let chosen = null;
      if(span && span.dataset.eLabel){
        const mk = parseInt(span.dataset.eLabel.replace('E','')) - 1;
        chosen = arrList.find(x=>x.marketDisplayIndex===mk) || arrList[0];
      }else{
        chosen = arrList[0];
      }
      if(!chosen) return;

      const { lineInfo, arr, marketDisplayIndex } = chosen;

      applyOccurrenceSelection(lineInfo, arr);
      setActiveRow(lineInfo.tr);

      clearFutureBar();
      addMarkerToFutureSlot(f, lineInfo.color, `E${marketDisplayIndex+1}`);

      desenharHorariosFuturos();
      lineInfo.tr.scrollIntoView({behavior:'smooth', block:'nearest'});
    });
  }
}

/* Mosaico */
function buildPatternMosaicHTML(padraoStr, offsets){
  const tokens = padraoStr.split(' | ');
  const last = offsets[offsets.length - 1];
  let k = 0;
  const cells = [];

  for(let i = 0; i <= last; i++){
    if(offsets.includes(i)){
      const token = tokens[k++] || '';
      cells.push(`<span class="cell cell-neutral" title="${token}">${token}</span>`);
    }else{
      cells.push(`<span class="cell cell-grey">Pula</span>`);
    }
  }
  return `<div class="mosaic">${cells.join('')}</div>`;
}

/* hits do padr√£o nos √∫ltimos N */
function findPatternHitsInLast(dados, padraoStr, offsets, lookback=60){
  const req=padraoStr.split(' | '), last=offsets[offsets.length-1];
  const start=Math.max(0, dados.length - lookback - last), end=dados.length - last;
  const hits=[];
  for(let i=start;i<end;i++){
    let ok=true;
    for(let k=0;k<offsets.length;k++){
      const [a,b,t,mandante,visitante,horario,ht]=dados[i+offsets[k]];
      if(!tokensDoJogo(a,b,t, mandante, visitante, ht).includes(req[k])){ ok=false; break; }
    }
    if(ok && equipesFiltro.length>0){
      const janela = offsets.map(o=>dados[i+o]);
      if(!janelaContemEquipe(janela)) ok=false;
    }
    if(ok) hits.push(offsets.map(o=>i+o));
  }
  return hits;
}

/* ======= Worker inline (an√°lise pesada) + helpers ======= */
const ANALYZE_WORKER_SRC = `
self.onmessage = (e) => {
  const p = e.data;
  if (!p || p.cmd !== 'analyze') return;
  const res = analyzeAll(p.payload);
  self.postMessage({ ok: true, id: p.id, result: res });
};

function enumerateCombos(tok){
  if(tok.length===1) return tok[0].map(t=>[t]);
  if(tok.length===2){ const out=[]; for(const a of tok[0]) for(const b of tok[1]) out.push([a,b]); return out; }
  if(tok.length===3){ const out=[]; for(const a of tok[0]) for(const b of tok[1]) for(const c of tok[2]) out.push([a,b,c]); return out; }
  const out=[],cur=[];
  (function rec(i){ if(i===tok.length){ out.push(cur.slice()); return; } for(const t of tok[i]){ cur.push(t); rec(i+1); cur.pop(); } })(0);
  return out;
}
function getOffsetsByTipo(t){
  if(t==='1') return [0];
  if(t==='2') return [0,1];
  if(t==='3') return [0,1,2];
  if(t==='4') return [0,1,2,3];
  if(t==='5') return [0,1,2,3,4];
  if(t==='1_pula_1') return [0,2];
  if(t==='1_pula_1_pula_1') return [0,2,4];
  return [0,1];
}
function janelaContemEquipe(jogos, equipesFiltro){
  if(!equipesFiltro || equipesFiltro.length===0) return true;
  for(const j of jogos){
    const m=(j[3]||'').toLowerCase(), v=(j[4]||'').toLowerCase();
    for(const alvo of equipesFiltro){ if(m.includes(alvo)||v.includes(alvo)) return true; }
  }
  return false;
}
function tokensDoJogo(a,b,total, mandante, visitante, ht, incFlags){
  const t=new Set();
  if(incFlags.incPlacares){ t.add(\`\${a}-\${b}\`); }

  if(incFlags.incMercados){
    t.add(a>0&&b>0 ? 'ambas' : 'ambasnao');
    t.add(total>=3 ? 'over2.5' : 'under2.5');
    if(total<2) t.add('under1.5');
    if(total>=4) t.add('over3.5');
    if(total<4) t.add('under3.5');
    if(a>b) t.add('casa'); else if(a===b) t.add('empate'); else t.add('fora');
    if(a>0) t.add('casa_marca');
    if(b>0) t.add('fora_marca');
    if(total===0) t.add('0 gol');
    else if(total===1) t.add('1 gol');
    else if(total===2) t.add('2 gols');
    else if(total===3) t.add('3 gols');
    else if(total===4) t.add('4 gols');
    else t.add('5+ gols');
    if(ht){
      if(ht==='0-0') t.add('ht_0_0');
      else if(ht==='0-1') t.add('ht_0_1');
      else if(ht==='1-0') t.add('ht_1_0');
      else if(ht==='1-1') t.add('ht_1_1');
      else if(ht==='0-2') t.add('ht_0_2');
      else if(ht==='2-0') t.add('ht_2_0');
      else if(ht==='OUT') t.add('ht_out');
    }
  }

  if(incFlags.incEquipes){
    if(mandante) t.add(mandante.toLowerCase());
    if(visitante) t.add(visitante.toLowerCase());
  }
  return Array.from(t);
}
function isGreenForMarket(m,a,b,total,ht){
  if(m==='ambas') return a>0 && b>0;
  if(m==='ambasnao') return !(a>0 && b>0);
  if(m==='under1.5') return total<2;
  if(m==='under2.5') return total<3;
  if(m==='under3.5') return total<4;
  if(m==='over1.5')  return total>=2;
  if(m==='over2.5')  return total>=3;
  if(m==='over3.5')  return total>=4;
  if(m==='casa')    return a>b;
  if(m==='empate')  return a===b;
  if(m==='fora')    return a<b;
  if(m==='casa_marca') return a>0;
  if(m==='fora_marca') return b>0;
  if(m==='gols_0')       return total===0;
  if(m==='gols_1')       return total===1;
  if(m==='gols_2')       return total===2;
  if(m==='gols_3')       return total===3;
  if(m==='gols_4')       return total===4;
  if(m==='gols_5_plus')  return total>=5;
  if(m==='ht_0_0') return ht==='0-0';
  if(m==='ht_0_1') return ht==='0-1';
  if(m==='ht_1_0') return ht==='1-0';
  if(m==='ht_1_1') return ht==='1-1';
  if(m==='ht_0_2') return ht==='0-2';
  if(m==='ht_2_0') return ht==='2-0';
  if(m==='ht_out') return ht==='OUT';
  return false;
}
function analisarAutoPadroes(dados,tipo,tiros,market,incFlags,equipesFiltro,inicio,fim){
  const res=[]; const offs=getOffsetsByTipo(tipo); const last=offs[offs.length-1];
  for(let p=inicio;p<=fim;p++){
    const comb={}, ex={}; const need=(last+1)+p+tiros; if(dados.length<need) continue;
    for(let i=0;i<=dados.length-need;i++){
      const jogosPadrao = offs.map(o => dados[i+o]);
      const ini=i+last+1+p, fimA=ini+tiros;
      const jogosTiro = dados.slice(ini, Math.min(fimA, dados.length));

      if(!janelaContemEquipe([...jogosPadrao, ...jogosTiro], equipesFiltro)) continue;

      const tok=[], plac=[];
      for(const o of offs){
        const [a,b,t,mandante,visitante,horario,ht]=dados[i+o];
        tok.push(tokensDoJogo(a,b,t, mandante, visitante, ht, incFlags));
        plac.push(\`\${a}x\${b}¬¶\${mandante}¬¶\${visitante}\`);
      }
      const combos=enumerateCombos(tok);
      let green=false;
      for(let j=ini;j<fimA&&j<dados.length;j++){
        const [a,b,sum,_m,_v,_h,ht]=dados[j];
        if(isGreenForMarket(market, a,b,sum,ht)){ green=true; break; }
      }
      const placStr=plac.join(' | ');
      for(const seq of combos){
        const key=seq.join(' | ');
        if(!comb[key]){ comb[key]={ocorrencias:0,greens:0,offsets:offs.slice()}; ex[key]=placStr; }
        comb[key].ocorrencias++; if(green) comb[key].greens++;
      }
    }
    for(const k in comb){
      const st=comb[k]; if(st.ocorrencias>=3){
        res.push({ padrao:k, placares:ex[k], pular_jogos:p, offsets:st.offsets, ocorrencias:st.ocorrencias, greens:st.greens, percentual:((st.greens/st.ocorrencias)*100).toFixed(2) });
      }
    }
  }
  res.sort((a,b)=>parseFloat(b.percentual)-parseFloat(a.percentual)||b.ocorrencias-a.ocorrencias);
  return res.slice(0,15);
}
function analyzeAll(payload){
  const { dados, tipoPadrao, tiros, markets, incFlags, equipesFiltro, intervalo, combinado } = payload;
  const tipos = combinado ? ['2','3','1_pula_1','1_pula_1_pula_1'] : [tipoPadrao];
  const resultadosPorAtivo = [];

  for(const mk of markets){
    let todos=[];
    for(const t of tipos){
      const r = analisarAutoPadroes(dados, t, tiros, mk.val, incFlags, equipesFiltro, intervalo.inicio, intervalo.fim);
      r.forEach(x=>x.tipo_padrao=t);
      todos = todos.concat(r);
    }
    todos.sort((a,b)=>parseFloat(b.percentual)-parseFloat(a.percentual)||b.ocorrencias-a.ocorrencias);
    resultadosPorAtivo.push({ marketIndex: mk.idx, marketValue: mk.val, resultados: todos.slice(0,15) });
  }
  return { resultadosPorAtivo };
}
`;
let ANALYZE_WORKER = null;
function getAnalyzeWorker(){
  if(!ANALYZE_WORKER){
    const blob = new Blob([ANALYZE_WORKER_SRC], { type:'application/javascript' });
    ANALYZE_WORKER = new Worker(URL.createObjectURL(blob));
  }
  return ANALYZE_WORKER;
}
function analyzeInWorker(dados, opts){
  return new Promise((resolve, reject)=>{
    const w = getAnalyzeWorker();
    const id = Math.random().toString(36).slice(2);
    const onMsg = (ev)=>{
      const msg = ev.data;
      if(!msg || msg.id!==id) return;
      w.removeEventListener('message', onMsg);
      if(msg.ok) resolve(msg.result); else reject(msg.error||'erro');
    };
    w.addEventListener('message', onMsg);
    w.postMessage({ cmd:'analyze', id, payload:{ dados, ...opts } });
  });
}

/* ===== Listeners ===== */

document.addEventListener('click', (ev)=>{
  const t = ev.target;
  const insideFuture = t.closest('.future-bar');
  const insideRecent = t.closest('.recent-bar');
  const insideRow    = t.closest('tr.row-colored');
  const isBadge      = t.closest('.entry-badge');

  if(!insideFuture && !insideRecent && !insideRow && !isBadge){
    // clearSelectionAll() ser√° chamado por cada bloco quando necess√°rio
    const rs = document.querySelectorAll('.recent-wrap .recent-bar');
    rs.forEach(bar=>{
      bar.classList.remove('focus');
      bar.querySelectorAll('.cell').forEach(c=>{ c.classList.remove('cell-focus'); });
    });
    document.querySelectorAll('tr.row-colored.row-active').forEach(tr=>{
      tr.classList.remove('row-active');
      tr.style.removeProperty('box-shadow');
    });
    document.querySelectorAll('.future-bar .cell').forEach(c=>{
      c.classList.remove('cell-hit','cell-focus'); c.style.removeProperty('--hit'); c.innerHTML='';
    });
  }
}, true);

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('togglestats')?.addEventListener('click', iniciarAnalise);

  const auto = document.getElementById('auto-atualizar');
  const status = document.getElementById('status-atualizacao');
  if(auto){
    auto.addEventListener('change', function(){
      if(this.checked){
        if(!intervaloAtualizacao){
          contadorSegundos=180;
          atualizarContador();
          intervaloAtualizacao=setInterval(atualizarContador,1000);
        }
        if(status) status.style.display='block';
      }else{
        if(intervaloAtualizacao){ clearInterval(intervaloAtualizacao); intervaloAtualizacao=null; }
        if(status) status.style.display='none';
      }
    });
  }

  const selModo = document.getElementById('modo-padrao');
  if(selModo){
    selModo.addEventListener('change', () => {
      definirEquipesEModo();
      reprocessarComCache();
    });
  }

  ['mercado1','mercado2','mercado3','placar_jogos','tiros','linhas','intervalo_jogos','equipes'].forEach(id=>{
    const el=document.getElementById(id);
    if(!el) return;
    el.addEventListener('change', ()=>{
      reprocessarComCache();
    });
    if(el.tagName==='INPUT' && el.type==='text'){
      el.addEventListener('blur', reprocessarComCache);
      el.addEventListener('keyup', (ev)=>{ if(ev.key==='Enter') reprocessarComCache(); });
    }
  });
});

async function reprocessarComCache(){
  showBusy('Calculando os padr√µes‚Ä¶');
  try{
    window.recentCountByLeague = window.recentCountByLeague || {};
    window.ULTIMO_PAC = window.ULTIMO_PAC || [];
    window.ULTIMO_COMBINADO = !!window.ULTIMO_COMBINADO;

    definirEquipesEModo();

    const tipoPadrao = document.getElementById('placar_jogos').value;
    const tiros      = parseInt(document.getElementById('tiros').value, 10);
    const numLinhas  = parseInt(document.getElementById('linhas').value, 10);

    const m1 = document.getElementById('mercado1').value;
    const m2 = document.getElementById('mercado2').value;
    const m3 = document.getElementById('mercado3').value;

    const rawMarkets = [m1, m2, m3];
    let activeMarkets = rawMarkets
      .map((val, idx)=>({val, idx}))
      .filter(x => x.idx === 0 || (x.val && x.val!==''));

    const ligas=[];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb=>{
      if(cb.value && cb.value!=="on") ligas.push(cb.value)
    });
    if(ligas.length===0){ alert("Por favor, selecione pelo menos uma liga."); return; }

    const pac=[];

    for(const arq of ligas){
      try{
        const cached = window.CACHE_ARQUIVOS[arq];
        if(!cached){
          console.warn(`Arquivo ${arq} ainda n√£o est√° em cache. Clique em "Carregar Dados".`);
          continue;
        }
        const {dados} = parseCSVRawToDados(cached.raw, arq, numLinhas);

        if(activeMarkets.length===0){
          activeMarkets = [{val:m1, idx:0}];
        }

        const intervalCfg = obterIntervalo();
        const incFlags = { incPlacares, incMercados, incEquipes };
        const { resultadosPorAtivo } = await analyzeInWorker(dados, {
          tipoPadrao,
          tiros,
          markets: activeMarkets,
          incFlags,
          equipesFiltro,
          intervalo: intervalCfg,
          combinado: (tipoPadrao==='combinado')
        });

        pac.push({ liga:obterNomeLiga(arq), resultadosPorAtivo, dadosCru:dados });
      }catch(e){
        console.error(e);
        alert(`Erro ao processar ${arq} do cache`);
      }
    }

    window.ULTIMO_PAC = pac;
    window.ULTIMO_COMBINADO = (tipoPadrao==='combinado');
    window.ULTIMO_ACTIVE_MARKETS = activeMarkets.slice();

    exibirResultados(pac, window.ULTIMO_COMBINADO, activeMarkets);

    const ts=document.createElement('div');
    ts.style.textAlign='center';
    ts.style.color='var(--accent-color)';
    ts.style.margin='14px 0 26px';
    const ag=new Date();
    ts.textContent=`Reprocessado (sem download): ${ag.toLocaleDateString()} ${ag.toLocaleTimeString()}`;
    document.getElementById('resultados').appendChild(ts);
  } finally {
    hideBusy();
  }
}

async function carregarDados(forceFresh = false){
  window.recentCountByLeague = window.recentCountByLeague || {};
  window.ULTIMO_PAC = window.ULTIMO_PAC || [];
  window.ULTIMO_COMBINADO = !!window.ULTIMO_COMBINADO;

  definirEquipesEModo();

  const tipoPadrao = document.getElementById('placar_jogos').value;
  const tiros      = parseInt(document.getElementById('tiros').value, 10);
  const numLinhas  = parseInt(document.getElementById('linhas').value, 10);

  const m1 = document.getElementById('mercado1').value;
  const m2 = document.getElementById('mercado2').value;
  const m3 = document.getElementById('mercado3').value;

  const rawMarkets = [m1, m2, m3];
  let activeMarkets = rawMarkets
    .map((val, idx)=>({val, idx}))
    .filter(x => x.idx === 0 || (x.val && x.val!==''));

  const ligas=[];
  document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb=>{
    if(cb.value && cb.value!=="on") ligas.push(cb.value)
  });
  if(ligas.length===0){ alert("Por favor, selecione pelo menos uma liga."); return; }

  // download/atualiza cache
  for(const arq of ligas){
    try{
      await garantirCacheArquivo(arq, { forceFresh });
    }catch(e){
      console.error(e);
      alert(`Erro ao baixar ${arq}`);
    }
  }

  showBusy('Calculando os padr√µes‚Ä¶');
  try{
    const pac=[];
    for(const arq of ligas){
      const cached = window.CACHE_ARQUIVOS[arq];
      if(!cached) continue;
      const {dados} = parseCSVRawToDados(cached.raw, arq, numLinhas);

      if(activeMarkets.length===0){
        activeMarkets = [{val:m1, idx:0}];
      }

      const intervalCfg = obterIntervalo();
      const incFlags = { incPlacares, incMercados, incEquipes };
      const { resultadosPorAtivo } = await analyzeInWorker(dados, {
        tipoPadrao,
        tiros,
        markets: activeMarkets,
        incFlags,
        equipesFiltro,
        intervalo: intervalCfg,
        combinado: (tipoPadrao==='combinado')
      });

      pac.push({ liga:obterNomeLiga(arq), resultadosPorAtivo, dadosCru:dados });
    }

    window.ULTIMO_PAC = pac;
    window.ULTIMO_COMBINADO = (tipoPadrao==='combinado');
    window.ULTIMO_ACTIVE_MARKETS = activeMarkets.slice();

    exibirResultados(pac, window.ULTIMO_COMBINADO, activeMarkets);

    const ts=document.createElement('div');
    ts.style.textAlign='center';
    ts.style.color='var(--accent-color)';
    ts.style.margin='14px 0 26px';
    const ag=new Date();
    ts.textContent=`√öltima atualiza√ß√£o (download): ${ag.toLocaleDateString()} ${ag.toLocaleTimeString()}`;
    document.getElementById('resultados').appendChild(ts);
  } finally {
    hideBusy();
  }
}
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976e58485ef70114',t:'MTc1NjQ5NDU4OA=='};var a=document.createElement('script');a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./Buscador de Padr√µes - Betaxis_files/saved_resource.html"></iframe>


<div id="vimeo_tool" class="vimeo_tool"><template shadowrootmode="open"><style>
#vimeo_tool {
  width: 100vw;
  height: 100vh;
  position: fixed;
  z-index: 9999;
  top: 0;
  background: rgba(0, 0, 0, 0.3);
  color: #3d3d3d;
  font-family: Source Han Sans;
  font-variation-settings: "opsz" auto;
font-feature-settings: "kern" on;
line-height:normal;
}

#vimeo_tool.isOption{
  background: linear-gradient(#fff, rgba(100, 170, 228, 0.2));
}

.priceImg {
  width: 372px;
  z-index: 99;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.priceImg .get {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  height: 28px;
  border-radius: 4px;
  background-color: rgba(13, 189, 189, 1);
  color: rgba(255, 255, 255, 1);
  font-size: 16px;
  text-align: center;
  font-family: Roboto;
  cursor: pointer;
  width: 67px;
  bottom: 48px;
  line-height: 28px;
}

.priceImg img {
  width: 100%;
}

.priceImg .close {
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 18px;
  cursor: pointer;
  color: rgba(154, 154, 154, 1);
}



.pop {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translateX(-50%) translateY(-50%);
  z-index: 9999999;
}

.notice {
  width: 360px;
  text-align: center;
  margin-bottom: 20px
}

.notice_in {
  display: none;
  height: 30px;
  line-height: 30px;
  background-color: #fbf6f6;
  animation: fadenum 1s;
  width: 470px;
  margin: 0 auto 0 -40px;
}

.notice_in_svg {
  float: left;
  margin-left: 10px;
  margin-top: 1px;
}

@keyframes fadenum {
  0% {
      transform: translateX(70px);
  }
}

.dialog {
  height: 560px;
  width: 400px;
  background-color: #fbf6f6;
  padding-top: 0px;
}

.dialog_close {
  margin-top: -102px;
  margin-left: 380px;
  position: absolute;
}

.dialog_in {
  max-width: 320px;
  flex: 1;
  border: 1px solid #FD935A;
  border-radius: 5px;
  position: relative;
  margin-right: 15px;
  padding-top: 20px;
}

.dialog_in:last-child {
  margin-right: 0;
}

.dialog_in span.discount {
  color: #B36BF4;
  position: absolute;
  right: 0;
  top: 0;
  background: #f9dfcf;
  padding: 6px 0 6px 6px;
  border-radius: 0 4px 0 6px;
  font-size: 13px;
}

:root {
  --titleHeight: 55px
}

.pro {
  text-align: center;
  height: var(--titleHeight);
  line-height: var(--titleHeight);
  color: #000;
  font-weight: 450;
  font-size: 28px;
}

.dialog_line {
  border-bottom: 1px solid #ffc750;
  margin: 0 auto;
  width: 300px;
}

.fee {
  display: block;
  text-align: center;
  height: var(--titleHeight);
  line-height: var(--titleHeight)
}

.fee>span:nth-child(1) {
  font-size: 34px;
  color: #444444;
  font-weight: 500;
  font-family: Source Han Sans;
}

#newsvd_dialog_in.Yearly .fee>span:nth-child(1){
  color: #FD935A;
}


#newsvd_dialog_in.Yearly span.discount {
  border-radius: 0 4px 0 100%;
    width: 45px;
    height: 45px;
    text-align: center;
}

.fee>span:nth-child(2) {
  color: #B6B5B5;
    font-size: 14px;
}

.feature_list {
  margin-left: 40px;
  text-align: left;
}

.feature_list img.rightIcon{
  margin-right: 7px;
}

.feature_list ul {
  margin-left: -40px;
  font-size: 14px
}

.feature_list ul li svg {
  margin-left: -10px;
  margin-right: 0px;
  height: 13px;
}

.feature_list ul li {
  line-height: 30px;
  text-indent: -15px;
  list-style: none;
}

.feature_list ul li::marker {
  color: #00c0be;
}

.dialog_get {
  cursor: pointer;
  border: none;
  display: block;
  border-radius: 5px;
  background-color: #00c0be;
  height: 30px;
  width: 100px;
  line-height: 30px;
  margin: 10px auto 5px;
  font-weight: 600;
  color: white
}

.newsvd_pro_sub {
  border-radius: 999999px;
  color: #FD935A;
  box-sizing: border-box;
  border: 1px solid #FD935A;
  width: 80%;
  text-align: center;
  padding: 8px;
  margin: 10px auto;
  cursor: pointer;
  font-weight: 500;
  display: inline-block;
  transition: all .4s;
  font-size: 14px;
}

#newsvd_dialog_in.Yearly .newsvd_pro_sub {
  background: linear-gradient(180deg, #F1C946 0%, #FD935A 100%);
  color: #fff;
}

#newsvd_dialog_in.Yearly .newsvd_pro_sub:hover{
  opacity: .9;
}

span.newsvd_pro_sub:hover {
  background: #FD935A;
  color: #fff;
}

.dialog_close {
  height: 20px;
  width: 20px;
  border-radius: 4em;
}

.dialog_close:hover {
  background-color: #00c0be;
}

.external_ffmpeg {
  color: blue;
  cursor: pointer;
  text-decoration: underline;
}

#payment_popup {
  position: fixed;
  z-index: 100;
  width: 100vw;
  height: 100vh;
  top: 0px;
  background: rgba(0, 0, 0, 0.3);
}

.payment_content {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translateX(-50%) translateY(-50%);
  z-index: 103;
  height: 320px;
  width: 410px;
  background: #fff;
  padding: 20px;
}

.payment_select {
  padding: 20px 0 0 110px;
}

.payment_label {
  line-height: 30px;
}

.original_price {
  text-decoration: line-through;
  color: red !important;
}

.chat_summary_block,
.newsvd_chat_summary_block {
  display: none;
  position: absolute;
  width: 250px;
  margin-left: 65px;
  height: 85px;
  text-align: center !important;
  background: white;
}

.summary_new {
  height: 18px;
  width: 18px;
  margin-right: -3px;
  margin-left: -6px;
  float: left;
  border-radius: 3px
}

.newsvd_summary_new {
  height: 18px;
  width: 18px;
  margin-top: -4px;
  margin-right: -3px;
  margin-left: -5px;
  float: left;
  border-radius: 3px
}

.timerInput {
  font-size: 16px;
  display: inline-block;
  margin: 10px 7% 0 0
}

.timeTip {
  display: none;
  position: absolute;
  left: 23px;
  border-radius: 5px;
  width: 220px;
  margin-top: -27px;
  margin-left: -250px;
  height: 20px;
  font-size: 12px;
  line-height: 20px;
  text-align: center !important;
  background: #0072e6;
  color: white;
}

.timerInput p {
  width: 77px;
  height: 31px;
  line-height: 31px;
  border: 1px solid #9a999c;
  border-radius: 4px;
  color: #9a999c;
  font-size: 14px;
  text-align: center;
  font-family: Roboto;
  margin-top: 5px;
}

.spanTimer {
  background: none;
  outline: none;
  padding: 0 !important;
  width: 16px;
  border: 0;
  color: #9a999c !important;
}

.spanTimer:focus {
  border: none;
}

.time_middle {
  margin-left: -15px;
  color: #9a999c;
}

.jump_to_chatGPT {
  background: #0072e6 !important;
  color: white;
  outline: none;
  font-size: 13px !important;
  height: 27px !important;
  width: 150px;
  border-radius: 5px;
  border: none;
  margin-top: 10px !important;
  cursor: pointer;
}

.summary_position {
  display: inline-block;
  position: relative;
  margin-left: -10px;
  top: 5px;
  cursor: pointer;
}

.summary_position img {
  height: 20px;
  width: 20px;
}

.summary_position:hover:after {
  position: absolute;
  left: -30px;
  top: -25px;
  padding: 5px;
  background-color: black;
  border-radius: 5px;
  color: #fff;
  content: attr(labelTooltip);
  white-space: nowrap;
  z-index: 2;
  width: 120px;
}

.summary_time_height {
  height: 41px;
}

.other_options {
  line-height: 20px !important;
}

.other_options_img {
  height: 20px;
  width: 20px;
  float: right;
}

.newsvd_dialog {
  background-color: #fff;
  padding-top: 20px;
  padding: 20px 34px;
  position: relative;
  height: auto;
  border-radius: 6px;
  box-shadow: 0 0 10px #0000004d;
  width: 80vw;
  max-width: 940px;
}

.newsvd_dialog_close {
  height: 20px;
  width: 20px;
  border-radius: 4em;
  right: 6px;
  top: 4px;
  position: absolute;
  cursor: pointer;
}

.newsvd_dialog_close:hover {
  background-color: #FD935A;
}

.top_pro_container {
  text-align: center;
  margin-bottom: 30px;
}

.top_pro {
  font-size: 30px;
  font-weight: 500;
  margin-bottom: 5px;
  color: #3d3d3d;
}

.top_pro_span {
  font-size: 13px;
  color: #9a999c;
}

.discountImg{
  position: absolute;
  width: 120px;
  right: -60px;
  top: -60px;
}

.perMon{
  color: #A19F9F;
  font-size: 15px;
  text-align: center;
  height: 18px;
  line-height: 18px;
}

.hotTitle{
  position: absolute;
  width: 100%;
  padding: 5px 0 5px 8px;
  top: 0;
  transform: translateY(-100%);
  z-index: 0;
  border-radius: 8px 8px 0 0;
  opacity: 1;
  background: rgba(179, 107, 244, 0.4);
  font-size: 13px;
  font-weight: 600;
  color: #FD935A;
  box-sizing: border-box;
  text-align: left;
}

.cardLogo{
  position: absolute;
  top: 8px;
  left: 9px;
  font-size: 14px;
  color: #3D3D3D;
}
.cardLogo img{
  width: 14px;
    vertical-align: middle;
    margin-top: -3px;
}

/* 800px‰ª•‰∏ãÂ™í‰ΩìÊü•ËØ¢ */
@media screen and (max-width: 800px) {
  .newsvd_dialog {
      width: 90vw;
  }

  div#pop {
      top: 0;
      padding-top: 0;
      transform: translateX(-50%) translateY(0);
      overflow: auto;
      max-height: calc(100vh - 40px);
  }
}</style><div><div id="vimeo_tool" class="" style="display: none;"><div id="pop" class="pop"><div id="newsvd_notice" class="notice"><div id="newsvd_notice_in" class="notice_in"><div class="notice_in_svg"><svg t="1669280615610" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2722" width="16" height="16" class="icon"><path d="M514.048 59.392q93.184 0 174.592 35.328t142.336 96.768 96.256 143.36 35.328 175.104-35.328 175.616-96.256 143.872-142.336 96.768-174.592 35.328-175.104-35.328-142.848-96.768-96.256-143.872-35.328-175.616 35.328-175.104 96.256-143.36 142.848-96.768 175.104-35.328zM795.648 423.936q18.432-18.432 19.456-45.568t-17.408-45.568-45.056-17.92-45.056 18.944l-288.768 288.768-99.328-98.304q-18.432-18.432-45.056-18.944t-45.056 17.92-18.944 43.52 17.92 43.52l142.336 143.36q18.432 18.432 48.128 17.92t48.128-18.944l-4.096 4.096z" p-id="2723" fill="#71b601"></path></svg></div><div id="newsvd_notice_in_span" class="notice_in_span"><span>We will support it soon! Click</span><span id="external_ffmpeg" class="external_ffmpeg">2k/4k</span><span>to download videos first.</span></div></div></div><div id="newsvd_dialog" class="newsvd_dialog"><div class="cardLogo"><span>Vimeo‚Ñ¢ Downloader</span></div><div class="top_pro_container"><div class="top_pro">Plan</div><span class="top_pro_span">Subscription will automatically renew every month before you unsubscribe.</span></div><div id="newsvd_dialog_close" class="newsvd_dialog_close"><svg t="1669283546396" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4105" width="20" height="20" class="icon"><path d="M794.8 794.8c-14 14-36.9 14-50.9 0L229.2 280.1c-14-14-14-36.9 0-50.9s36.9-14 50.9 0L794.9 744c13.9 13.9 13.9 36.8-0.1 50.8z" p-id="4106" fill="#2c2c2c"></path><path d="M794.8 229.2c14 14 14 36.9 0 50.9L280.1 794.8c-14 14-36.9 14-50.9 0s-14-36.9 0-50.9L744 229.1c13.9-13.9 36.8-13.9 50.8 0.1z" p-id="4107" fill="#2c2c2c"></path></svg></div><div style="display: flex; justify-content: space-around;"><div id="newsvd_dialog_in" class="dialog_in Monthly"><!----><!----><div id="feature_explain" class="feature_explain"><span id="fee" class="fee"><span>$ 6.99</span><span> / month</span></span><div style="display: flex; justify-content: center;"><span pid="penndbmahnpapepljikkjmakcobdahne-monthly" class="newsvd_pro_sub">Upgrade</span></div><div id="feature_list" class="feature_list"><ul id="feature_list_ul"><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download videos with audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download 1000+ web</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>1-6x download speed</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download subtitles</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Unlimited downloads</span></li></ul></div></div></div><div id="newsvd_dialog_in" class="dialog_in Quarterly"><span class="discount">Save 24%</span><!----><div id="feature_explain" class="feature_explain"><span id="fee" class="fee"><span>$ 15.99</span><span> / quarter</span></span><div style="display: flex; justify-content: center;"><span pid="penndbmahnpapepljikkjmakcobdahne-quarterly" class="newsvd_pro_sub">Upgrade</span></div><div id="feature_list" class="feature_list"><ul id="feature_list_ul"><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download videos with audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download 1000+ web</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>1-6x download speed</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download subtitles</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Unlimited downloads</span></li></ul></div></div></div><div id="newsvd_dialog_in" class="dialog_in Yearly"><span class="discount">Save 52%</span><div class="hotTitle"> üî• Flash Sale </div><div id="feature_explain" class="feature_explain"><span id="fee" class="fee"><span>$ 39.99</span><span> / year</span></span><div style="display: flex; justify-content: center;"><span pid="penndbmahnpapepljikkjmakcobdahne-yearly" class="newsvd_pro_sub">Upgrade</span></div><div id="feature_list" class="feature_list"><ul id="feature_list_ul"><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download videos with audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download 1000+ web</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>1-6x download speed</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download audio</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Support download subtitles</span></li><li><img src="chrome-extension://penndbmahnpapepljikkjmakcobdahne/icons/right.png" alt="" class="rightIcon"><span>Unlimited downloads</span></li></ul></div></div></div></div><p style="text-align: center; font-size: 12px; color: rgb(121, 120, 120); margin: 10px 0px;"> TipÔºöPlease refresh the page after the payment is successful </p></div></div></div></div></template></div><div id="vtPopupMenu" style="display: none;"></div></body></html>