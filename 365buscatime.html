<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"></script>
    <title>BetStat</title>
    <meta name="description" content="Transforme suas apostas com BetStat - a única plataforma especializada em futebol virtual Betano. Análises precisas, estatísticas confiáveis e resultados comprovados para investimentos inteligentes." />
    <meta name="keywords" content="BetStat, apostas esportivas, futebol virtual, Betano, estatísticas apostas, análise apostas, investimentos esportivos" />
    <meta property="og:title" content="BetStat | Plataforma de Análise para Apostas Esportivas" />
    <meta property="og:description" content="Transforme suas apostas com análises precisas e estatísticas confiáveis. A única plataforma especializada em futebol virtual Betano." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.betstat.site/payment.html" />
    <meta property="og:site_name" content="BetStat" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="BetStat" />
    <meta name="canonical" href="https://www.betstat.site/payment.html" />
    <script type="module" src="js/firebase-auth.js"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-4WT805FFHQ");
    </script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />

    <style>
      :root {
        --bg-primary: #111318;
        --bg-secondary: #181c23;
        --bg-card: #1e232d;
        --bg-card-hover: #242a36;
        --bg-top: #0d2018;
        --border: #2a3040;
        --border-accent: #1a5c3e;
        --accent: #1fad8b;
        --accent-dim: #147a62;
        --accent-muted: rgba(31, 173, 139, 0.12);
        --text-primary: #e4e8f0;
        --text-secondary: #7a8499;
        --text-accent: #1fad8b;
        --green: #2ecc71;
        --red: #e74c3c;
        --red-bg: #1a0d0d;
        --green-bg: #0a1f16;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: "DM Sans", sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
      }

      /* ── HEADER PLACEHOLDER ── */
      #header { position: sticky; top: 0; z-index: 100; }

      /* ── PAGE WRAPPER ── */
      .page-wrapper {
        max-width: 1600px;
        margin: 0 auto;
        padding: 28px 24px 60px;
      }

      /* ── SECTION TITLE ── */
      .section-title {
        font-size: 0.7rem;
        font-family: "DM Mono", monospace;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: var(--text-accent);
        margin-bottom: 12px;
      }

      /* ── PRÓXIMOS JOGOS ── */
      .upcoming-section {
        margin-bottom: 24px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 20px 24px;
      }

      .games-table {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 8px;
      }

      .game-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px 14px;
        min-width: 220px;
        flex: 1;
        max-width: 280px;
      }

      .game-card.top-match {
        background: var(--bg-top);
        border-color: var(--border-accent);
      }

      .game-card .time {
        font-family: "DM Mono", monospace;
        font-size: 1.05rem;
        color: var(--accent);
        margin-bottom: 6px;
        font-weight: 500;
      }

      .game-card .teams {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.78rem;
        flex-wrap: wrap;
      }

      .game-card .team { color: var(--text-primary); }
      .game-card .team.top-team {
        color: var(--accent);
        font-weight: 600;
      }
      .game-card .vs { color: var(--text-secondary); font-size: 0.72rem; }

      /* ── FILTERS ── */
      .filter-section {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 20px 24px;
        margin-bottom: 24px;
      }

      .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
      }

      .filter-group label {
        display: block;
        font-size: 0.68rem;
        font-family: "DM Mono", monospace;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-accent);
        margin-bottom: 6px;
      }

      .filter-group select {
        width: 100%;
        padding: 8px 10px;
        border-radius: 6px;
        background: var(--bg-card);
        color: var(--text-primary);
        font-family: "DM Sans", sans-serif;
        font-size: 0.85rem;
        border: 1px solid var(--border);
        cursor: pointer;
        outline: none;
        transition: border-color 0.2s;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%237a8499' d='M0 0l5 6 5-6z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        padding-right: 28px;
      }

      .filter-group select:focus { border-color: var(--accent); }
      .filter-group select option { background: #1e232d; }

      /* ── STATS BAR ── */
      .stats-bar {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        margin-bottom: 24px;
      }

      .stat-pill {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px 20px;
        flex: 1;
        min-width: 140px;
        text-align: center;
      }

      .stat-pill .pill-label {
        font-size: 0.65rem;
        font-family: "DM Mono", monospace;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-secondary);
        margin-bottom: 4px;
      }

      .stat-pill .pill-value {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--text-primary);
        font-family: "DM Mono", monospace;
      }

      .stat-pill .pill-value.accent { color: var(--accent); }
      .stat-pill .pill-value.green { color: var(--green); }

      /* ── TEAM CARDS ── */
      .cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
        margin-bottom: 24px;
      }

      .team-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 18px 16px;
        cursor: pointer;
        transition: border-color 0.2s, background 0.2s;
        position: relative;
      }

      .team-card:hover {
        border-color: var(--accent-dim);
        background: var(--bg-card-hover);
      }

      .team-card.top-rank {
        background: var(--bg-top);
        border-color: var(--border-accent);
      }

      .team-card.selected {
        border-color: var(--accent);
        background: var(--bg-card-hover);
      }

      .rank-badge {
        position: absolute;
        top: -1px;
        left: -1px;
        background: var(--accent);
        color: #000;
        font-size: 0.65rem;
        font-family: "DM Mono", monospace;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 9px 0 6px 0;
        letter-spacing: 0.04em;
      }

      .team-card h3 {
        font-size: 0.92rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 14px;
        text-align: center;
        padding-top: 4px;
      }

      .card-stats {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin-bottom: 12px;
      }

      .card-stat {
        text-align: center;
        background: var(--bg-primary);
        border-radius: 6px;
        padding: 6px 4px;
      }

      .card-stat .cs-label {
        font-size: 0.6rem;
        font-family: "DM Mono", monospace;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: var(--text-secondary);
        margin-bottom: 3px;
      }

      .card-stat .cs-value {
        font-size: 1rem;
        font-weight: 600;
        font-family: "DM Mono", monospace;
        color: var(--text-primary);
      }

      .pct-bar-wrap {
        margin-top: 2px;
      }

      .pct-label {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 5px;
      }

      .pct-label span:first-child {
        font-size: 0.62rem;
        font-family: "DM Mono", monospace;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--text-secondary);
      }

      .pct-label span:last-child {
        font-size: 1.4rem;
        font-weight: 600;
        font-family: "DM Mono", monospace;
      }

      .pct-bar {
        height: 4px;
        background: var(--bg-primary);
        border-radius: 2px;
        overflow: hidden;
      }

      .pct-fill {
        height: 100%;
        border-radius: 2px;
        transition: width 0.4s ease;
      }

      /* ── MATCH DETAILS ── */
      #match-details {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 24px;
        margin-top: 8px;
      }

      #match-details h2 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border);
      }

      #match-details ul {
        list-style: none;
        display: grid;
        gap: 8px;
      }

      #match-details li {
        padding: 10px 14px;
        border-radius: 7px;
        font-size: 0.82rem;
        background: var(--bg-card);
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
        border: 1px solid var(--border);
      }

      #match-details li.highlight-green {
        background: var(--green-bg);
        border-color: var(--border-accent);
      }

      #match-details li.highlight-red {
        background: var(--red-bg);
        border-color: #4a1a1a;
      }

      #match-details li .date {
        font-family: "DM Mono", monospace;
        font-size: 0.75rem;
        color: var(--accent);
        min-width: 40px;
      }

      #match-details li .teams {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      #match-details li .team { color: var(--text-primary); font-weight: 500; }

      #match-details li .score {
        font-family: "DM Mono", monospace;
        font-weight: 600;
        color: var(--text-primary);
        background: var(--bg-primary);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .status-badge {
        font-size: 0.68rem;
        font-family: "DM Mono", monospace;
        font-weight: 500;
        padding: 3px 10px;
        border-radius: 4px;
        letter-spacing: 0.06em;
      }

      .status-badge.green { background: rgba(46,204,113,0.15); color: var(--green); border: 1px solid rgba(46,204,113,0.25); }
      .status-badge.red { background: rgba(231,76,60,0.15); color: var(--red); border: 1px solid rgba(231,76,60,0.25); }

      /* ── DIVIDER ── */
      .divider { height: 1px; background: var(--border); margin: 20px 0; }

      /* ── SCROLLBAR ── */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: var(--bg-primary); }
      ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: var(--accent-dim); }

      /* ── RESPONSIVE ── */
      @media (max-width: 768px) {
        .page-wrapper { padding: 16px 14px 40px; }
        .filter-grid { grid-template-columns: 1fr 1fr; }
        .games-table { flex-direction: column; }
        .game-card { max-width: 100%; }
        .cards-container { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
        .card-stats { grid-template-columns: 1fr 1fr 1fr; }
      }

      /* Legacy compat */
      .logo2 { width: 60px; height: auto; }
      .logout-btn {
        background-color: var(--bg-secondary);
        color: white;
        padding: 8px 10px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
        border: 1px solid var(--border);
      }
      .logout-btn:hover { background-color: #720000; }
      button {
        background-color: var(--bg-secondary);
        color: #fff;
        font-family: "DM Sans", sans-serif;
        border: none;
        padding: 5px 8px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        margin: 10px;
      }
      button:hover { background-color: #0f1013; }
    </style>
  </head>

  <body>
    <div id="header"></div>

    <div class="page-wrapper">

      <!-- Próximos Jogos -->
      <div class="upcoming-section">
        <div class="section-title">Próximos Jogos</div>
        <div class="games-table" id="lista-proximos-jogos"></div>
      </div>

      <!-- Filtros -->
      <div class="filter-section">
        <div class="section-title">Parametros de Analise</div>
        <div class="filter-grid">
          <div class="filter-group">
            <label for="league-select">Liga</label>
            <select id="league-select">
              <option value="Copa|https://betstat.site/resultados/bet365/Copa|https://betstat.site/proximos/bet365/Copa" selected>Copa</option>
              <option value="Euro|https://betstat.site/resultados/bet365/Euro|https://betstat.site/proximos/bet365/Euro">Euro</option>
              <option value="Super|https://betstat.site/resultados/bet365/Super|https://betstat.site/proximos/bet365/Super">Super</option>
              <option value="Premier|https://betstat.site/resultados/bet365/Premier|https://betstat.site/proximos/bet365/Premier">Premier</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="lines-select">Janela de Tempo</label>
            <select id="lines-select">
              <option value="60">3 horas</option>
              <option value="120" selected>6 horas</option>
              <option value="240">12 horas</option>
              <option value="480">24 horas</option>
              <option value="960">48 horas</option>
              <option value="1440">72 horas</option>
              <option value="1920">96 horas</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="qual-select">Posicao</label>
            <select id="qual-select">
              <option value="ambos" selected>Casa e Fora</option>
              <option value="casa">Casa</option>
              <option value="fora">Fora</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="filter-select">Mercado</label>
            <select id="filter-select">
              <option value="casavence">Casa Vence</option>
              <option value="empate">Empate</option>
              <option value="foravence">Fora Vence</option>
              <option value="bothscoreunder" selected>Ambas Sim</option>
              <option value="ambnao">Ambas Nao</option>
              <option value="over1.5">Over 1.5</option>
              <option value="over2.5">Over 2.5</option>
              <option value="over3.5">Over 3.5</option>
              <option value="under1.5">Under 1.5</option>
              <option value="under2.5">Under 2.5</option>
              <option value="under3.5">Under 3.5</option>
              <option value="exact0">0 Gol Exato</option>
              <option value="exact1">1 Gol Exato</option>
              <option value="exact2">2 Gols Exatos</option>
              <option value="exact3">3 Gols Exatos</option>
              <option value="exact4">4 Gols Exatos</option>
              <option value="5plus">5 Gols ou Mais</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="offset-select">Gales</label>
            <select id="offset-select">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="offset-select2">1 tiro</label>
            <select id="offset-select2">
              <option value="-1" selected>Antes</option>
              <option value="0">Time</option>
              <option value="1">Depois</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Stats Bar -->
      <div class="stats-bar" id="stats-bar">
        <div class="stat-pill">
          <div class="pill-label">Times Analisados</div>
          <div class="pill-value accent" id="total-teams">—</div>
        </div>
        <div class="stat-pill">
          <div class="pill-label">Total de Jogos</div>
          <div class="pill-value" id="total-games">—</div>
        </div>
        <div class="stat-pill">
          <div class="pill-label">Media Green</div>
          <div class="pill-value green" id="avg-green">—</div>
        </div>
        <div class="stat-pill">
          <div class="pill-label">Melhor Time</div>
          <div class="pill-value accent" id="best-team">—</div>
        </div>
        <div class="stat-pill">
          <div class="pill-label">Mercado</div>
          <div class="pill-value" id="current-market" style="font-size:0.85rem; padding-top:4px;">—</div>
        </div>
      </div>

      <!-- Team Cards -->
      <div class="section-title">Ranking de Times</div>
      <div class="cards-container" id="team-cards"></div>

      <!-- Match Details -->
      <div id="match-details" style="display: none;">
        <div id="match-details-content"></div>
      </div>
    </div>

    <script>
      let teamStats = {};
      let matchDetails = {};
      let topTeams = [];
      let selectedTeam = null;

      const MARKET_LABELS = {
        casavence: 'Casa Vence',
        empate: 'Empate',
        foravence: 'Fora Vence',
        bothscoreunder: 'Ambas Sim',
        ambnao: 'Ambas Nao',
        'over1.5': 'Over 1.5',
        'over2.5': 'Over 2.5',
        'over3.5': 'Over 3.5',
        'under1.5': 'Under 1.5',
        'under2.5': 'Under 2.5',
        'under3.5': 'Under 3.5',
        exact0: '0 Gol Exato',
        exact1: '1 Gol Exato',
        exact2: '2 Gols Exatos',
        exact3: '3 Gols Exatos',
        exact4: '4 Gols Exatos',
        '5plus': '5 Gols ou Mais',
      };

      document.addEventListener('DOMContentLoaded', () => {
        loadData();
        setInterval(updateDynamicData, 60000);
      });

      const filterElements = ['league-select', 'lines-select', 'filter-select', 'qual-select', 'offset-select', 'offset-select2'];
      filterElements.forEach(id => {
        document.getElementById(id).addEventListener('change', loadData);
      });

      async function loadData() {
        teamStats = {};
        matchDetails = {};
        const [league, resultsUrl, nextGamesUrl] = document.getElementById('league-select').value.split('|');
        const lines = parseInt(document.getElementById('lines-select').value);
        const market = document.getElementById('filter-select').value;
        const offsetLimit = parseInt(document.getElementById('offset-select').value);
        const offsetStart = parseInt(document.getElementById('offset-select2').value);
        const escolhe = document.getElementById('qual-select').value;

        try {
          const response = await fetch(resultsUrl);
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const data = await response.json();
          const recentMatches = data.slice(-lines);
          processMatchData(recentMatches, escolhe, offsetLimit, offsetStart, market);
          renderTeamCards(market);
          updateStatsBar(market);
          await loadProximosJogos(nextGamesUrl);
          document.getElementById('match-details').style.display = 'none';
          selectedTeam = null;
        } catch (error) {
          console.error('Erro ao carregar os dados:', error);
        }
      }

      async function updateDynamicData() {
        const [league, resultsUrl, nextGamesUrl] = document.getElementById('league-select').value.split('|');
        const lines = parseInt(document.getElementById('lines-select').value);
        const market = document.getElementById('filter-select').value;
        const offsetLimit = parseInt(document.getElementById('offset-select').value);
        const offsetStart = parseInt(document.getElementById('offset-select2').value);
        const escolhe = document.getElementById('qual-select').value;

        try {
          const response = await fetch(resultsUrl);
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const data = await response.json();
          const recentMatches = data.slice(-lines);
          teamStats = {};
          matchDetails = {};
          processMatchData(recentMatches, escolhe, offsetLimit, offsetStart, market);
          updateTeamCards(market);
          updateStatsBar(market);
          await loadProximosJogos(nextGamesUrl);
        } catch (error) {
          console.error('Erro ao atualizar os dados:', error);
        }
      }

      function processMatchData(matches, escolhe, offsetLimit, offsetStart, market) {
        matches.forEach((match, index) => {
          if (escolhe === 'ambos' || escolhe === 'casa') processTeam(match.time_a, matches, index, offsetLimit, offsetStart, market);
          if (escolhe === 'ambos' || escolhe === 'fora') processTeam(match.time_b, matches, index, offsetLimit, offsetStart, market);
        });
      }

      function processTeam(team, matches, currentIndex, offsetLimit, offsetStart, market) {
        if (!teamStats[team]) teamStats[team] = { games: 0, greens: 0, reds: 0, totalGoals: 0 };
        teamStats[team].games++;
        if (!matchDetails[team]) matchDetails[team] = [];

        const matchData = [];
        let hasGreen = false;
        let allRed = true;

        for (let offset = offsetStart; offset < offsetStart + offsetLimit; offset++) {
          const index = currentIndex + offset;
          if (index >= 0 && index < matches.length) {
            const match = matches[index];
            const [goalsHome, goalsAway] = match.ft.split(' x ').map(Number);
            const totalGoals = goalsHome + goalsAway;
            teamStats[team].totalGoals = (teamStats[team].totalGoals || 0) + totalGoals;
            const gameStatus = checkMarketCondition(goalsHome, goalsAway, totalGoals, market) ? 'Green' : 'Red';
            if (gameStatus === 'Green') hasGreen = true;
            else allRed = false;
            const matchDate = new Date(match.data);
            const formattedDate = `${matchDate.getDate().toString().padStart(2, '0')}/${(matchDate.getMonth() + 1).toString().padStart(2, '0')}`;
            matchData.push(`${formattedDate} - ${match.time_a} ${goalsHome} x ${goalsAway} ${match.time_b} (${gameStatus})`);
          }
        }

        const className = hasGreen ? 'highlight-green' : allRed ? 'highlight-red' : '';
        matchDetails[team].push({ data: matchData.join(' | '), className });
        if (hasGreen) teamStats[team].greens++;
        else teamStats[team].reds++;
      }

      function getSortedTeams() {
        return Object.entries(teamStats)
          .map(([team, stats]) => ({
            team,
            games: stats.games,
            greens: stats.greens,
            reds: stats.reds || 0,
            totalGoals: stats.totalGoals || 0,
            percentage: (stats.greens / stats.games * 100).toFixed(0),
            avgGoals: stats.games > 0 ? (stats.totalGoals / stats.games).toFixed(1) : '0.0',
          }))
          .sort((a, b) => parseInt(b.percentage) === parseInt(a.percentage) ? b.games - a.games : parseInt(b.percentage) - parseInt(a.percentage))
          .slice(0, 21);
      }

      function getPctColor(pct) {
        if (pct >= 80) return '#2ecc71';
        if (pct >= 60) return '#1fad8b';
        if (pct >= 40) return '#e6a817';
        return '#e74c3c';
      }

      function updateStatsBar(market) {
        const sorted = getSortedTeams();
        const totalGames = sorted.reduce((s, t) => s + t.games, 0);
        const avgGreen = sorted.length > 0
          ? (sorted.reduce((s, t) => s + parseInt(t.percentage), 0) / sorted.length).toFixed(0) + '%'
          : '—';
        document.getElementById('total-teams').textContent = sorted.length;
        document.getElementById('total-games').textContent = totalGames;
        document.getElementById('avg-green').textContent = avgGreen;
        document.getElementById('best-team').textContent = sorted.length > 0 ? sorted[0].team : '—';
        document.getElementById('current-market').textContent = MARKET_LABELS[market] || market;
      }

      function renderTeamCards(market) {
        const cardsContainer = document.getElementById('team-cards');
        cardsContainer.innerHTML = '';
        const sortedTeams = getSortedTeams();
        topTeams = sortedTeams.slice(0, 5).map(t => normalizeTeamName(t.team));

        sortedTeams.forEach((teamData, index) => {
          const pct = parseInt(teamData.percentage);
          const card = document.createElement('div');
          card.className = `team-card ${index < 5 ? 'top-rank' : ''}`;
          card.dataset.team = teamData.team;

          const rankLabel = index < 5 ? `<div class="rank-badge">#${index + 1}</div>` : '';
          card.innerHTML = `
            ${rankLabel}
            <h3>${teamData.team}</h3>
            <div class="card-stats">
              <div class="card-stat">
                <div class="cs-label">Jogos</div>
                <div class="cs-value">${teamData.games}</div>
              </div>
              <div class="card-stat">
                <div class="cs-label">Green</div>
                <div class="cs-value" style="color:var(--green)">${teamData.greens}</div>
              </div>
              <div class="card-stat">
                <div class="cs-label">Gols/J</div>
                <div class="cs-value">${teamData.avgGoals}</div>
              </div>
            </div>
            <div class="pct-bar-wrap">
              <div class="pct-label">
                <span>Taxa Green</span>
                <span style="color:${getPctColor(pct)}">${teamData.percentage}%</span>
              </div>
              <div class="pct-bar">
                <div class="pct-fill" style="width:${teamData.percentage}%; background:${getPctColor(pct)}"></div>
              </div>
            </div>
          `;
          card.addEventListener('click', () => toggleMatchDetails(teamData.team, card));
          cardsContainer.appendChild(card);
        });
      }

      function updateTeamCards(market) {
        const sortedTeams = getSortedTeams();
        topTeams = sortedTeams.slice(0, 5).map(t => normalizeTeamName(t.team));
        const cards = document.querySelectorAll('.team-card');
        cards.forEach((card, index) => {
          if (index < sortedTeams.length) {
            const teamData = sortedTeams[index];
            const pct = parseInt(teamData.percentage);
            card.className = `team-card ${index < 5 ? 'top-rank' : ''} ${selectedTeam === teamData.team ? 'selected' : ''}`;
            card.dataset.team = teamData.team;
            const rankLabel = index < 5 ? `<div class="rank-badge">#${index + 1}</div>` : '';
            card.innerHTML = `
              ${rankLabel}
              <h3>${teamData.team}</h3>
              <div class="card-stats">
                <div class="card-stat">
                  <div class="cs-label">Jogos</div>
                  <div class="cs-value">${teamData.games}</div>
                </div>
                <div class="card-stat">
                  <div class="cs-label">Green</div>
                  <div class="cs-value" style="color:var(--green)">${teamData.greens}</div>
                </div>
                <div class="card-stat">
                  <div class="cs-label">Gols/J</div>
                  <div class="cs-value">${teamData.avgGoals}</div>
                </div>
              </div>
              <div class="pct-bar-wrap">
                <div class="pct-label">
                  <span>Taxa Green</span>
                  <span style="color:${getPctColor(pct)}">${teamData.percentage}%</span>
                </div>
                <div class="pct-bar">
                  <div class="pct-fill" style="width:${teamData.percentage}%; background:${getPctColor(pct)}"></div>
                </div>
              </div>
            `;
          }
        });
      }

      function toggleMatchDetails(team, cardEl) {
        const detailsDiv = document.getElementById('match-details');
        document.querySelectorAll('.team-card').forEach(c => c.classList.remove('selected'));
        if (selectedTeam === team && detailsDiv.style.display === 'block') {
          detailsDiv.style.display = 'none';
          selectedTeam = null;
        } else {
          if (cardEl) cardEl.classList.add('selected');
          showMatchDetails(team);
          selectedTeam = team;
        }
      }

      function showMatchDetails(team) {
        const detailsDiv = document.getElementById('match-details');
        const detailsContent = document.getElementById('match-details-content');
        detailsContent.innerHTML = '';

        const title = document.createElement('h2');
        title.textContent = `Historico de Jogos — ${team}`;
        detailsContent.appendChild(title);

        if (matchDetails[team] && matchDetails[team].length > 0) {
          const greenCount = matchDetails[team].filter(d => d.className === 'highlight-green').length;
          const total = matchDetails[team].length;
          const pct = ((greenCount / total) * 100).toFixed(0);

          const summary = document.createElement('div');
          summary.style.cssText = 'display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap';
          summary.innerHTML = `
            <div class="stat-pill" style="min-width:120px;flex:0">
              <div class="pill-label">Entradas</div>
              <div class="pill-value">${total}</div>
            </div>
            <div class="stat-pill" style="min-width:120px;flex:0">
              <div class="pill-label">Greens</div>
              <div class="pill-value green">${greenCount}</div>
            </div>
            <div class="stat-pill" style="min-width:120px;flex:0">
              <div class="pill-label">Taxa</div>
              <div class="pill-value" style="color:${getPctColor(parseInt(pct))}">${pct}%</div>
            </div>
          `;
          detailsContent.appendChild(summary);

          const ul = document.createElement('ul');
          matchDetails[team].forEach(detail => {
            const li = document.createElement('li');
            li.className = detail.className;
            const matches = detail.data.split(' | ');
            matches.forEach(match => {
              const [date, rest] = match.split(' - ');
              const statusMatch = rest.match(/\((Green|Red)\)$/);
              const status = statusMatch ? statusMatch[1] : '';
              const gameStr = rest.replace(/ \((Green|Red)\)$/, '');
              const scoreMatch = gameStr.match(/(\d+ x \d+)/);
              const score = scoreMatch ? scoreMatch[1] : '';
              const parts = gameStr.split(/ \d+ x \d+ /);
              const homeTeam = parts[0] || '';
              const awayTeam = parts[1] || '';

              const matchDiv = document.createElement('div');
              matchDiv.style.cssText = 'display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex:1';
              matchDiv.innerHTML = `
                <span class="date">${date}</span>
                <span class="teams">
                  <span class="team">${homeTeam}</span>
                  <span class="score">${score}</span>
                  <span class="team">${awayTeam}</span>
                </span>
                <span class="status-badge ${status === 'Green' ? 'green' : 'red'}">${status}</span>
              `;
              li.appendChild(matchDiv);
            });
            ul.appendChild(li);
          });
          detailsContent.appendChild(ul);
        } else {
          const noData = document.createElement('p');
          noData.textContent = 'Nenhum jogo encontrado.';
          noData.style.color = 'var(--text-secondary)';
          detailsContent.appendChild(noData);
        }

        detailsDiv.style.display = 'block';
        detailsDiv.scrollIntoView({ behavior: 'smooth' });
      }

      function checkMarketCondition(goalsHome, goalsAway, goals, market) {
        switch (market) {
          case '5plus':      return goals >= 5;
          case 'over3.5':    return goals > 3.5;
          case 'over2.5':    return goals > 2.5;
          case 'over1.5':    return goals > 1.5;
          case 'under1.5':   return goals < 1.5;
          case 'under2.5':   return goals < 2.5;
          case 'under3.5':   return goals < 3.5;
          case 'exact0':     return goals === 0;
          case 'exact1':     return goals === 1;
          case 'exact2':     return goals === 2;
          case 'exact3':     return goals === 3;
          case 'exact4':     return goals === 4;
          case 'bothscoreunder': return (goalsHome > 0 && goalsAway > 0);
          case 'ambnao':     return (goalsHome === 0 || goalsAway === 0);
          case 'casavence':  return (goalsHome > goalsAway);
          case 'foravence':  return (goalsHome < goalsAway);
          case 'empate':     return (goalsHome === goalsAway);
          default: return false;
        }
      }

      function normalizeTeamName(teamName) {
        if (!teamName) return '';
        return teamName.trim().replace(/\s+/g, ' ');
      }

      async function loadProximosJogos(nextGamesUrl) {
        try {
          const response = await fetch(nextGamesUrl);
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const data = await response.json();
          updateProximosJogos(data.slice(0, 6));
        } catch (error) {
          console.error('Erro ao carregar proximos jogos:', error);
        }
      }

      function extractTimeFromDateTime(dateTimeStr) {
        if (!dateTimeStr || isNaN(new Date(dateTimeStr))) return '--:--';
        const date = new Date(dateTimeStr);
        return `${date.getUTCHours().toString().padStart(2,'0')}:${date.getUTCMinutes().toString().padStart(2,'0')}`;
      }

      function updateProximosJogos(proximosJogos) {
        const lista = document.getElementById('lista-proximos-jogos');
        lista.innerHTML = '';
        if (!proximosJogos || proximosJogos.length === 0) {
          lista.innerHTML = '<div class="game-card">Nenhum jogo disponivel</div>';
          return;
        }
        proximosJogos.forEach(jogo => {
          const time = jogo.time && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(jogo.time)
            ? jogo.time
            : extractTimeFromDateTime(jogo.start_time);
          const homeTeam = normalizeTeamName(jogo.team_home);
          const awayTeam = normalizeTeamName(jogo.team_visit);
          const isTopMatch = topTeams.includes(homeTeam) || topTeams.includes(awayTeam);
          const card = document.createElement('div');
          card.className = `game-card ${isTopMatch ? 'top-match' : ''}`;
          card.innerHTML = `
            <div class="time">${time}</div>
            <div class="teams">
              <span class="team ${topTeams.includes(homeTeam) ? 'top-team' : ''}">${homeTeam}</span>
              <span class="vs">×</span>
              <span class="team ${topTeams.includes(awayTeam) ? 'top-team' : ''}">${awayTeam}</span>
            </div>
          `;
          lista.appendChild(card);
        });
      }
    </script>

    <script>
      fetch('header.html')
        .then(r => r.text())
        .then(d => { document.getElementById('header').innerHTML = d; });
    </script>
    <script src="redirecionar.js"></script>

    <script>
      document.addEventListener("contextmenu", e => e.preventDefault());
      document.addEventListener("keydown", function(e) {
        if (e.key === "F12") e.preventDefault();
        if (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) e.preventDefault();
        if (e.ctrlKey && ["u","s","p"].includes(e.key)) e.preventDefault();
      });
      const devtools = { open: false };
      const element = new Image();
      Object.defineProperty(element, 'id', { get: function() { devtools.open = true; } });
      (function() {
        const threshold = 160;
        const checkDevTools = function() {
          if ((window.outerWidth - window.innerWidth) > threshold || (window.outerHeight - window.innerHeight) > threshold)
            devtools.open = true;
        };
        window.addEventListener('resize', checkDevTools);
        setInterval(checkDevTools, 500);
      })();
      console.log('%c', element);
      setInterval(function() {
        if (devtools.open) {
          document.body.innerHTML = '<h1>Acesso nao autorizado detectado</h1>';
          devtools.open = false;
        }
      }, 1000);
      document.addEventListener('selectstart', e => e.preventDefault());
      document.addEventListener('dragstart', e => e.preventDefault());
      console.log = function() {};
      console.debug = function() {};
      console.info = function() {};
    </script>
  </body>
</html>