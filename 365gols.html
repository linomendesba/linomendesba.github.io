<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"></script>
  <title>BetStat</title>
  <meta name="description" content="Transforme suas apostas com BetStat - a única plataforma especializada em futebol virtual Betano." />
  <meta name="keywords" content="BetStat, apostas esportivas, futebol virtual, Betano, estatísticas apostas" />
  <meta property="og:title" content="BetStat | Plataforma de Análise para Apostas Esportivas" />
  <meta property="og:description" content="Transforme suas apostas com análises precisas e estatísticas confiáveis." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.betstat.site/payment.html" />
  <meta property="og:site_name" content="BetStat" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="BetStat" />
  <script type="module" src="js/firebase-auth.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-4WT805FFHQ");
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary-bg:      #121212;
      --secondary-bg:    #1e1e1e;
      --header-bg:       #1a1a1a;
      --table-header-bg: #2a2a2a;
      --hover-bg:        #2d2d2d;
      --border-color:    #2c2c2c;
      --border-light:    #3a3a3a;
      --text-color:      #f5f5f5;
      --muted:           #8a8f9a;
      --green:           #005540;
      --green-soft:      rgba(0, 120, 80, 0.15);
      --green-border:    rgba(0, 150, 100, 0.4);
      --yellow:          #a19f01;
      --yellow-soft:     rgba(180, 170, 0, 0.15);
      --yellow-border:   rgba(180, 170, 0, 0.4);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      font-size: 14px;
      background-color: var(--primary-bg);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      max-width: 1800px;
      margin: 0 auto;
    }

    .header-spacer { height: 60px; }

    /* ── CONTROLES ── */
    .controls {
      display: flex;
      align-items: flex-end;
      gap: 16px;
      background-color: var(--secondary-bg);
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .control-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.7px;
    }

    select {
      padding: 8px 30px 8px 12px;
      background-color: var(--header-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: border-color 0.2s;
      appearance: none;
      font-family: 'Roboto', Arial, sans-serif;
      font-size: 14px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      min-width: 180px;
    }

    select:hover { border-color: var(--border-light); }
    select:focus { outline: none; border-color: #555; }
    option { background-color: var(--header-bg); color: var(--text-color); }

    /* ── KPI ROW ── */
    .kpi-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .kpi-card {
      background-color: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 14px 18px;
    }

    .kpi-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.7px;
      margin-bottom: 6px;
    }

    .kpi-value {
      font-size: 26px;
      font-weight: 700;
      color: var(--text-color);
      line-height: 1;
      margin-bottom: 4px;
    }

    .kpi-sub {
      font-size: 12px;
      color: var(--muted);
    }

    /* ── LAYOUT PRINCIPAL ── */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ── SEÇÕES ── */
    .section-box {
      background-color: var(--secondary-bg);
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .section-title {
      background-color: var(--header-bg);
      padding: 10px 15px;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-color);
      border-bottom: 1px solid var(--border-color);
    }

    /* ── PRÓXIMOS JOGOS — GRID 6 COLUNAS ── */
    .games-table {
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);   /* ← 6 colunas lado a lado */
      gap: 12px;
    }

    .game-row {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 14px 10px;
      background-color: var(--header-bg);
      border-radius: 6px;
      border: 1px solid var(--border-color);
      gap: 8px;
      transition: transform 0.15s, background-color 0.15s;
      text-align: center;
      min-width: 0; 
    }

    .game-row:hover { 
      background-color: var(--hover-bg); 
      transform: translateY(-2px);
    }

    .game-time {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-color);
      font-variant-numeric: tabular-nums;
    }

    .game-teams {
      font-size: 13px;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .signal-tag {
      font-size: 10px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 4px;
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      margin-top: 4px;
    }

    .tag-high {
      background-color: var(--green-soft);
      color: #00c880;
      border: 1px solid var(--green-border);
    }

    .tag-mid {
      background-color: var(--yellow-soft);
      color: #cfc800;
      border: 1px solid var(--yellow-border);
    }

    .game-row.highlight-green {
      border-top: 4px solid var(--green);
      background-color: var(--green-soft);
    }

    .game-row.highlight-red {
      border-top: 4px solid var(--yellow);
      background-color: var(--yellow-soft);
    }

    /* ── LAYOUT INFERIOR (RANKING + DETALHES) ── */
    .bottom-layout {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .ranking-wrapper {
      flex: 1;
      min-width: 0;
    }

    /* ── ANÁLISE MERCADOS ── */
    .market-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1px;
      background-color: var(--border-color);
    }

    .market-cell {
      background-color: var(--secondary-bg);
      padding: 12px;
      text-align: center;
    }

    .market-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .market-pct {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-color);
      line-height: 1;
      margin-bottom: 4px;
    }

    .market-count {
      font-size: 11px;
      color: var(--muted);
    }

    .bar-track {
      height: 4px;
      background-color: var(--border-color);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      border-radius: 2px;
      background-color: #3a7a5a;
      transition: width 0.5s ease;
    }

    .bar-fill.high { background-color: #00c880; }
    .bar-fill.mid  { background-color: #cfc800; }

    /* ── RANKING ── */
    .ranking-section {
      background-color: var(--secondary-bg);
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .top-team-bar {
      background-color: var(--header-bg);
      padding: 10px 15px;
      font-size: 13px;
      color: var(--muted);
      border-bottom: 1px solid var(--border-color);
    }

    .top-team-bar strong { color: var(--text-color); }

    .ranking-table {
      width: 100%;
      border-collapse: collapse;
    }

    .ranking-table thead th {
      background-color: var(--table-header-bg);
      padding: 10px 12px;
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      transition: color 0.15s;
    }

    .ranking-table thead th:hover { color: var(--text-color); }
    .ranking-table thead th:not(:first-child) { text-align: center; }

    .ranking-table tbody tr {
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background-color 0.15s;
    }

    .ranking-table tbody tr:hover td { background-color: var(--hover-bg); }
    .ranking-table tbody tr:last-child { border-bottom: none; }

    .ranking-table td {
      padding: 10px 12px;
      font-size: 13px;
    }

    .ranking-table td:not(:first-child) { text-align: center; }

    .rank-pos {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      background-color: var(--table-header-bg);
      color: var(--muted);
      margin-right: 8px;
    }

    .pct-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
    }

    .pct-high { background-color: var(--green-soft); color: #00c880; }
    .pct-mid  { background-color: var(--yellow-soft); color: #cfc800; }
    .pct-low  { background-color: var(--header-bg); color: var(--muted); }

    .highlight-green td { background-color: var(--green-soft); }
    .highlight-green td:first-child { border-left: 3px solid var(--green); }
    .highlight-red td   { background-color: var(--yellow-soft); }
    .highlight-red td:first-child { border-left: 3px solid var(--yellow); }

    /* ── DETALHES TIME ── */
    .team-details {
      width: 340px;
      flex-shrink: 0;
      background-color: var(--secondary-bg);
      border-radius: 8px;
      border: 1px solid var(--border-color);
      overflow: hidden;
      display: none;
    }

    .team-details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: var(--header-bg);
      border-bottom: 1px solid var(--border-color);
      font-size: 13px;
    }

    .team-name { font-weight: 700; color: var(--text-color); }

    .close-details {
      cursor: pointer;
      font-size: 16px;
      color: var(--muted);
      padding: 2px 6px;
      border-radius: 4px;
      transition: color 0.15s;
    }

    .close-details:hover { color: var(--text-color); }

    .game-details { padding: 10px; display: grid; gap: 6px; }

    .game-detail {
      background-color: var(--header-bg);
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .detail-info { color: var(--muted); }
    .detail-opp  { flex: 1; color: var(--text-color); }

    .goal-tag {
      font-size: 12px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .goal-high { background-color: var(--green-soft); color: #00c880; border: 1px solid var(--green-border); }
    .goal-low  { background-color: var(--yellow-soft); color: #cfc800; border: 1px solid var(--yellow-border); }

    /* ── RESPONSIVE ── */
    @media (max-width: 1400px) {
      .games-table { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 1100px) {
      .kpi-row { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 900px) {
      .bottom-layout { flex-direction: column; }
      .team-details { width: 100%; }
    }

    @media (max-width: 700px) {
      .games-table { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 600px) {
      .kpi-row { grid-template-columns: 1fr 1fr; }
      .market-grid { grid-template-columns: 1fr; }
      body { padding: 12px; }
      .games-table { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div id="header"></div>
  <div class="header-spacer"></div>

  <div class="controls">
    <div class="control-group">
      <span class="control-label">Liga</span>
      <select id="league-select">
            <option value="Copa|https://betstat.site/resultados/bet365/Copa|https://betstat.site/proximos/bet365/Copa" selected>Copa</option>

            <option value="Euro|https://betstat.site/resultados/bet365/Euro|https://betstat.site/proximos/bet365/Euro">Euro</option>

            <option value="Super|https://betstat.site/resultados/bet365/Super|https://betstat.site/proximos/bet365/Super">Super</option>

            <option value="Premier|https://betstat.site/resultados/bet365/Premier|https://betstat.site/proximos/bet365/Premier">Premier</option>
      </select>
    </div>
    <div class="control-group">
      <span class="control-label">Período</span>
      <select id="lines-select">
        <option value="20">1 hora</option>
        <option value="40">2 horas</option>
        <option value="60">3 horas</option>
        <option value="80">4 horas</option>
        <option value="120">6 horas</option>
        <option value="180">9 horas</option>
        <option value="240" selected>12 horas</option>
        <option value="480">24 horas</option>
        <option value="960">48 horas</option>
        <option value="1440">72 horas</option>
        <option value="1920">96 horas</option>
      </select>
    </div>
  </div>

  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-label">Jogos analisados</div>
      <div class="kpi-value" id="kpi-games">—</div>
      <div class="kpi-sub">no período selecionado</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Média de gols</div>
      <div class="kpi-value" id="kpi-avg">—</div>
      <div class="kpi-sub">gols por partida</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Maior pontuação</div>
      <div class="kpi-value" id="kpi-max">—</div>
      <div class="kpi-sub" id="kpi-max-sub">gols em uma partida</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Melhor equipe</div>
      <div class="kpi-value" id="kpi-best-avg" style="font-size:18px">—</div>
      <div class="kpi-sub" id="kpi-best-name">gols/jogo (contexto)</div>
    </div>
  </div>

  <div class="main-content">

    <div class="section-box">
      <div class="section-title">Análise de Mercados — Período Selecionado</div>
      <div class="market-grid" id="market-grid"></div>
    </div>

    <div class="section-box">
      <div class="section-title">Próximos Jogos</div>
      <div class="games-table" id="lista-proximos-jogos">
        <div style="padding:16px;color:var(--muted);text-align:center;font-size:13px;grid-column:1/-1;">Carregando...</div>
      </div>
    </div>

    <div class="bottom-layout">
      <div class="ranking-wrapper">
        <div class="ranking-section">
          <div class="top-team-bar" id="top-team-stats">Carregando...</div>
          <div class="section-title">Top 10 Equipes</div>
          <table class="ranking-table" id="ranking-table">
            <thead>
              <tr>
                <th onclick="sortTable(0)">Equipe</th>
                <th onclick="sortTable(1)">Jogos</th>
                <th onclick="sortTable(2)">Gols</th>
                <th onclick="sortTable(3)">Media</th>
                <th onclick="sortTable(4)">Over 2.5</th>
                <th onclick="sortTable(5)">Over 3.5</th>
                <th onclick="sortTable(6)">5+ Gols</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="team-details" id="team-details">
        <div class="team-details-header">
          <span>Detalhes: <span class="team-name" id="team-name"></span></span>
          <span class="close-details" id="close-details">✕</span>
        </div>
        <div class="game-details" id="team-games"></div>
      </div>
    </div>

  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {

    const leagueSelect     = document.getElementById('league-select');
    const linesSelect      = document.getElementById('lines-select');
    const rankingTableBody = document.getElementById('ranking-table').querySelector('tbody');
    const teamDetails      = document.getElementById('team-details');
    const teamNameElem     = document.getElementById('team-name');
    const teamGamesElem    = document.getElementById('team-games');
    const closeDetails     = document.getElementById('close-details');
    const topTeamStats     = document.getElementById('top-team-stats');

    let teams = {};
    let currentTeam = null;

    leagueSelect.addEventListener('change', loadAndDisplayData);
    linesSelect.addEventListener('change',  loadAndDisplayData);
    closeDetails.addEventListener('click', () => {
      teamDetails.style.display = 'none';
      currentTeam = null;
    });
    loadAndDisplayData();

    /* ── NORMALIZAÇÃO ── */
    function norm(name) {
      if (!name) return '';
      return name.trim().replace(/\s+/g, ' ');
    }

    /* ── FORMATO DATA ── */
    function fmtDT(game) {
      const d   = new Date(game.data);
      const day = String(d.getDate()).padStart(2, '0');
      const mon = String(d.getMonth() + 1).padStart(2, '0');
      const hr  = String(game.hora).padStart(2, '0');
      const min = String(game.minuto).padStart(2, '0');
      return `${day}/${mon} ${hr}:${min}`;
    }

    /* ── CARGA PRINCIPAL ── */
    function loadAndDisplayData() {
      const [, resultsUrl, nextGamesUrl] = leagueSelect.value.split('|');
      const linha = parseInt(linesSelect.value);

      fetch(resultsUrl)
        .then(r => r.json())
        .then(data => {
          const rows = data.slice(-linha);
          teams = {};

          rows.forEach((game, index) => {
            const t1 = norm(game.time_a);
            const t2 = norm(game.time_b);
            const [g1, g2] = game.ft.split(' x ').map(Number);
            const total    = g1 + g2;

            [t1, t2].forEach(t => ensureTeam(t));

            // Para cada time envolvido no jogo[index], somamos os gols de:
            //   - jogo anterior no calendário geral (index-1)
            //   - jogo atual (index)
            //   - jogo seguinte no calendário geral (index+1)
            // Isso representa "o ambiente de gols ao redor daquele confronto".
            // A média points/(3*games) dá a média de gols por janela de 3 jogos.
            [t1, t2].forEach(t => {
              teams[t].games++;
              teams[t].goals += total;
              if (total > 2)  teams[t].over25++;
              if (total > 3)  teams[t].over35++;
              if (total >= 5) teams[t].over5++;

              // Janela de 3: jogo anterior + atual + próximo
              let ctxGoals = total;
              if (index > 0) {
                const prev = rows[index - 1].ft.split(' x ').map(Number);
                ctxGoals += prev[0] + prev[1];
              }
              if (index < rows.length - 1) {
                const next = rows[index + 1].ft.split(' x ').map(Number);
                ctxGoals += next[0] + next[1];
              }
              teams[t].points += ctxGoals;

              // Detalhe do jogo para o painel de detalhes
              const opp     = t === t1 ? t2 : t1;
              const dateStr = fmtDT(game);
              const dup = teams[t].details.find(d => d.date === dateStr && d.opponent === opp);
              if (!dup) {
                teams[t].details.push({ date: dateStr, opponent: opp, score: total });
              }
            });
          });

          updateKPIs(rows);
          updateMarkets(rows);
          updateRankingTable();
          updateTopTeamStats();
          loadProximosJogos(nextGamesUrl);

          if (currentTeam) showTeamDetails(currentTeam);
        })
        .catch(e => console.error('Erro resultados:', e));
    }

    function ensureTeam(t) {
      if (!teams[t]) {
        teams[t] = { games: 0, goals: 0, points: 0, over25: 0, over35: 0, over5: 0, details: [] };
      }
    }

    /* ── KPIs ── */
    function updateKPIs(rows) {
      const total  = rows.length || 1;
      const goals  = rows.reduce((s, r) => {
        return s + r.ft.split(' x ').map(Number).reduce((a, b) => a + b, 0);
      }, 0);

      const maxGoals = rows.reduce((m, r) => {
        const g = r.ft.split(' x ').map(Number).reduce((a, b) => a + b, 0);
        return g > m ? g : m;
      }, 0);

      document.getElementById('kpi-games').textContent = rows.length;
      document.getElementById('kpi-avg').textContent   = (goals / total).toFixed(2);
      document.getElementById('kpi-max').textContent   = maxGoals;

      const best = Object.entries(teams).sort((a, b) => {
        const scoreA = a[1].games ? a[1].points / (3 * a[1].games) : 0;
        const scoreB = b[1].games ? b[1].points / (3 * b[1].games) : 0;
        return scoreB - scoreA;
      })[0];

      if (best) {
        const avg = (best[1].points / (3 * best[1].games)).toFixed(2);
        document.getElementById('kpi-best-avg').textContent  = avg;
        document.getElementById('kpi-best-name').textContent = best[0];
      }
    }

    /* ── MERCADOS ── */
    function updateMarkets(rows) {
      const total   = rows.length || 1;
      const markets = [
        { label: 'Over 2.5', fn: v => v > 2 },
        { label: 'Over 3.5', fn: v => v > 3 },
        { label: '5+ Gols',  fn: v => v >= 5 },
      ];

      const grid = document.getElementById('market-grid');
      grid.innerHTML = '';

      markets.forEach(m => {
        const cnt = rows.filter(r =>
          m.fn(r.ft.split(' x ').map(Number).reduce((a, b) => a + b, 0))
        ).length;
        const pct      = ((cnt / total) * 100).toFixed(0);
        const barClass = pct >= 60 ? 'high' : pct >= 40 ? 'mid' : '';
        const cell     = document.createElement('div');
        cell.className = 'market-cell';
        cell.innerHTML = `
          <div class="market-name">${m.label}</div>
          <div class="market-pct">${pct}%</div>
          <div class="market-count">${cnt} de ${total} jogos</div>
          <div class="bar-track"><div class="bar-fill ${barClass}" style="width:${pct}%"></div></div>`;
        grid.appendChild(cell);
      });
    }

    /* ── RANKING ── */
    function getSortedTeams() {
      return Object.entries(teams).sort((a, b) => {
        const avgA = a[1].games ? a[1].points / (3 * a[1].games) : 0;
        const avgB = b[1].games ? b[1].points / (3 * b[1].games) : 0;
        return avgB - avgA;
      }).slice(0, 10);
    }

    function updateRankingTable() {
      const sorted = getSortedTeams();
      const top5   = sorted.slice(0, 5).map(e => norm(e[0]));
      const bot5   = sorted.slice(5, 10).map(e => norm(e[0]));

      rankingTableBody.innerHTML = '';

      sorted.forEach(([team, s], i) => {
        const nt    = norm(team);
        const avg   = s.games ? (s.points / (3 * s.games)).toFixed(2) : '0.00';
        const pct25 = s.games ? `${((s.over25 / s.games) * 100).toFixed(0)}%` : '—';
        const pct35 = s.games ? `${((s.over35 / s.games) * 100).toFixed(0)}%` : '—';
        const pct5  = s.games ? `${((s.over5  / s.games) * 100).toFixed(0)}%` : '—';

        const cls25 = pctClass(s.over25, s.games);
        const cls35 = pctClass(s.over35, s.games);
        const cls5  = pctClass(s.over5,  s.games);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="rank-pos">${i + 1}</span>${nt}</td>
          <td>${s.games}</td>
          <td>${s.goals}</td>
          <td>${avg}</td>
          <td><span class="pct-badge ${cls25}">${pct25}</span></td>
          <td><span class="pct-badge ${cls35}">${pct35}</span></td>
          <td><span class="pct-badge ${cls5}">${pct5}</span></td>`;

        tr.classList.remove('highlight-green', 'highlight-red');
        if (top5.includes(nt))      tr.classList.add('highlight-green');
        else if (bot5.includes(nt)) tr.classList.add('highlight-red');

        tr.addEventListener('click', () => { currentTeam = nt; showTeamDetails(nt); });
        rankingTableBody.appendChild(tr);
      });
    }

    function pctClass(count, games) {
      if (!games) return 'pct-low';
      const p = (count / games) * 100;
      return p >= 60 ? 'pct-high' : p >= 40 ? 'pct-mid' : 'pct-low';
    }

    window.sortTable = function(col) {
      const rows = Array.from(rankingTableBody.rows);
      rows.sort((a, b) => {
        const av = a.cells[col].textContent.replace('%', '').trim();
        const bv = b.cells[col].textContent.replace('%', '').trim();
        const n  = parseFloat(av), m = parseFloat(bv);
        if (!isNaN(n) && !isNaN(m)) return m - n;
        return av.localeCompare(bv);
      });
      rows.forEach(r => rankingTableBody.appendChild(r));
    };

    /* ── TOP TEAM BAR ── */
    function updateTopTeamStats() {
      const best = Object.entries(teams).sort((a, b) =>
        (b[1].games ? b[1].points / (3 * b[1].games) : 0) -
        (a[1].games ? a[1].points / (3 * a[1].games) : 0)
      )[0];

      if (!best) { topTeamStats.innerHTML = 'Nenhum dado disponível'; return; }
      const [team, s] = best;

      const avg = s.games ? (s.points / (3 * s.games)).toFixed(2) : '0.00';
      topTeamStats.innerHTML = `Melhor equipe: <strong>${norm(team)}</strong> &mdash; Média contexto ${avg} gols/jogo &mdash; Over 2.5: ${s.games ? ((s.over25/s.games)*100).toFixed(0) : 0}% &mdash; Over 3.5: ${s.games ? ((s.over35/s.games)*100).toFixed(0) : 0}%`;
    }

    /* ── PRÓXIMOS JOGOS ── */
    function loadProximosJogos(url) {
      fetch(url)
        .then(r => r.json())
        .then(data => renderProximos(data.slice(0, 6))) // Agora pega estritamente 6 jogos
        .catch(e => console.error('Erro próximos:', e));
    }

    function xTime(jogo) {
      if (jogo.time && /^([0-1]?\d|2[0-3]):[0-5]\d$/.test(jogo.time)) return jogo.time;
      if (jogo.start_time) {
        const d = new Date(jogo.start_time);
        return `${String(d.getUTCHours()).padStart(2,'0')}:${String(d.getUTCMinutes()).padStart(2,'0')}`;
      }
      return '--:--';
    }

    function renderProximos(jogos) {
      const container = document.getElementById('lista-proximos-jogos');
      const sorted    = getSortedTeams();
      const top5 = sorted.slice(0, 5).map(e => norm(e[0]));
      const bot5 = sorted.slice(5, 10).map(e => norm(e[0]));

      if (!jogos || !jogos.length) {
        container.innerHTML = '<div style="padding:16px;color:var(--muted);text-align:center;font-size:13px;grid-column:1/-1;">Nenhum jogo disponivel</div>';
        return;
      }

      container.innerHTML = '';

      jogos.forEach(jogo => {
        const home = norm(jogo.team_home);
        const away = norm(jogo.team_visit);
        const time = xTime(jogo);

        const isHot = top5.includes(home) || top5.includes(away);
        const isMid = !isHot && (bot5.includes(home) || bot5.includes(away));

        const div = document.createElement('div');
        div.className = 'game-row' + (isHot ? ' highlight-green' : isMid ? ' highlight-red' : '');

        let tagHtml = '';
        if (isHot)      tagHtml = '<span class="signal-tag tag-high">Alta</span>';
        else if (isMid) tagHtml = '<span class="signal-tag tag-mid">Média</span>';

        div.innerHTML = `
          <span class="game-time">${time}</span>
          <span class="game-teams">${home} x ${away}</span>
          ${tagHtml}`;
        container.appendChild(div);
      });
    }

    /* ── DETALHES TIME ── */
    function showTeamDetails(team) {
      const data = teams[team];
      if (!data) return;
      teamNameElem.textContent = team;
      teamGamesElem.innerHTML  = '';

      [...data.details]
        .sort((a, b) => a.date.localeCompare(b.date))
        .forEach(g => {
          const div = document.createElement('div');
          div.className = 'game-detail';
          div.innerHTML = `
            <span class="detail-info">${g.date}</span>
            <span class="detail-opp">x ${g.opponent}</span>
            <span class="goal-tag ${g.score > 2 ? 'goal-high' : 'goal-low'}">${g.score} gols</span>`;
          teamGamesElem.appendChild(div);
        });

      teamDetails.style.display = 'block';
    }

    /* ── AUTO REFRESH ── */
    setInterval(() => {
      const sl = leagueSelect.value, sp = linesSelect.value;
      loadAndDisplayData();
      leagueSelect.value = sl;
      linesSelect.value  = sp;
    }, 180000);

  });
  </script>

  <script>
    fetch('header.html')
      .then(r => r.text())
      .then(d => { document.getElementById('header').innerHTML = d; });
  </script>

  <script src="redirecionar.js"></script>

  <script>
    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("keydown", e => {
      if (e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) ||
          (e.ctrlKey && ["u","s","p"].includes(e.key))) {
        e.preventDefault();
      }
    });

    const devtools = { open: false };
    const _el = new Image();
    Object.defineProperty(_el, 'id', { get() { devtools.open = true; } });

    (function() {
      const check = () => {
        if ((window.outerWidth - window.innerWidth) > 160 ||
            (window.outerHeight - window.innerHeight) > 160) devtools.open = true;
      };
      window.addEventListener('resize', check);
      setInterval(check, 500);
    })();

    console.log('%c', _el);
    setInterval(() => {
      if (devtools.open) {
        document.body.innerHTML = '<h1>Acesso nao autorizado detectado</h1>';
        devtools.open = false;
      }
    }, 1000);

    document.addEventListener('selectstart', e => e.preventDefault());
    document.addEventListener('dragstart',   e => e.preventDefault());
    console.log = console.debug = console.info = function() {};
  </script>

</body>
</html>