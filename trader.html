<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BetStat - Candlestick</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Roboto", Arial, sans-serif;
            margin: 30px;
            background-color: #0a0e1a;
            color: #ffffff;
        }

        h1, h2, label {
            color: #1fad8b;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        select {
            padding: 8px 12px;
            background-color: #1c1f26;
            color: #e0e0e0;
            border: 1px solid #1fad8b;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:hover {
            border-color: #34d8ab;
        }

        .chart-container {
            background-color: #1c1f26;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .chart-container h2 {
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        canvas {
            border-radius: 4px;
        }

        .accordion {
            margin-bottom: 10px;
        }

        .accordion-header {
            background-color: #1c1f26;
            color: #1fad8b;
            padding: 12px;
            cursor: pointer;
            border: 1px solid #1fad8b;
            border-radius: 4px;
            font-size: 18px;
            text-align: center;
            transition: background-color 0.3s;
        }

        .accordion-header:hover {
            background-color: #2a2d36;
        }

        .accordion-content {
            display: none;
            padding: 10px;
        }

        .accordion-content.active {
            display: block;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            cursor: pointer;
        }

        .legend-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .legend-item:hover {
            background-color: rgba(31, 173, 139, 0.2);
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-text {
            font-size: 12px;
            color: #e0e0e0;
        }

        .legend-item.hidden .legend-text {
            text-decoration: line-through;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>BetStat - Análise Candlestick</h1>

    <div class="control-panel">
        <div>
            <label for="pointsSelector">Horas:</label>
            <select id="pointsSelector">
                <option value="20">1 Hora</option>
                <option value="40">2 Horas</option>
                <option value="60">3 Horas</option>
                <option value="80">4 Horas</option>
                <option value="100">5 Horas</option>
                <option value="120">6 Horas</option>
                <option value="140">7 Horas</option>
                <option value="160">8 Horas</option>
                <option value="180">9 Horas</option>
                <option value="200">10 Horas</option>
                <option value="220">11 Horas</option>
                <option value="240">12 Horas</option>
                <option value="480">24 Horas</option>
                <option value="960">48 Horas</option>
            </select>
        </div>

        <div>
            <label for="averageSelector">Base:</label>
            <select id="averageSelector">
                <option value="19">20</option>
                <option value="39">40</option>
                <option value="59">60</option>
                <option value="79">80</option>
                <option value="99">100</option>
                <option value="119">120</option>
            </select>
        </div>

        <div class="checkbox-container">
            <input type="checkbox" id="fibonacciToggle">
            <label for="fibonacciToggle">Ativar Fibonacci</label>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Copa América</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Copa América</h2>
                <div class="legend-container" id="legendCopaAmerica"></div>
                <canvas id="copaamericaChart"></canvas>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Taça Glória Eterna</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Taça Glória Eterna</h2>
                <div class="legend-container" id="legendTacaGloria"></div>
                <canvas id="tacagloriaChart"></canvas>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Euro</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Euro</h2>
                <div class="legend-container" id="legendEuro"></div>
                <canvas id="euroChart"></canvas>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Campeonato Italiano</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Campeonato Italiano</h2>
                <div class="legend-container" id="legendCampeonatoItaliano"></div>
                <canvas id="campeonatoitalianoChart"></canvas>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Copa das Estrelas</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Copa das Estrelas</h2>
                <div class="legend-container" id="legendCopaEstrelas"></div>
                <canvas id="copaestrelasChart"></canvas>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">Brasileirão Betano</div>
        <div class="accordion-content">
            <div class="chart-container">
                <h2>Brasileirão Betano</h2>
                <div class="legend-container" id="legendbrasileiro"></div>
                <canvas id="brasileiraoChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let numPoints = 20;
        let averagePoints = 19;
        let showFibonacciLines = false;
        const leagues = ['CopaAmerica', 'TacaGloria', 'Euro', 'CampeonatoItaliano', 'CopaEstrelas', 'brasileirao'];
        const chartInstances = {};
        let chartData = {};

        const statsChartVisibleDatasets = {
            'Gols FT': false,
            'Casa Vence': false,
            'Empate': false,
            'Fora Vence': false,
            'Ambas Sim': true,
            'Ambas Não': false,
            'Over 1.5': false,
            'Over 2.5': false,
            'Over 3.5': false,
            'Under 1.5': false,
            'Under 2.5': false,
            'Under 3.5': false,
            '0 Gol Exato': false,
            '1 Gol Exato': false,
            '2 Gols Exatos': false,
            '3 Gols Exatos': false,
            '4 Gols Exatos': false,
            '5 Gols Exatos': false
        };

        const datasetColors = {
            'Gols FT': '#1E88E5',
            'Casa Vence': '#AB47BC',
            'Empate': '#78909C',
            'Fora Vence': '#2196F3',
            'Ambas Sim': '#B0BEC5',
            'Ambas Não': '#F44336',
            'Over 1.5': '#26A69A',
            'Over 2.5': '#FFEB3B',
            'Over 3.5': '#00BCD4',
            'Under 1.5': '#388E3C',
            'Under 2.5': '#FF9800',
            'Under 3.5': '#F06292',
            '0 Gol Exato': '#D81B60',
            '1 Gol Exato': '#8E24AA',
            '2 Gols Exatos': '#A0522D',
            '3 Gols Exatos': '#546E7A',
            '4 Gols Exatos': '#FFB300',
            '5 Gols Exatos': '#00897B'
        };

        function formatHtResult(ht) {
            if (ht === 'OUT') return 'OUT';
            if (ht && ht.includes(' x ')) {
                const parts = ht.split(' x ');
                if (parts.length === 2) {
                    return `${parts[0]}-${parts[1]}`;
                }
            }
            return ht;
        }

        function processApiData(data, league) {
            const sortedData = [...data].sort((a, b) => {
                const dateA = new Date(a.data);
                const dateB = new Date(b.data);
                if (dateA.getTime() !== dateB.getTime()) return dateA - dateB;
                if (a.hora !== b.hora) return a.hora - b.hora;
                return a.minuto - b.minuto;
            });

            const slicedData = sortedData.slice(-numPoints - averagePoints);
            chartData[league] = slicedData;

            let labels = [];
            let golsFT = [];
            let casaVence = [];
            let empate = [];
            let foraVence = [];
            let ambasSim = [];
            let ambasNao = [];
            let over15 = [];
            let over25 = [];
            let over35 = [];
            let under15 = [];
            let under25 = [];
            let under35 = [];
            let gol0 = [];
            let gol1 = [];
            let gol2 = [];
            let gol3 = [];
            let gol4 = [];
            let gol5 = [];

            function hasGap(prevMatch, currMatch) {
                const prevTime = new Date(prevMatch.data + 'T' + prevMatch.hora + ':' + prevMatch.minuto + ':00');
                const currTime = new Date(currMatch.data + 'T' + currMatch.hora + ':' + currMatch.minuto + ':00');
                const diffMinutes = (currTime - prevTime) / (1000 * 60);
                return diffMinutes > 1;
            }

            for (let i = averagePoints; i < slicedData.length; i++) {
                let golsFTSum = 0;
                let casaVenceSum = 0;
                let empateSum = 0;
                let foraVenceSum = 0;
                let ambasSimSum = 0;
                let ambasNaoSum = 0;
                let over15Sum = 0;
                let over25Sum = 0;
                let over35Sum = 0;
                let under15Sum = 0;
                let under25Sum = 0;
                let under35Sum = 0;
                let gol0Sum = 0;
                let gol1Sum = 0;
                let gol2Sum = 0;
                let gol3Sum = 0;
                let gol4Sum = 0;
                let gol5Sum = 0;
                let validMatches = 0;

                for (let j = Math.max(0, i - averagePoints); j <= i; j++) {
                    const match = slicedData[j];
                    const ftScore = match.ft;

                    if (j > 0 && hasGap(slicedData[j - 1], match)) {
                        labels.push(`${match.hora}:${match.minuto.toString().padStart(2, '0')}`);
                        golsFT.push(null);
                        casaVence.push(null);
                        empate.push(null);
                        foraVence.push(null);
                        ambasSim.push(null);
                        ambasNao.push(null);
                        over15.push(null);
                        over25.push(null);
                        over35.push(null);
                        under15.push(null);
                        under25.push(null);
                        under35.push(null);
                        gol0.push(null);
                        gol1.push(null);
                        gol2.push(null);
                        gol3.push(null);
                        gol4.push(null);
                        gol5.push(null);
                        continue;
                    }

                    let ftScoreParts = [0, 0];
                    if (ftScore && ftScore.includes(' x ')) {
                        ftScoreParts = ftScore.split(' x ').map(num => parseInt(num, 10));
                    }

                    const totalGolsFT = ftScoreParts[0] + ftScoreParts[1];

                    golsFTSum += totalGolsFT;
                    casaVenceSum += ftScoreParts[0] > ftScoreParts[1] ? 1 : 0;
                    empateSum += ftScoreParts[0] === ftScoreParts[1] ? 1 : 0;
                    foraVenceSum += ftScoreParts[0] < ftScoreParts[1] ? 1 : 0;
                    ambasSimSum += ftScoreParts[0] > 0 && ftScoreParts[1] > 0 ? 1 : 0;
                    ambasNaoSum += ftScoreParts[0] === 0 || ftScoreParts[1] === 0 ? 1 : 0;
                    over15Sum += totalGolsFT > 1.5 ? 1 : 0;
                    over25Sum += totalGolsFT > 2.5 ? 1 : 0;
                    over35Sum += totalGolsFT > 3.5 ? 1 : 0;
                    under15Sum += totalGolsFT < 1.5 ? 1 : 0;
                    under25Sum += totalGolsFT < 2.5 ? 1 : 0;
                    under35Sum += totalGolsFT < 3.5 ? 1 : 0;
                    gol0Sum += totalGolsFT === 0 ? 1 : 0;
                    gol1Sum += totalGolsFT === 1 ? 1 : 0;
                    gol2Sum += totalGolsFT === 2 ? 1 : 0;
                    gol3Sum += totalGolsFT === 3 ? 1 : 0;
                    gol4Sum += totalGolsFT === 4 ? 1 : 0;
                    gol5Sum += totalGolsFT === 5 ? 1 : 0;
                    validMatches++;
                }

                const match = slicedData[i];
                labels.push(`${match.hora}:${match.minuto.toString().padStart(2, '0')}`);

                const avg = validMatches || 1;
                golsFT.push(golsFTSum / avg * 100);
                casaVence.push(casaVenceSum / avg * 100);
                empate.push(empateSum / avg * 100);
                foraVence.push(foraVenceSum / avg * 100);
                ambasSim.push(ambasSimSum / avg * 100);
                ambasNao.push(ambasNaoSum / avg * 100);
                over15.push(over15Sum / avg * 100);
                over25.push(over25Sum / avg * 100);
                over35.push(over35Sum / avg * 100);
                under15.push(under15Sum / avg * 100);
                under25.push(under25Sum / avg * 100);
                under35.push(under35Sum / avg * 100);
                gol0.push(gol0Sum / avg * 100);
                gol1.push(gol1Sum / avg * 100);
                gol2.push(gol2Sum / avg * 100);
                gol3.push(gol3Sum / avg * 100);
                gol4.push(gol4Sum / avg * 100);
                gol5.push(gol5Sum / avg * 100);
            }

            return { 
                labels, golsFT, casaVence, empate, foraVence, ambasSim, ambasNao,
                over15, over25, over35, under15, under25, under35,
                gol0, gol1, gol2, gol3, gol4, gol5 
            };
        }

        const fibonacciLinesPlugin = {
            id: 'fibonacciLines',
            afterDraw: (chart) => {
                if (!showFibonacciLines) return;
                const ctx = chart.ctx;
                const yAxis = chart.scales.y;
                const fibonacciLevels = [0, 23.6, 38.2, 50, 61.8, 100];
                const yMin = yAxis.min;
                const yMax = yAxis.max;
                const range = yMax - yMin;
                const normalizedLevels = fibonacciLevels.map(level => yMin + (level / 100) * range);

                ctx.save();
                normalizedLevels.forEach((level, index) => {
                    const y = yAxis.getPixelForValue(level);
                    ctx.beginPath();
                    ctx.moveTo(chart.chartArea.left, y);
                    ctx.lineTo(chart.chartArea.right, y);
                    ctx.strokeStyle = 'rgba(0, 255, 0, 0.5)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    ctx.fillStyle = '#b0b0b0';
                    ctx.font = '11px Arial';
                    ctx.textAlign = 'left';
                    const textY = y - (index === 0 ? -10 : 5);
                    const textX = chart.chartArea.right + 10;
                    ctx.fillText(`${fibonacciLevels[index]}%`, textX, textY);
                });
                ctx.restore();
            }
        };

        const candlestickPlugin = {
            id: 'candlestick',
            afterDatasetsDraw: (chart) => {
                const ctx = chart.ctx;
                const xAxis = chart.scales.x;
                const yAxis = chart.scales.y;
                
                chart.data.datasets.forEach((dataset, datasetIndex) => {
                    if (chart.isDatasetVisible(datasetIndex)) {
                        const meta = chart.getDatasetMeta(datasetIndex);
                        
                        dataset.data.forEach((value, index) => {
                            if (value === null || value === undefined) return;
                            
                            const prevValue = index > 0 ? dataset.data[index - 1] : value;
                            const isGreen = value >= prevValue;
                            
                            const x = xAxis.getPixelForValue(index);
                            const yTop = yAxis.getPixelForValue(Math.max(value, prevValue));
                            const yBottom = yAxis.getPixelForValue(Math.min(value, prevValue));
                            const candleWidth = 8;
                            
                            // Corpo da vela
                            ctx.fillStyle = isGreen ? 'rgba(0, 255, 0, 0.6)' : 'rgba(255, 0, 0, 0.6)';
                            ctx.fillRect(x - candleWidth/2, yTop, candleWidth, yBottom - yTop || 1);
                            
                            // Borda da vela
                            ctx.strokeStyle = isGreen ? '#00ff00' : '#ff0000';
                            ctx.lineWidth = 1;
                            ctx.strokeRect(x - candleWidth/2, yTop, candleWidth, yBottom - yTop || 1);
                        });
                    }
                });
            }
        };

        function createLegend(league) {
            const legendContainer = document.getElementById(`legend${league}`);
            legendContainer.innerHTML = '';
            
            Object.keys(statsChartVisibleDatasets).forEach(label => {
                const legendItem = document.createElement('div');
                legendItem.className = `legend-item ${statsChartVisibleDatasets[label] ? '' : 'hidden'}`;
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${datasetColors[label]}"></div>
                    <span class="legend-text">${label}</span>
                `;
                legendItem.onclick = () => toggleDataset(league, label, legendItem);
                legendContainer.appendChild(legendItem);
            });
        }

        function toggleDataset(league, label, legendItem) {
            const chart = chartInstances[league];
            const datasetIndex = Object.keys(statsChartVisibleDatasets).indexOf(label);
            const meta = chart.getDatasetMeta(datasetIndex);
            meta.hidden = !meta.hidden;
            statsChartVisibleDatasets[label] = !meta.hidden;
            legendItem.classList.toggle('hidden');
            chart.update();
        }

        function createStatsChart(ctx, labels, data, league) {
            createLegend(league);
            
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Gols FT', data: data.golsFT, borderColor: datasetColors['Gols FT'], backgroundColor: datasetColors['Gols FT'], hidden: !statsChartVisibleDatasets['Gols FT'] },
                        { label: 'Casa Vence', data: data.casaVence, borderColor: datasetColors['Casa Vence'], backgroundColor: datasetColors['Casa Vence'], hidden: !statsChartVisibleDatasets['Casa Vence'] },
                        { label: 'Empate', data: data.empate, borderColor: datasetColors['Empate'], backgroundColor: datasetColors['Empate'], hidden: !statsChartVisibleDatasets['Empate'] },
                        { label: 'Fora Vence', data: data.foraVence, borderColor: datasetColors['Fora Vence'], backgroundColor: datasetColors['Fora Vence'], hidden: !statsChartVisibleDatasets['Fora Vence'] },
                        { label: 'Ambas Sim', data: data.ambasSim, borderColor: datasetColors['Ambas Sim'], backgroundColor: datasetColors['Ambas Sim'], hidden: !statsChartVisibleDatasets['Ambas Sim'] },
                        { label: 'Ambas Não', data: data.ambasNao, borderColor: datasetColors['Ambas Não'], backgroundColor: datasetColors['Ambas Não'], hidden: !statsChartVisibleDatasets['Ambas Não'] },
                        { label: 'Over 1.5', data: data.over15, borderColor: datasetColors['Over 1.5'], backgroundColor: datasetColors['Over 1.5'], hidden: !statsChartVisibleDatasets['Over 1.5'] },
                        { label: 'Over 2.5', data: data.over25, borderColor: datasetColors['Over 2.5'], backgroundColor: datasetColors['Over 2.5'], hidden: !statsChartVisibleDatasets['Over 2.5'] },
                        { label: 'Over 3.5', data: data.over35, borderColor: datasetColors['Over 3.5'], backgroundColor: datasetColors['Over 3.5'], hidden: !statsChartVisibleDatasets['Over 3.5'] },
                        { label: 'Under 1.5', data: data.under15, borderColor: datasetColors['Under 1.5'], backgroundColor: datasetColors['Under 1.5'], hidden: !statsChartVisibleDatasets['Under 1.5'] },
                        { label: 'Under 2.5', data: data.under25, borderColor: datasetColors['Under 2.5'], backgroundColor: datasetColors['Under 2.5'], hidden: !statsChartVisibleDatasets['Under 2.5'] },
                        { label: 'Under 3.5', data: data.under35, borderColor: datasetColors['Under 3.5'], backgroundColor: datasetColors['Under 3.5'], hidden: !statsChartVisibleDatasets['Under 3.5'] },
                        { label: '0 Gol Exato', data: data.gol0, borderColor: datasetColors['0 Gol Exato'], backgroundColor: datasetColors['0 Gol Exato'], hidden: !statsChartVisibleDatasets['0 Gol Exato'] },
                        { label: '1 Gol Exato', data: data.gol1, borderColor: datasetColors['1 Gol Exato'], backgroundColor: datasetColors['1 Gol Exato'], hidden: !statsChartVisibleDatasets['1 Gol Exato'] },
                        { label: '2 Gols Exatos', data: data.gol2, borderColor: datasetColors['2 Gols Exatos'], backgroundColor: datasetColors['2 Gols Exatos'], hidden: !statsChartVisibleDatasets['2 Gols Exatos'] },
                        { label: '3 Gols Exatos', data: data.gol3, borderColor: datasetColors['3 Gols Exatos'], backgroundColor: datasetColors['3 Gols Exatos'], hidden: !statsChartVisibleDatasets['3 Gols Exatos'] },
                        { label: '4 Gols Exatos', data: data.gol4, borderColor: datasetColors['4 Gols Exatos'], backgroundColor: datasetColors['4 Gols Exatos'], hidden: !statsChartVisibleDatasets['4 Gols Exatos'] },
                        { label: '5 Gols Exatos', data: data.gol5, borderColor: datasetColors['5 Gols Exatos'], backgroundColor: datasetColors['5 Gols Exatos'], hidden: !statsChartVisibleDatasets['5 Gols Exatos'] }
                    ].map(dataset => ({
                        ...dataset,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointBackgroundColor: dataset.borderColor,
                        fill: false,
                        spanGaps: false
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 3,
                    layout: { 
                        padding: { 
                            top: 30,
                            right: 50
                        } 
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#1fad8b',
                            bodyColor: '#e0e0e0',
                            borderColor: '#1fad8b',
                            borderWidth: 1,
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex + averagePoints;
                                    const match = chartData[league][index];
                                    return match ? `${match.hora}:${match.minuto.toString().padStart(2, '0')}` : '';
                                },
                                label: function(tooltipItem) {
                                    const index = tooltipItem.dataIndex + averagePoints;
                                    const match = chartData[league][index];
                                    const ftScore = match ? match.ft : 'N/A';
                                    const htScore = match ? formatHtResult(match.ht) : 'N/A';
                                    return [
                                        `FT: ${ftScore}`,
                                        `HT: ${htScore}`,
                                        `${tooltipItem.dataset.label}: ${Math.round(tooltipItem.raw)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: false },
                            ticks: { 
                                color: '#b0b0b0', 
                                maxRotation: 45, 
                                minRotation: 45,
                                maxTicksLimit: 20
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)', 
                                borderDash: [5, 5] 
                            }
                        },
                        y: {
                            title: { display: false },
                            beginAtZero: false,
                            ticks: { 
                                color: '#b0b0b0',
                                callback: function(value) {
                                    return Math.round(value) + '%';
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)', 
                                borderDash: [5, 5] 
                            },
                            afterFit: function(scale) { 
                                scale.paddingTop = 20; 
                            }
                        }
                    }
                },
                plugins: [fibonacciLinesPlugin, candlestickPlugin]
            });
        }

        function updateStatsChart(chart, newData, league) {
            if (chart) {
                chart.data.labels = newData.labels;
                chart.data.datasets[0].data = newData.golsFT;
                chart.data.datasets[1].data = newData.casaVence;
                chart.data.datasets[2].data = newData.empate;
                chart.data.datasets[3].data = newData.foraVence;
                chart.data.datasets[4].data = newData.ambasSim;
                chart.data.datasets[5].data = newData.ambasNao;
                chart.data.datasets[6].data = newData.over15;
                chart.data.datasets[7].data = newData.over25;
                chart.data.datasets[8].data = newData.over35;
                chart.data.datasets[9].data = newData.under15;
                chart.data.datasets[10].data = newData.under25;
                chart.data.datasets[11].data = newData.under35;
                chart.data.datasets[12].data = newData.gol0;
                chart.data.datasets[13].data = newData.gol1;
                chart.data.datasets[14].data = newData.gol2;
                chart.data.datasets[15].data = newData.gol3;
                chart.data.datasets[16].data = newData.gol4;
                chart.data.datasets[17].data = newData.gol5;
                chart.update('none');
            }
        }

        function updateCharts() {
            const timestamp = new Date().getTime();
            const leagueUrls = {
                'CopaAmerica': 'https://betstat.site/resultados/Copa%20Am%C3%A9rica',
                'TacaGloria': 'https://betstat.site/resultados/Ta%C3%A7a%20Gl%C3%B3ria%20eterna',
                'Euro': 'https://betstat.site/resultados/Euro',
                'CampeonatoItaliano': 'https://betstat.site/resultados/Campeonato%20Italiano',
                'CopaEstrelas': 'https://betstat.site/resultados/Copa%20das%20estrelas',
                'brasileirao': 'https://betstat.site/resultados/Brasileir%C3%A3o%20Betano',
            };

            leagues.forEach(league => {
                const apiUrl = `${leagueUrls[league]}?timestamp=${timestamp}`;
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                        return response.json();
                    })
                    .then(data => {
                        const processedData = processApiData(data, league);
                        const chartId = `${league.toLowerCase()}Chart`;
                        const canvasElement = document.getElementById(chartId);
                        
                        if (!canvasElement) {
                            console.error(`Canvas com ID '${chartId}' não encontrado`);
                            return;
                        }

                        if (!chartInstances[league]) {
                            const ctx = canvasElement.getContext('2d');
                            chartInstances[league] = createStatsChart(ctx, processedData.labels, processedData, league);
                        } else {
                            updateStatsChart(chartInstances[league], processedData, league);
                        }
                    })
                    .catch(error => console.error(`Erro ao buscar dados para ${league}:`, error));
            });
        }

        function toggleFibonacciLines() {
            showFibonacciLines = document.getElementById('fibonacciToggle').checked;
            leagues.forEach(league => {
                if (chartInstances[league]) chartInstances[league].update();
            });
        }

        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.classList.toggle('active');
            });
        });

        document.getElementById('pointsSelector').addEventListener('change', function(event) {
            numPoints = parseInt(event.target.value, 10);
            updateCharts();
        });

        document.getElementById('averageSelector').addEventListener('change', function(event) {
            averagePoints = parseInt(event.target.value, 10);
            updateCharts();
        });

        document.getElementById('fibonacciToggle').addEventListener('change', toggleFibonacciLines);

        window.onload = updateCharts;
        setInterval(updateCharts, 3000);
    </script>
</body>
</html>