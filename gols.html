<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"></script>
    <title>BetStat - Análise de Gols Virtual</title>

    <!-- Meta tags SEO -->
    <meta name="description" content="Análises profissionais de futebol virtual Betano. Média de gols, % Over 2.5, streaks e próximos jogos em tempo real." />
    <meta name="keywords" content="BetStat, futebol virtual, Betano, over 2.5, análise gols, estatísticas apostas" />

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <style>
        :root {
            --primary-bg: #121212;
            --secondary-bg: #1c1f26;
            --header-bg: #1a1a1a;
            --accent: #ffffff;
            --green: #005540;
            --amber: #a19f01;
            --border: #2c2c2c;
            --hover: #2d2d2d;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: var(--primary-bg);
            color: var(--accent);
            line-height: 1.6;
            padding: 0;
        }

        /* HEADER - EXATAMENTE como você já usa (separado) */
        #header { }

        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 25px;
        }

        /* CONTROLS - mais limpo e profissional */
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        select {
            padding: 12px 20px;
            background: #242526;
            color: white;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 15px;
            min-width: 240px;
        }
        .btn-update {
            background: #ff8a00;
            color: #000;
            font-weight: 700;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-update:hover {
            background: #ffb300;
            transform: translateY(-2px);
        }

        /* CARDS DE RESUMO */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin-bottom: 35px;
        }
        .stat-card {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 15px; color: #aaa; margin-bottom: 8px; }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }
        .stat-value.green { color: var(--green); }
        .stat-value.amber { color: var(--amber); }

        /* MAIN CONTENT */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2.2fr;
            gap: 30px;
        }
        @media (max-width: 1100px) {
            .main-content { grid-template-columns: 1fr; }
        }

        /* PRÓXIMOS JOGOS */
        .upcoming-games {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .section-title {
            background: var(--header-bg);
            padding: 12px 18px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 8px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .games-table {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .game-row {
            display: grid;
            grid-template-columns: 80px 1fr;
            align-items: center;
            padding: 14px 18px;
            background: var(--header-bg);
            border-radius: 8px;
            border-left: 4px solid transparent;
            transition: all 0.3s;
        }
        .game-row:hover {
            background: var(--hover);
            transform: translateX(6px);
        }
        .game-row.highlight-green { border-left-color: var(--green); }
        .game-row.highlight-amber { border-left-color: var(--amber); }

        /* RANKING */
        .ranking-section {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }
        .ranking-table th {
            background: var(--header-bg);
            padding: 14px 12px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        .ranking-table td {
            padding: 14px 12px;
            border-top: 1px solid var(--border);
        }
        .ranking-table tr:hover {
            background: var(--hover);
        }
        .highlight-green td:first-child { font-weight: 700; color: var(--green); }
        .highlight-amber td:first-child { font-weight: 700; color: var(--amber); }

        /* DETALHES DO TIME */
        .team-details {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .team-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .close-details {
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }
        .game-detail {
            background: var(--header-bg);
            padding: 14px 18px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        /* FOOTER INFO */
        .footer-info {
            text-align: center;
            margin-top: 50px;
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>

    <!-- HEADER - EXATAMENTE a mesma estrutura que você já usa -->
    <div id="header"></div>

    <div class="main-container">

        <!-- CONTROLS -->
        <div class="controls">
            <select id="league-select">
                <option value="Copa América|https://betstat.site/resultados/Copa%20Am%C3%A9rica|https://betstat.site/proximos/Copa%20Am%C3%A9rica" selected>Copa América</option>
                <option value="Taça Glória Eterna|https://betstat.site/resultados/Ta%C3%A7a%20Gl%C3%B3ria%20eterna|https://betstat.site/proximos/Taça%20Glória%20Eterna">Clássicos da América</option>
                <option value="Euro|https://betstat.site/resultados/Euro|https://betstat.site/proximos/Euro">Euro</option>
                <option value="Campeonato Italiano|https://betstat.site/resultados/Campeonato%20Italiano|https://betstat.site/proximos/Campeonato%20Italiano">Campeonato Italiano</option>
                <option value="Copa das Estrelas|https://betstat.site/resultados/Copa%20das%20estrelas|https://betstat.site/proximos/Copa%20das%20Estrelas">Copa das Estrelas</option>
                <option value="Brasileirão Betano|https://betstat.site/resultados/Brasileir%C3%A3o%20Betano|https://betstat.site/proximos/Brasileir%C3%A3o%20Betano">Brasileirão Betano</option>
            </select>

            <select id="lines-select">
                <option value="20">Últimas 1 hora</option>
                <option value="40">Últimas 2 horas</option>
                <option value="60">Últimas 3 horas</option>
                <option value="80">Últimas 4 horas</option>
                <option value="120">Últimas 6 horas</option>
                <option value="180">Últimas 9 horas</option>
                <option value="240" selected>Últimas 12 horas</option>
                <option value="480">Últimas 24 horas</option>
                <option value="960">Últimas 48 horas</option>
                <option value="1440">Últimas 72 horas</option>
            </select>

            <button class="btn-update" onclick="loadAndDisplayData()">
                <i class="fas fa-sync-alt"></i> Atualizar Agora
            </button>
        </div>

        <!-- CARDS DE RESUMO -->
        <div class="stats-grid" id="stats-grid">
            <!-- preenchido via JS -->
        </div>

        <div class="main-content">
            <!-- COLUNA ESQUERDA -->
            <div class="left-column">
                <div class="upcoming-games">
                    <div class="section-title">
                        <i class="fas fa-clock"></i> Próximos Jogos
                    </div>
                    <div class="games-table" id="lista-proximos-jogos"></div>
                </div>

                <div class="team-details" id="team-details">
                    <div class="team-details-header">
                        <h3>Histórico recente: <span id="team-name"></span></h3>
                        <span class="close-details" id="close-details">✕</span>
                    </div>
                    <div id="team-summary" style="margin-bottom:15px; font-size:14px;"></div>
                    <div class="game-details" id="team-games"></div>
                </div>
            </div>

            <!-- RANKING -->
            <div class="ranking-section">
                <div class="section-title">
                    <i class="fas fa-trophy"></i> Ranking de Média de Gols
                </div>
                <table class="ranking-table" id="ranking-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Equipe</th>
                            <th onclick="sortTable(1)">Jogos</th>
                            <th onclick="sortTable(2)">Total Gols</th>
                            <th onclick="sortTable(3)">Média</th>
                            <th onclick="sortTable(4)">% Over 2.5</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="footer-info">
            Dados atualizados automaticamente • Última atualização: <span id="last-update"></span>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const leagueSelect = document.getElementById('league-select');
        const linesSelect = document.getElementById('lines-select');
        const rankingBody = document.getElementById('ranking-table').querySelector('tbody');
        const teamDetails = document.getElementById('team-details');
        const teamNameElem = document.getElementById('team-name');
        const teamGamesElem = document.getElementById('team-games');
        const teamSummaryElem = document.getElementById('team-summary');
        const closeDetails = document.getElementById('close-details');
        const statsGrid = document.getElementById('stats-grid');
        let teams = {};
        let currentTeam = null;
        let allGames = [];

        leagueSelect.addEventListener('change', loadAndDisplayData);
        linesSelect.addEventListener('change', loadAndDisplayData);
        closeDetails.addEventListener('click', () => { teamDetails.style.display = 'none'; });

        loadAndDisplayData();

        function normalizeTeamName(name) {
            return (name || '').trim().replace(/\s+/g, ' ');
        }

        function formatDateTime(game) {
            const d = new Date(game.data);
            return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')} ${game.hora.toString().padStart(2,'0')}:${game.minuto.toString().padStart(2,'0')}`;
        }

        function loadAndDisplayData() {
            const [league, resultsUrl, nextUrl] = leagueSelect.value.split('|');
            const limit = parseInt(linesSelect.value);

            fetch(resultsUrl)
                .then(r => r.json())
                .then(data => {
                    allGames = data.slice(-limit);
                    teams = {};

                    // Processa estatísticas por time
                    allGames.forEach(game => {
                        const t1 = normalizeTeamName(game.time_a);
                        const t2 = normalizeTeamName(game.time_b);
                        const [g1, g2] = game.ft.split(' x ').map(Number);
                        const total = g1 + g2;
                        const isOver25 = total >= 3;

                        [t1, t2].forEach(team => {
                            if (!teams[team]) teams[team] = { games:0, totalGoals:0, over25:0, details:[] };
                            teams[team].games++;
                            teams[team].totalGoals += total;
                            if (isOver25) teams[team].over25++;
                        });

                        // Detalhes do jogo
                        [t1, t2].forEach(team => {
                            teams[team].details.push({
                                date: formatDateTime(game),
                                opponent: team === t1 ? t2 : t1,
                                score: total,
                                over: isOver25
                            });
                        });
                    });

                    updateSummaryCards();
                    updateRankingTable();
                    loadProximosJogos(nextUrl);
                    updateLastUpdate();
                    if (currentTeam) showTeamDetails(currentTeam);
                })
                .catch(err => console.error('Erro resultados:', err));
        }

        function updateSummaryCards() {
            if (allGames.length === 0) return;
            let totalGoals = 0, over25 = 0;
            allGames.forEach(g => {
                const [a,b] = g.ft.split(' x ').map(Number);
                totalGoals += a + b;
                if (a + b >= 3) over25++;
            });

            const avgLiga = (totalGoals / allGames.length).toFixed(2);
            const percOver = ((over25 / allGames.length) * 100).toFixed(1);

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>Jogos Analisados</h3>
                    <div class="stat-value">${allGames.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Média de Gols (Liga)</h3>
                    <div class="stat-value green">${avgLiga}</div>
                </div>
                <div class="stat-card">
                    <h3>% Over 2.5</h3>
                    <div class="stat-value amber">${percOver}%</div>
                </div>
                <div class="stat-card">
                    <h3>Melhor Time</h3>
                    <div class="stat-value" id="top-team-name" style="font-size:22px;">Carregando...</div>
                </div>
            `;

            // Atualiza melhor time
            const top = Object.entries(teams).sort((a,b) => (b[1].totalGoals/(3*b[1].games)) - (a[1].totalGoals/(3*a[1].games)))[0];
            if (top) document.getElementById('top-team-name').textContent = normalizeTeamName(top[0]);
        }

        function updateRankingTable() {
            const sorted = Object.entries(teams)
                .sort((a,b) => (b[1].totalGoals / (3 * b[1].games)) - (a[1].totalGoals / (3 * a[1].games)))
                .slice(0, 15);

            rankingBody.innerHTML = '';

            sorted.forEach(([name, stats]) => {
                const avg = (stats.totalGoals / (3 * stats.games)).toFixed(2);
                const percOver = ((stats.over25 / stats.games) * 100).toFixed(0);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${normalizeTeamName(name)}</td>
                    <td style="text-align:center">${stats.games}</td>
                    <td style="text-align:center">${stats.totalGoals}</td>
                    <td style="text-align:center; font-weight:700">${avg}</td>
                    <td style="text-align:center">${percOver}%</td>
                `;
                row.onclick = () => {
                    currentTeam = normalizeTeamName(name);
                    showTeamDetails(currentTeam);
                };
                rankingBody.appendChild(row);
            });
        }

        function loadProximosJogos(url) {
            fetch(url)
                .then(r => r.json())
                .then(data => {
                    const container = document.getElementById('lista-proximos-jogos');
                    container.innerHTML = '';
                    const topTeams = Object.keys(teams).sort((a,b) => 
                        (teams[b].totalGoals/(3*teams[b].games)) - (teams[a].totalGoals/(3*teams[a].games))
                    ).slice(0,5);

                    data.slice(0,8).forEach(jogo => {
                        const home = normalizeTeamName(jogo.team_home);
                        const away = normalizeTeamName(jogo.team_visit);
                        const div = document.createElement('div');
                        div.className = 'game-row';
                        if (topTeams.includes(home) || topTeams.includes(away)) div.classList.add('highlight-green');
                        div.innerHTML = `
                            <span style="font-weight:600">${jogo.time || '—'}</span>
                            <span>${home} <strong>x</strong> ${away}</span>
                        `;
                        container.appendChild(div);
                    });
                });
        }

        function showTeamDetails(team) {
            const data = teams[team];
            if (!data) return;

            teamNameElem.textContent = team;
            teamSummaryElem.innerHTML = `
                <strong>Média:</strong> ${(data.totalGoals / (3 * data.games)).toFixed(2)} gols/jogo • 
                <strong>Over 2.5:</strong> ${((data.over25 / data.games) * 100).toFixed(0)}%
            `;

            teamGamesElem.innerHTML = '';
            data.details
                .sort((a,b) => b.date.localeCompare(a.date))
                .forEach(g => {
                    const el = document.createElement('div');
                    el.className = 'game-detail';
                    el.innerHTML = `
                        ${g.date} <strong>vs ${g.opponent}</strong> 
                        <span style="background:${g.over ? 'var(--green)' : '#444'}; padding:2px 10px; border-radius:4px;">${g.score} gols</span>
                    `;
                    teamGamesElem.appendChild(el);
                });

            teamDetails.style.display = 'block';
        }

        function sortTable(col) {
            const rows = Array.from(rankingBody.rows);
            rows.sort((a,b) => {
                let va = a.cells[col].textContent.trim();
                let vb = b.cells[col].textContent.trim();
                if (col === 0) return va.localeCompare(vb);
                return parseFloat(vb) - parseFloat(va);
            });
            rows.forEach(r => rankingBody.appendChild(r));
        }

        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('last-update').textContent = 
                `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        }

        // Atualização automática a cada 3 minutos
        setInterval(() => {
            loadAndDisplayData();
        }, 180000);
    });
    </script>

    <!-- CARREGA HEADER EXTERNO (mantido exatamente como você já usa) -->
    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header').innerHTML = data;
            });
    </script>

    <script src="redirecionar.js"></script>

    <!-- Scripts de segurança (mantidos) -->
    <script>
        document.addEventListener("contextmenu", e => e.preventDefault());
        document.addEventListener("keydown", e => {
            if (e.key === "F12" || (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J" || e.key === "C")) ||
                (e.ctrlKey && (e.key === "u" || e.key === "s" || e.key === "p"))) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>