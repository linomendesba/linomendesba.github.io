<!DOCTYPE html>
<html lang="pt-br" class="dark">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Betstat - Análises Esportivas</title>
  <meta name="viewport" content="width=1280, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <style>
    /* Estilos CSS (combinados e otimizados) */
    :root {
        --cor-principal: #1fcc59;
        --cor-fundo: #333333;
        --cor-fundo-header: #1f2129;
        --cor-fundo-celula: #2c2e36;
        --cor-texto-principal: #e5e7eb;
        --cor-sucesso: #018b06;
        --cor-falha: #be0e02;
    }
    *, ::before, ::after { box-sizing: border-box; border-width: 0; border-style: solid; }
    html { line-height: 1.5; font-family: ui-sans-serif, system-ui, sans-serif; }
    body { margin: 0; line-height: inherit; background-color: var(--cor-fundo); font-family: ui-sans-serif, system-ui, sans-serif; color: var(--cor-texto-principal); }
    button, input, select { font-family: inherit; font-size: 100%; margin: 0; padding: 0; background-color: transparent; }
    table { text-indent: 0; border-color: inherit; border-collapse: collapse; }
    .sticky { position: sticky; }
    .top-0 { top: 0px; }
    .z-50 { z-index: 50; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .flex { display: flex; }
    .h-16 { height: 4rem; }
    .w-full { width: 100%; }
    .max-w-7xl { max-width: 80rem; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-4 { gap: 1rem; }
    .rounded-xl { border-radius: .75rem; }
    .border-b { border-bottom-width: 1px; }
    .border-r { border-right-width: 1px; }
    .border-l { border-left-width: 1px; }
    .border-green-600\/60 { border-color: rgb(22 163 74 / 0.6); }
    .bg-\[\#1f2129\] { background-color: var(--cor-fundo-header); }
    .object-contain { object-fit: contain; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-2 { padding-top: .5rem; padding-bottom: .5rem; }
    .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
    .text-center { text-align: center; }
    .text-left { text-align: left; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .leading-tight { line-height: 1.25; }
    .text-white { color: #fff; }
    .drop-shadow-lg { filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1)); }
    select { background-color: var(--cor-fundo-celula) !important; color: var(--cor-principal) !important; border: 1px solid var(--cor-principal); border-radius: 6px; padding: 8px 12px; -webkit-appearance: none; appearance: none; }
    .placar { cursor: pointer; display: inline-block; padding: 2px 6px; border-radius: 6px; font-weight: 700; transition: background-color 0.2s, box-shadow 0.2s; }
    .placar-selecionado { background-color: #2596be !important; box-shadow: 0 0 8px #2596be; color: white !important; }
    .time-selecionado { background-color: #f59e0b !important; box-shadow: 0 0 8px #f59e0b; }
    .odd-selecionada { background-color: #a855f7 !important; color: white !important; border-radius: 4px; }
    .placar-futuro { background-color: #4a5568; border: 1px dashed #718096; }
    .odds { font-size: 11px; color: #cbd5e0; cursor: pointer; padding: 1px 4px; }
    #errorMessage { display: none; color: white; background-color: #dc2626; padding: 10px; margin: 10px 24px; border-radius: 8px; text-align: center; }
    #selectedRowsContainer { margin: 0 24px 20px 24px; border: 1px solid #4a5568; border-radius: 0.75rem; overflow: hidden; }
    .porcentagem-verde { color: var(--cor-principal); font-weight: bold; }
    .porcentagem-branca { color: white; }
    .tooltip { position: relative; display: inline-block; }
    .tooltip .tooltiptext { visibility: hidden; width: 160px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -80px; opacity: 0; transition: opacity 0.3s; }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
  </style>
</head>

<body>
  <div id="app">
    <header class="sticky top-0 z-50 bg-[#1f2129] border-b border-green-600/60">
      <div class="mx-auto max-w-7xl px-4">
        <div class="flex h-16 items-center justify-between gap-4">
          <a href="#" class="inline-flex items-center gap-3 shrink-0">
            <img src="https://www.caramelobet.app.br/coletor/logo.png" alt="Logo" class="h-16 w-auto object-contain drop-shadow-lg">
          </a>
          <div id="controles-tabela" class="flex items-center gap-4 text-sm text-white">
                <select id="seletorHoras" title="Quantidade de horas a serem exibidas">
                    <option value="6">6 Horas</option>
                    <option value="12" selected>12 Horas</option>
                    <option value="18">18 Horas</option>
                    <option value="24">24 Horas</option>
                </select>
                <select id="seletorResultado" title="Qual mercado analisar para acerto (verde/vermelho)">
                    <option value="over2.5">Over 2.5</option>
                    <option value="under2.5">Under 2.5</option>
                    <option value="ambasMarcam">Ambas Marcam</option>
                    <option value="ambasNaoMarcam">Ambas Não Marcam</option>
                    <option value="casaVence">Casa Vence</option>
                    <option value="foraVence">Fora Vence</option>
                    <option value="empate">Empate</option>
                </select>
                <select id="seletorTipoPlacar" title="Exibir placar do jogo inteiro (FT) ou do 1º tempo (HT)">
                    <option value="ft">Placar FT</option>
                    <option value="ht">Placar HT</option>
                </select>
                 <select id="mostrarTimes" title="Mostrar ou ocultar os nomes dos times">
                    <option value="nao">Ocultar Times</option>
                    <option value="sim">Mostrar Times</option>
                </select>
                <select id="mostrarHT" title="Mostrar ou ocultar o placar do 1º tempo junto ao placar principal">
                    <option value="nao">Ocultar HT</option>
                    <option value="sim">Mostrar HT</option>
                </select>
                <select id="mostrarOdds" title="Mostrar ou ocultar as odds (se disponíveis)">
                    <option value="nao">Ocultar Odds</option>
                    <option value="sim">Mostrar Odds</option>
                </select>
          </div>
        </div>
      </div>
    </header>
    
    <section class="px-6 py-6">
        <div class="flex justify-between items-center mb-4 text-white">
            <h2 id="ligaAtual" class="text-xl font-bold">Carregando...</h2>
            <div class="flex gap-4">
                <span id="totalGols" class="text-lg">Gols: 0</span>
                <span id="mediaGolsHora" class="text-lg">Média: 0.00</span>
            </div>
        </div>
        
        <div id="errorMessage"></div>
        
        <div id="selectedRowsContainer" style="display: none;"></div>

        <div class="rounded-xl border border-[#3d3d3d] overflow-hidden">
            <table id="tabelaResultados" class="w-full table-fixed text-sm">
              <thead></thead>
              <tbody>
                <tr><td colspan="24" class="text-center p-10">Carregando dados...</td></tr>
              </tbody>
            </table>
        </div>
    </section>

    <footer class="mt-0 py-3 text-center text-[11px] text-white">
      © <span id="yearNow"></span> — Desenvolvido por Victor Oliveira.
    </footer>
  </div>

  <script>
    // --- INÍCIO DO SEU SCRIPT DE CONFIGURAÇÃO ---
    const API_BASE_URL = "https://betstat.site";
    const LIGAS = {
        GLORIA_ETERNA: "Taça Glória Eterna", COPA_AMERICA: "Copa América", EURO: "Euro",
        ITALIANO: "Campeonato Italiano", COPA_ESTRELAS: "Copa das Estrelas", BRASILEIRAO: "Brasileirão Betano",
        KIRON_BRAZIL: "Kiron Liga Brasil", KIRON_ENGLAND: "Kiron Liga Inglaterra", KIRON_ITALY: "Kiron Liga Itália",
        KIRON_AMERICA: "Kiron Liga América Latina", KIRON_SPAIN: "Kiron Liga Espanha", ESTRELA: "estrela",
        BETSSON_ESPANHA: "Espanha", BETSSON_INGLATERRA: "Inglaterra", BETSSON_BRASIL: "Brasil"
    };
    const KIRON_URL_PARAMS = { [LIGAS.KIRON_BRAZIL]: "Brazil", [LIGAS.KIRON_ENGLAND]: "England", [LIGAS.KIRON_ITALY]: "Italy", [LIGAS.KIRON_AMERICA]: "America%20Latina", [LIGAS.KIRON_SPAIN]: "Spain" };
    const ESTRELA_URL_PARAMS = { [LIGAS.ESTRELA]: "estrela" };
    const BETSSON_URL_PARAMS = { [LIGAS.BETSSON_ESPANHA]: "Espanha", [LIGAS.BETSSON_INGLATERRA]: "Inglaterra", [LIGAS.BETSSON_BRASIL]: "Brasil" };

    const ROTAS_API = {
        resultados: (nomeLiga) => {
            const kironParam = KIRON_URL_PARAMS[nomeLiga];
            const estrelaParam = ESTRELA_URL_PARAMS[nomeLiga];
            const betssonParam = BETSSON_URL_PARAMS[nomeLiga];
            if (kironParam) return `${API_BASE_URL}/resultados/kiron/${kironParam}`;
            if (estrelaParam) return `${API_BASE_URL}/resultados/estrela/${estrelaParam}`;
            if (betssonParam) return `${API_BASE_URL}/resultados/betsson/${betssonParam}`;
            return `${API_BASE_URL}/resultados/${encodeURIComponent(nomeLiga)}`;
        },
        proximosJogos: (nomeLiga) => {
            const kironParam = KIRON_URL_PARAMS[nomeLiga];
            const estrelaParam = ESTRELA_URL_PARAMS[nomeLiga];
            const betssonParam = BETSSON_URL_PARAMS[nomeLiga];
            if (kironParam) return `${API_BASE_URL}/proximos/kiron/${kironParam}`;
            if (estrelaParam) return `${API_BASE_URL}/proximos/estrela/${estrelaParam}`;
            if (betssonParam) return `${API_BASE_URL}/proximos/betsson/${betssonParam}`;
            return `${API_BASE_URL}/proximos/${encodeURIComponent(nomeLiga)}`;
        },
        odds: (nomeLiga) => {
            const kironParam = KIRON_URL_PARAMS[nomeLiga];
            const estrelaParam = ESTRELA_URL_PARAMS[nomeLiga];
            const betssonParam = BETSSON_URL_PARAMS[nomeLiga];
            if (kironParam) return `${API_BASE_URL}/odds/kiron/${kironParam}`;
            if (estrelaParam) return `${API_BASE_URL}/odds/estrela/${estrelaParam}`;
            if (betssonParam) return `${API_BASE_URL}/odds/betsson/${betssonParam}`;
            return `${API_BASE_URL}/odds/${encodeURIComponent(nomeLiga)}`;
        }
    };

    function detectarLigaAtual() {
        const caminho = (window.location.pathname || "").toLowerCase();
        if (caminho.includes("brasileirao.html")) return LIGAS.BRASILEIRAO;
        if (caminho.includes("campeonato_italiano.html")) return LIGAS.ITALIANO;
        if (caminho.includes("copa_america.html")) return LIGAS.COPA_AMERICA;
        if (caminho.includes("copa_das_estrelas.html")) return LIGAS.COPA_ESTRELAS;
        if (caminho.includes("euro.html")) return LIGAS.EURO;
        if (caminho.includes("kironbrazil.html")) return LIGAS.KIRON_BRAZIL;
        if (caminho.includes("kironengland.html")) return LIGAS.KIRON_ENGLAND;
        if (caminho.includes("kironitaly.html")) return LIGAS.KIRON_ITALY;
        if (caminho.includes("kironamerica.html")) return LIGAS.KIRON_AMERICA;
        if (caminho.includes("kironspain.html")) return LIGAS.KIRON_SPAIN;
        if (caminho.includes("estrela.html")) return LIGAS.ESTRELA;
        if (caminho.includes("betsespanha.html")) return LIGAS.BETSSON_ESPANHA;
        if (caminho.includes("betsbrasil.html")) return LIGAS.BETSSON_BRASIL;
        if (caminho.includes("betsinglaterra.html")) return LIGAS.BETSSON_INGLATERRA;
        return LIGAS.GLORIA_ETERNA;
    }

    const LIGA_ATUAL = detectarLigaAtual();
    // --- FIM DO SEU SCRIPT DE CONFIGURAÇÃO ---

    // --- INÍCIO DO SCRIPT DA TABELA ADAPTADO ---
    document.getElementById("yearNow").textContent = new Date().getFullYear();
    document.getElementById("ligaAtual").textContent = LIGA_ATUAL;

    const minutosFixos = [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, 43, 46, 49, 52, 55, 58];
    
    let placarSelecionado = localStorage.getItem("placarSelecionado");
    let timeSelecionado = localStorage.getItem("timeSelecionado");
    let oddSelecionada = localStorage.getItem("oddSelecionada");
    let selectedChaves = JSON.parse(localStorage.getItem("selectedChaves")) || [];

    function showErrorMessage(message) {
      const errorMessageDiv = document.getElementById("errorMessage");
      errorMessageDiv.textContent = message;
      errorMessageDiv.style.display = "block";
    }

    function hideErrorMessage() {
      const errorMessageDiv = document.getElementById("errorMessage");
      errorMessageDiv.style.display = "none";
    }

    function selecionarPlacaresIguais(placarAlvo) {
      document.querySelectorAll(".placar").forEach(placar => {
        const texto = placar.querySelector(".placar-texto")?.textContent.trim() || placar.textContent.trim();
        placar.classList.toggle("placar-selecionado", placarAlvo && texto.includes(placarAlvo));
      });
    }

    function selecionarJogosPorTime(timeAlvo) {
        const mostrar = document.querySelector("#mostrarTimes").value === "sim";
        document.querySelectorAll(".placar").forEach(placar => {
            const timeA = placar.getAttribute("data-time-a");
            const timeB = placar.getAttribute("data-time-b");
            placar.classList.toggle("time-selecionado", mostrar && timeAlvo && (timeA === timeAlvo || timeB === timeAlvo));
        });
    }
    
    // ... (outras funções utilitárias como selecionarOddsIguais, calculateGoalStats, etc., podem ser adicionadas aqui se necessário)

    function abbreviateTeamName(teamName) {
        if (!teamName) return "";
        const words = teamName.trim().split(" ");
        if (words.length > 1) return words.map(w => w[0]).join('').toUpperCase();
        return teamName.slice(0, 4).toUpperCase();
    }
    
    function criarTabela(dados, oddsData, proximosJogos) {
        const tabela = document.getElementById("tabelaResultados");
        const thead = tabela.querySelector("thead");
        const tbody = tabela.querySelector("tbody");

        thead.innerHTML = "";
        tbody.innerHTML = "";
        
        // Cabeçalho da Tabela
        const trHeader = document.createElement("tr");
        let headerHTML = `<th class="sticky left-0 z-10 bg-[#1f2129] text-gray-300 font-semibold px-2 py-2 text-left border-r border-[#555] text-[13px] leading-tight">⏰</th>`;
        minutosFixos.forEach(min => headerHTML += `<th class="text-center font-medium p-2">${String(min).padStart(2, '0')}</th>`);
        headerHTML += `<th class="text-center font-medium p-2">📊</th><th class="text-center font-medium p-2">✔️</th><th class="text-center font-medium p-2">⚽</th>`;
        trHeader.innerHTML = headerHTML;
        thead.appendChild(trHeader);

        const seletorHoras = document.querySelector("#seletorHoras");
        const seletorResultado = document.querySelector("#seletorResultado");
        const seletorTipoPlacar = document.querySelector("#seletorTipoPlacar");
        const mostrarTimes = document.querySelector("#mostrarTimes").value === "sim";
        const mostrarHT = document.querySelector("#mostrarHT").value === "sim";
        const mostrarOdds = document.querySelector("#mostrarOdds").value === "sim";

        // Agrupar dados por hora
        const dadosPorHora = dados.reduce((acc, jogo) => {
            const hora = jogo.hora.toString().padStart(2, '0');
            if (!acc[hora]) acc[hora] = [];
            acc[hora].push(jogo);
            return acc;
        }, {});
        
        const horasOrdenadas = Object.keys(dadosPorHora).sort((a, b) => b.localeCompare(a)).slice(0, parseInt(seletorHoras.value));
        
        horasOrdenadas.forEach(hora => {
            const jogosDaHora = dadosPorHora[hora];
            const linha = document.createElement("tr");
            linha.className = "border-b border-[#3d3d3d]";
            
            let linhaHTML = `<th class="sticky left-0 z-10 bg-[#1f2129] text-gray-300 font-medium px-2 py-2 text-center border-t border-r border-[#555] text-[15px] leading-tight">${hora}</th>`;
            
            const celulas = {};
            minutosFixos.forEach(min => celulas[min] = "");

            jogosDaHora.forEach(dado => {
                let placarHTML = '<div class="placar" data-time-a="${dado.time_a}" data-time-b="${dado.time_b}">';
                const primaryScore = seletorTipoPlacar.value === 'ft' ? dado.ft : dado.ht;
                const secondaryScore = seletorTipoPlacar.value === 'ft' ? dado.ht : dado.ft;

                let textoPlacar = "";
                 if (mostrarTimes) {
                    textoPlacar = `<span class="time-casa" data-full-time="${dado.time_a}">${abbreviateTeamName(dado.time_a)}</span> ${primaryScore} <span class="time-fora" data-full-time="${dado.time_b}">${abbreviateTeamName(dado.time_b)}</span>`;
                } else {
                    textoPlacar = primaryScore;
                }
                if(mostrarHT) textoPlacar += ` <span style="font-size:10px; color: #a0aec0;">(${secondaryScore})</span>`;
                
                placarHTML += `<div class="placar-texto">${textoPlacar}</div>`;
                // Adicionar lógica de odds aqui se necessário
                placarHTML += '</div>';

                // Lógica de acerto
                let acerto = false;
                const [golsA, golsB] = primaryScore.split(' x ').map(Number);
                const totalGols = golsA + golsB;
                 switch (seletorResultado.value) {
                    case "over2.5": acerto = totalGols > 2.5; break;
                    case "under2.5": acerto = totalGols < 2.5; break;
                    case "ambasMarcam": acerto = golsA > 0 && golsB > 0; break;
                    case "ambasNaoMarcam": acerto = golsA === 0 || golsB === 0; break;
                    case "casaVence": acerto = golsA > golsB; break;
                    case "foraVence": acerto = golsB > golsA; break;
                    case "empate": acerto = golsA === golsB; break;
                }
                const bgColor = acerto ? 'var(--cor-sucesso)' : 'var(--cor-falha)';

                celulas[dado.minuto] = `<td class="p-1 align-top text-center border-l border-[#3d3d3d]" style="background-color:${bgColor};">${placarHTML}</td>`;
            });

            minutosFixos.forEach(min => {
                linhaHTML += celulas[min] || '<td class="p-1 align-top text-center border-l border-[#3d3d3d]"></td>';
            });
            
            // Stats da linha
            linhaHTML += `<td class="p-2 text-center border-l border-[#3d3d3d]">0%</td>`;
            linhaHTML += `<td class="p-2 text-center border-l border-[#3d3d3d]">0</td>`;
            linhaHTML += `<td class="p-2 text-center border-l border-[#3d3d3d]">0</td>`;

            linha.innerHTML = linhaHTML;
            tbody.appendChild(linha);
        });
        
        updateAllStats();
    }

    function updateAllStats() {
        let totalGolsGeral = 0;
        let totalLinhas = 0;
        document.querySelectorAll("#tabelaResultados tbody tr").forEach(linha => {
            totalLinhas++;
            const celulas = Array.from(linha.cells).slice(1, -3);
            let acertos = 0, totalJogos = 0, golsLinha = 0;

            celulas.forEach(cel => {
                if (cel.querySelector(".placar")) {
                    totalJogos++;
                    if (cel.style.backgroundColor === 'var(--cor-sucesso)') acertos++;
                    
                    const placarTexto = cel.querySelector('.placar-texto')?.textContent || "0 x 0";
                    const placarPartes = placarTexto.match(/(\d+)\s*x\s*(\d+)/);
                     if (placarPartes) {
                        golsLinha += parseInt(placarPartes[1]) + parseInt(placarPartes[2]);
                    }
                }
            });
            totalGolsGeral += golsLinha;

            const percentual = totalJogos > 0 ? Math.round((acertos / totalJogos) * 100) : 0;
            linha.cells[linha.cells.length - 3].textContent = `${percentual}%`;
            linha.cells[linha.cells.length - 3].className = `p-2 text-center border-l border-[#3d3d3d] ${percentual >= 50 ? 'porcentagem-verde' : 'porcentagem-branca'}`;
            linha.cells[linha.cells.length - 2].textContent = acertos;
            linha.cells[linha.cells.length - 1].textContent = golsLinha;
        });

        document.getElementById("totalGols").textContent = `Gols: ${totalGolsGeral}`;
        const media = totalLinhas > 0 ? (totalGolsGeral / totalLinhas).toFixed(2) : "0.00";
        document.getElementById("mediaGolsHora").textContent = `Média: ${media}`;
    }

    async function buscarDados() {
        hideErrorMessage();
        const tabelaBody = document.querySelector("#tabelaResultados tbody");
        tabelaBody.innerHTML = '<tr><td colspan="24" class="text-center p-10">Buscando dados atualizados...</td></tr>';

        try {
            const response = await fetch(ROTAS_API.resultados(LIGA_ATUAL));
            if (!response.ok) throw new Error(`Erro na API: ${response.statusText}`);
            
            // IMPORTANTE: Ajuste o processamento aqui para corresponder à estrutura de dados da SUA API
            const dados = await response.json(); // Assumindo que sua API retorna o formato esperado
            
            // Se sua API não retorna o mesmo formato, você precisará adaptar aqui.
            // Exemplo: const dadosProcessados = dados.map(item => ({...}));

            const oddsData = []; // await fetch(ROTAS_API.odds(LIGA_ATUAL)).then(res => res.json());
            const proximosJogos = []; // await fetch(ROTAS_API.proximosJogos(LIGA_ATUAL)).then(res => res.json());

            if (dados && dados.length > 0) {
                criarTabela(dados, oddsData, proximosJogos);
            } else {
                showErrorMessage("Nenhum resultado encontrado para esta liga.");
                tabelaBody.innerHTML = '<tr><td colspan="24" class="text-center p-10">Nenhum resultado encontrado.</td></tr>';
            }
        } catch (error) {
            console.error("Falha ao buscar dados:", error);
            showErrorMessage(`Erro ao carregar dados: ${error.message}`);
            tabelaBody.innerHTML = `<tr><td colspan="24" class="text-center p-10 text-red-500">Falha ao carregar dados. Tente novamente.</td></tr>`;
        }
    }
    
    // Event Listeners
    document.querySelectorAll("#controles-tabela select").forEach(select => {
        select.addEventListener("change", buscarDados);
    });

    // Inicia a busca de dados
    document.addEventListener('DOMContentLoaded', () => {
        buscarDados();
        setInterval(buscarDados, 60000); // Atualiza a cada 60 segundos
    });
    // --- FIM DO SCRIPT DA TABELA ADAPTADO ---
  </script>
</body>
</html>