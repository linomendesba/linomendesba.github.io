<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="style.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
        <script
          async
          src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"
        ></script>
        <title>BetStat</title>
        <!-- Meta tags SEO principais -->
        <meta
          name="description"
          content="Transforme suas apostas com BetStat - a √∫nica plataforma especializada em futebol virtual Betano. An√°lises precisas, estat√≠sticas confi√°veis e resultados comprovados para investimentos inteligentes."
        />
        <meta
          name="keywords"
          content="BetStat, apostas esportivas, futebol virtual, Betano, estat√≠sticas apostas, an√°lise apostas, investimentos esportivos"
        />
    
        <!-- Open Graph meta tags para redes sociais -->
        <meta
          property="og:title"
          content="BetStat | Plataforma de An√°lise para Apostas Esportivas"
        />
        <meta
          property="og:description"
          content="Transforme suas apostas com an√°lises precisas e estat√≠sticas confi√°veis. A √∫nica plataforma especializada em futebol virtual Betano."
        />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.betstat.site/payment.html" />
        <meta property="og:site_name" content="BetStat" />
    
        <!-- Meta tags adicionais -->
        <meta name="robots" content="index, follow" />
        <meta name="author" content="BetStat" />
        <meta name="canonical" href="https://www.betstat.site/payment.html" />
        <script type="module" src="js/firebase-auth.js"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());
    
          gtag("config", "G-4WT805FFHQ");
        </script>
        <link
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
          rel="stylesheet"
        />
      </head>

  <body>
    <body>
        <div id="header"></div>

    <br><br>

    <div class="seletor-container">
        <div class="seletor-horas">
            <label for="seletorHoras">Horas:</label>
            <select id="seletorHoras">
                <option value="3">3 horas</option>
                <option value="6" selected>6 horas</option>
                <option value="12">12 horas</option>
                <option value="24">24 horas</option>
            </select>
        </div>
    
        <div class="seletor-resultado">
            <label for="seletorResultado">Mercado:</label>
            <select id="seletorResultado">
                <option value="ambasMarcam" selected>Ambas Sim</option>
                <option value="ambasNaoMarcam">Ambas N√£o</option>
                <option value="casaVence">Casa vence</option>
                <option value="foraVence">Fora vence</option>
                <option value="empate">Empate</option> 
                <option value="over1.5">Over 1.5</option>
                <option value="under1.5">Under 1.5</option>
                <option value="over2.5">Over 2.5</option>
                <option value="under2.5">Under 2.5</option>
                <option value="over3.5">Over 3.5</option>
                <option value="under3.5">Under 3.5</option>
                <option value="over5">Over 5+</option>
            </select>
        </div>
    
        <div class="seletor-tipo-placar">
            <label for="seletorTipoPlacar">Resultado:</label>
            <select id="seletorTipoPlacar">
                <option value="ft" selected>FT</option>
                <option value="ht">HT</option>
            </select>
        </div>
    </div>
    
<!-- Copa Am√©rica Table -->
<h3>Copa Am√©rica</h3>

<div class="jogosfuturos-container" id="jogosfuturos-copaAmerica-container">
    <div class="jogosfuturos-games-container" id="jogosfuturos-copaAmerica"></div>
</div>

<table id="tabelaResultadosCopaAmerica" class="tabela-liga">
    <thead>
        <div class="minutofixo-header">
            <div id="market-percentages-copa-america"></div> 
        </div>
        <tr id="linhaPercentualCopaAmerica" class="linha-percentual">
            <th>üìä</th>
        </tr>
        <tr>
            <th>H</th>
            <th class="minute-header">2</th>
            <th class="minute-header">5</th>
            <th class="minute-header">8</th>
            <th class="minute-header">11</th>
            <th class="minute-header">14</th>
            <th class="minute-header">17</th>
            <th class="minute-header">20</th>
            <th class="minute-header">23</th>
            <th class="minute-header">26</th>
            <th class="minute-header">29</th>
            <th class="minute-header">32</th>
            <th class="minute-header">35</th>
            <th class="minute-header">38</th>
            <th class="minute-header">41</th>
            <th class="minute-header">44</th>
            <th class="minute-header">47</th>
            <th class="minute-header">50</th>
            <th class="minute-header">53</th>
            <th class="minute-header">56</th>
            <th class="minute-header">59</th>
            <th>‚öΩÔ∏è</th>
            <th>‚úÖ</th>
            <th>üìä</th>
        </tr>
    </thead>    
    <tbody></tbody>
</table>

<!-- Ta√ßa Gl√≥ria Eterna Table -->
<h3>Ta√ßa Gl√≥ria Eterna</h3>
  <table id="tabelaResultadosTacaGloriaEterna">
    <thead>
      <tr id="linhaPercentualTacaGloriaEterna">
        <th>üìä</th>
      </tr>
      <tr id="linhaTotalGolsTacaGloriaEterna">
        <th>‚öΩ</th>
      </tr>
      <tr id="linhaAcertosMercadoTacaGloriaEterna">
        <th>‚úîÔ∏è</th>
      </tr>
      <tr>
        <th>H/M</th>
        <th class="minute-header">1</th>
        <th class="minute-header">4</th>
        <th class="minute-header">7</th>
        <th class="minute-header">10</th>
        <th class="minute-header">13</th>
        <th class="minute-header">16</th>
        <th class="minute-header">19</th>
        <th class="minute-header">22</th>
        <th class="minute-header">25</th>
        <th class="minute-header">28</th>
        <th class="minute-header">31</th>
        <th class="minute-header">34</th>
        <th class="minute-header">37</th>
        <th class="minute-header">40</th>
        <th class="minute-header">43</th>
        <th class="minute-header">46</th>
        <th class="minute-header">49</th>
        <th class="minute-header">52</th>
        <th class="minute-header">55</th>
        <th class="minute-header">58</th>
        <th>‚öΩÔ∏è</th>
        <th>‚úîÔ∏è</th>
        <th>üìä</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot></tfoot>
  </table>

<!-- Euro League Table -->
<h3>Euro</h3>
<div class="jogosfuturos-container" id="jogosfuturos-euro-container">
    <div class="jogosfuturos-games-container" id="jogosfuturos-euro"></div>
</div>
<table id="tabelaResultadosEuro" class="tabela-liga">
    <thead>
        <div class="minutofixo-header">
            <div id="market-percentages-euro"></div> 
        </div>
        <tr id="linhaPercentualEuro" class="linha-percentual">
            <th>üìä</th>
        </tr>
        <tr>
            <th>H</th>
            <th class="minute-header">1</th>
            <th class="minute-header">4</th>
            <th class="minute-header">7</th>
            <th class="minute-header">10</th>
            <th class="minute-header">13</th>
            <th class="minute-header">16</th>
            <th class="minute-header">19</th>
            <th class="minute-header">22</th>
            <th class="minute-header">25</th>
            <th class="minute-header">28</th>
            <th class="minute-header">31</th>
            <th class="minute-header">34</th>
            <th class="minute-header">37</th>
            <th class="minute-header">40</th>
            <th class="minute-header">43</th>
            <th class="minute-header">46</th>
            <th class="minute-header">49</th>
            <th class="minute-header">52</th>
            <th class="minute-header">55</th>
            <th class="minute-header">58</th>
            <th>‚öΩÔ∏è</th>
            <th>‚úÖ</th>
            <th>üìä</th>
        </tr>
    </thead>    
    <tbody></tbody>
</table>

<!-- Campeonato Italiano Table -->
<h3>Campeonato Italiano</h3>
<div class="jogosfuturos-container" id="jogosfuturos-campeonatoItaliano-container">
    <div class="jogosfuturos-games-container" id="jogosfuturos-campeonatoItaliano"></div>
</div>
<table id="tabelaResultadosItaliano" class="tabela-liga">
    <thead>
        <div class="minutofixo-header">
            <div id="market-percentages-italiano"></div> 
        </div>
        <tr id="linhaPercentualItaliano" class="linha-percentual">
            <th>üìä</th>
        </tr>
        <tr>
            <th>H</th>
            <th class="minute-header">2</th>
            <th class="minute-header">5</th>
            <th class="minute-header">8</th>
            <th class="minute-header">11</th>
            <th class="minute-header">14</th>
            <th class="minute-header">17</th>
            <th class="minute-header">20</th>
            <th class="minute-header">23</th>
            <th class="minute-header">26</th>
            <th class="minute-header">29</th>
            <th class="minute-header">32</th>
            <th class="minute-header">35</th>
            <th class="minute-header">38</th>
            <th class="minute-header">41</th>
            <th class="minute-header">44</th>
            <th class="minute-header">47</th>
            <th class="minute-header">50</th>
            <th class="minute-header">53</th>
            <th class="minute-header">56</th>
            <th class="minute-header">59</th>
            <th>‚öΩÔ∏è</th>
            <th>‚úÖ</th>
            <th>üìä</th>
        </tr>
    </thead>    
    <tbody></tbody>
</table>

<!-- Copa das Estrelas Table -->
<h3>Copa das Estrelas</h3>
<div class="jogosfuturos-container" id="jogosfuturos-copaEstrelas-container">
    <div class="jogosfuturos-games-container" id="jogosfuturos-copaEstrelas"></div>
</div>
<table id="tabelaResultadosCopaEstrelas" class="tabela-liga">
    <thead>
        <div class="minutofixo-header">
            <div id="market-percentages-copa-estrelas"></div> 
        </div>
        <tr id="linhaPercentualCopaEstrelas" class="linha-percentual">
            <th>üìä</th>
        </tr>
        <tr>
            <th>H</th>
            <th class="minute-header">0</th>
            <th class="minute-header">3</th>
            <th class="minute-header">6</th>
            <th class="minute-header">9</th>
            <th class="minute-header">12</th>
            <th class="minute-header">15</th>
            <th class="minute-header">18</th>
            <th class="minute-header">21</th>
            <th class="minute-header">24</th>
            <th class="minute-header">27</th>
            <th class="minute-header">30</th>
            <th class="minute-header">33</th>
            <th class="minute-header">36</th>
            <th class="minute-header">39</th>
            <th class="minute-header">42</th>
            <th class="minute-header">45</th>
            <th class="minute-header">48</th>
            <th class="minute-header">51</th>
            <th class="minute-header">54</th>
            <th class="minute-header">57</th>
            <th>‚öΩÔ∏è</th>
            <th>‚úÖ</th>
            <th>üìä</th>
        </tr>
    </thead>    
    <tbody></tbody>
</table>

<!-- British Derbies  -->
<h3>Brasileir√£o Betano</h3>
<div class="jogosfuturos-container" id="jogosfuturos-brasileirao-container">
    <div class="jogosfuturos-games-container" id="jogosfuturos-brasileirao"></div>
</div>
<table id="tabelaResultadosBrasileirao" class="tabela-liga">
    <thead>
        <div class="minutofixo-header">
            <div id="market-percentages-Brasileirao"></div> 
        </div>
        <tr id="linhaPercentualBrasileirao" class="linha-percentual">
            <th>üìä</th>
        </tr>
        <tr>
            <th>H</th>
            <th class="minute-header">0</th>
            <th class="minute-header">3</th>
            <th class="minute-header">6</th>
            <th class="minute-header">9</th>
            <th class="minute-header">12</th>
            <th class="minute-header">15</th>
            <th class="minute-header">18</th>
            <th class="minute-header">21</th>
            <th class="minute-header">24</th>
            <th class="minute-header">27</th>
            <th class="minute-header">30</th>
            <th class="minute-header">33</th>
            <th class="minute-header">36</th>
            <th class="minute-header">39</th>
            <th class="minute-header">42</th>
            <th class="minute-header">45</th>
            <th class="minute-header">48</th>
            <th class="minute-header">51</th>
            <th class="minute-header">54</th>
            <th class="minute-header">57</th>
            <th>‚öΩÔ∏è</th>
            <th>‚úÖ</th>
            <th>üìä</th>
        </tr>
    </thead>    
    <tbody></tbody>
</table>


    <script>
const leagues = [
  {
    name: "Ta√ßa Gl√≥ria Eterna",
    results_url: "https://betstat.site/resultados/Ta%C3%A7a%20Gl%C3%B3ria%20eterna",
    odds_url: "https://betstat.site/odds/Ta%C3%A7a%20Gl%C3%B3ria%20Eterna",
    proximos_url: "https://betstat.site/proximos/Ta%C3%A7a%20Gl%C3%B3ria%20Eterna",
    minutosFixos: [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, 43, 46, 49, 52, 55, 58],
    tabelaId: "tabelaResultadosTacaGloriaEterna",
    linhaPercentualId: "linhaPercentualTacaGloriaEterna",
    linhaTotalGolsId: "linhaTotalGolsTacaGloriaEterna",
    linhaAcertosMercadoId: "linhaAcertosMercadoTacaGloriaEterna"
  },
  {
    name: "Copa Am√©rica",
    results_url: "https://betstat.site/resultados/Copa%20Am%C3%A9rica",
    odds_url: "https://betstat.site/odds/Copa%20Am%C3%A9rica",
    proximos_url: "https://betstat.site/proximos/Copa%20Am%C3%A9rica",
    minutosFixos: [2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35, 38, 41, 44, 47, 50, 53, 56, 59],
    tabelaId: "tabelaResultadosCopaAmerica",
    linhaPercentualId: "linhaPercentualCopaAmerica",
    linhaTotalGolsId: "linhaTotalGolsCopaAmerica",
    linhaAcertosMercadoId: "linhaAcertosMercadoCopaAmerica"
  },
  {
    name: "Euro",
    results_url: "https://betstat.site/resultados/Euro",
    odds_url: "https://betstat.site/odds/Euro",
    proximos_url: "https://betstat.site/proximos/Euro",
    minutosFixos: [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, 43, 46, 49, 52, 55, 58],
    tabelaId: "tabelaResultadosEuro",
    linhaPercentualId: "linhaPercentualEuro",
    linhaTotalGolsId: "linhaTotalGolsEuro",
    linhaAcertosMercadoId: "linhaAcertosMercadoEuro"
  },
  {
    name: "Campeonato Italiano",
    results_url: "https://betstat.site/resultados/Campeonato%20Italiano",
    odds_url: "https://betstat.site/odds/Campeonato%20Italiano",
    proximos_url: "https://betstat.site/proximos/Campeonato%20Italiano",
    minutosFixos: [2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35, 38, 41, 44, 47, 50, 53, 56, 59],
    tabelaId: "tabelaResultadosCampeonatoItaliano",
    linhaPercentualId: "linhaPercentualCampeonatoItaliano",
    linhaTotalGolsId: "linhaTotalGolsCampeonatoItaliano",
    linhaAcertosMercadoId: "linhaAcertosMercadoCampeonatoItaliano"
  },
  {
    name: "Copa das Estrelas",
    results_url: "https://betstat.site/resultados/Copa%20das%20Estrelas",
    odds_url: "https://betstat.site/odds/Copa%20das%20Estrelas",
    proximos_url: "https://betstat.site/proximos/Copa%20das%20Estrelas",
    minutosFixos: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57],
    tabelaId: "tabelaResultadosCopaDasEstrelas",
    linhaPercentualId: "linhaPercentualCopaDasEstrelas",
    linhaTotalGolsId: "linhaTotalGolsCopaDasEstrelas",
    linhaAcertosMercadoId: "linhaAcertosMercadoCopaDasEstrelas"
  },
  {
    name: "Brasileir√£o Betano",
    results_url: "https://betstat.site/resultados/Brasileir%C3%A3o%20Betano",
    odds_url: "https://betstat.site/odds/Brasileir%C3%A3o%20Betano",
    proximos_url: "https://betstat.site/proximos/Brasileir%C3%A3o%20Betano",
    minutosFixos: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57],
    tabelaId: "tabelaResultadosBrasileiraoBetano",
    linhaPercentualId: "linhaPercentualBrasileiraoBetano",
    linhaTotalGolsId: "linhaTotalGolsBrasileiraoBetano",
    linhaAcertosMercadoId: "linhaAcertosMercadoBrasileiraoBetano"
  }
];

let placarSelecionado = localStorage.getItem("placarSelecionado");
let timeSelecionado = localStorage.getItem("timeSelecionado");
let oddSelecionada = localStorage.getItem("oddSelecionada");

function showErrorMessage(message) {
  const errorMessageDiv = document.getElementById("errorMessage");
  errorMessageDiv.textContent = message;
  errorMessageDiv.style.display = "block";
}

function hideErrorMessage() {
  const errorMessageDiv = document.getElementById("errorMessage");
  errorMessageDiv.textContent = "";
  errorMessageDiv.style.display = "none";
}

function selecionarPlacaresIguais(placarAlvo) {
  const placares = document.querySelectorAll(".placar");
  placares.forEach((placar) => {
    const texto = placar.querySelector(".placar-texto")?.textContent.trim() || placar.textContent.trim();
    if (placarAlvo && texto.includes(placarAlvo)) {
      placar.classList.add("placar-selecionado");
    } else {
      placar.classList.remove("placar-selecionado");
    }
  });
}

function selecionarJogosPorTime(timeAlvo) {
  const placares = document.querySelectorAll(".placar");
  if (!timeAlvo || document.querySelector("#mostrarTimes").value !== "sim") {
    placares.forEach((placar) => {
      placar.classList.remove("time-selecionado");
    });
    return;
  }
  placares.forEach((placar) => {
    const timeA = placar.getAttribute("data-time-a");
    const timeB = placar.getAttribute("data-time-b");
    if (timeA === timeAlvo || timeB === timeAlvo) {
      placar.classList.add("time-selecionado");
    } else {
      placar.classList.remove("time-selecionado");
    }
  });
}

function selecionarOddsIguais(oddAlvo) {
  const oddsElements = document.querySelectorAll(".odds");
  oddsElements.forEach((oddElement) => {
    const oddTexto = oddElement.textContent.trim();
    if (oddAlvo && oddTexto === oddAlvo) {
      oddElement.classList.add("odd-selecionada");
    } else {
      oddElement.classList.remove("odd-selecionada");
    }
  });
}

function calculateGoalStats(todasLinhas) {
  const totalGols = todasLinhas.reduce(
    (acc, row) =>
      acc + parseInt(row.children[row.children.length - 3].textContent || 0),
    0
  );
  const totalHorasJogadas = todasLinhas.length;
  const mediaGolsHora =
    totalHorasJogadas > 0
      ? (totalGols / totalHorasJogadas).toFixed(2)
      : 0;

  return {
    totalGols,
    mediaGolsHora,
  };
}

async function fetchOdds(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Erro ao buscar odds: ${response.status} ${response.statusText}`);
    }
    const oddsData = await response.json();
    console.log("Odds fetched:", oddsData);
    return oddsData;
  } catch (error) {
    console.error("Erro ao buscar odds:", error);
    return [];
  }
}

async function fetchProximosJogos(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Erro ao buscar pr√≥ximos jogos: ${response.status} ${response.statusText}`);
    }
    const jogos = await response.json();
    console.log("Pr√≥ximos jogos fetched:", jogos);
    return jogos.sort((a, b) => new Date(a.start_time) - new Date(b.start_time)).slice(0, 6);
  } catch (error) {
    console.error("Erro ao buscar pr√≥ximos jogos:", error);
    showErrorMessage(`Erro ao carregar pr√≥ximos jogos: ${error.message}`);
    return [];
  }
}

async function fetchResultados(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Erro ao buscar resultados: ${response.status} ${response.statusText}`);
    }
    const dados = await response.json();
    console.log("Resultados fetched:", dados);
    return dados;
  } catch (error) {
    console.error("Erro ao buscar resultados:", error);
    showErrorMessage(`Erro ao carregar resultados: ${error.message}`);
    return [];
  }
}

function normalizeString(str) {
  return str.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
}

function formatDateToDDMMYYYY(dateStr) {
  let date;
  if (dateStr.includes("T")) {
    date = new Date(dateStr);
    date = new Date(date.getTime() - 3 * 60 * 60 * 1000); // Ajustar para -03:00
  } else {
    const [day, month, year] = dateStr.split("/");
    date = new Date(`${year}-${month}-${day}T00:00:00-03:00`);
  }
  if (isNaN(date)) return null;
  const day = date.getDate().toString().padStart(2, "0");
  const month = (date.getMonth() + 1).toString().padStart(2, "0");
  const year = date.getFullYear();
  return `${day}/${month}/${year}`;
}

function findOddsForMatch(match, oddsData) {
  const matchDate = formatDateToDDMMYYYY(match.data); // e.g., "12/06/2025"
  const matchTime = `${match.hora.toString().padStart(2, "0")}:${match.minuto.toString().padStart(2, "0")}`; // e.g., "07:43"
  const teamMapping = {
    "peixe": "boca",
    // Add other mappings as needed
  };
  const matchTimeA = normalizeString(teamMapping[match.time_a.toLowerCase()] || match.time_a);
  const matchTimeB = normalizeString(teamMapping[match.time_b.toLowerCase()] || match.time_b);

  console.log(`Searching odds for match: ${matchTimeA} vs ${matchTimeB} on ${matchDate} at ${matchTime}`);

  // Primary match: full criteria
  let matchedOdd = oddsData.find(odd => {
    const oddDate = odd.data_captura; // e.g., "13/08/2025"
    const oddTime = odd.horario; // e.g., "07:43"
    const oddTimeCasa = normalizeString(odd.time_casa);
    const oddTimeVisitante = normalizeString(odd.time_visitante);

    const isMatch =
      oddTimeCasa === matchTimeA &&
      oddTimeVisitante === matchTimeB &&
      oddDate === matchDate &&
      oddTime === matchTime;

    if (isMatch) {
      console.log(`Found odds by full match:`, odd);
    }
    return isMatch;
  });

  // Fallback: match by one team and time
  if (!matchedOdd) {
    matchedOdd = oddsData.find(odd => {
      const oddTime = odd.horario;
      const oddTimeCasa = normalizeString(odd.time_casa);
      const oddTimeVisitante = normalizeString(odd.time_visitante);
      const isTeamMatch =
        (oddTimeCasa === matchTimeA || oddTimeVisitante === matchTimeA || 
         oddTimeCasa === matchTimeB || oddTimeVisitante === matchTimeB) &&
        oddTime === matchTime;
      if (isTeamMatch) {
        console.log(`Found odds by team and time:`, odd);
      }
      return isTeamMatch;
    });
  }

  if (!matchedOdd) {
    console.log(`No odds found for ${matchTimeA} vs ${matchTimeB} on ${matchDate} at ${matchTime}`);
  }

  return matchedOdd;
}

function getOddValue(odds, resultado) {
  const oddMap = {
    ambasMarcam: "odds_ambas_marcam_sim",
    ambasNaoMarcam: "odds_ambas_marcam_nao",
    casaVence: "odds_casa_vence",
    foraVence: "odds_visitante_vence",
    empate: "odds_empate",
    "over1.5": "odds_mais_1_5",
    "under1.5": "odds_menos_1_5",
    "over2.5": "odds_mais_2_5",
    "under2.5": "odds_menos_2_5",
    "over3.5": "odds_mais_3_5",
    "under3.5": "odds_menos_3_5",
    over5: "odds_mais_5_gols",
  };
  const oddValue = odds ? odds[oddMap[resultado]] || "N/A" : "N/A";
  return oddValue;
}

function extractTimeFromDateTime(dateTimeStr) {
  if (!dateTimeStr || isNaN(new Date(dateTimeStr))) {
    console.warn(`Data/hora inv√°lida: ${dateTimeStr}`);
    return { time: "Hor√°rio indispon√≠vel", date: null, hour: null, minute: null };
  }
  const date = new Date(dateTimeStr);
  const offsetDate = new Date(date.getTime() - 3 * 60 * 60 * 1000); // Subtrair 3 horas
  const hour = offsetDate.getHours();
  const minute = offsetDate.getMinutes();
  const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
  const closestMinute = minutosFixos.reduce((prev, curr) =>
    Math.abs(curr - minute) < Math.abs(prev - minute) ? curr : prev
  );
  console.log(`Parsed time: ${dateTimeStr} -> local time: ${offsetDate.toISOString()} -> hour: ${hour}, minute: ${minute}, closestMinute: ${closestMinute}`);
  return { time, date: offsetDate, hour, minute: closestMinute };
}

function abbreviateTeamName(teamName) {
  if (!teamName) return "";
  const words = teamName.trim().split(" ");
  if (words.length > 1) {
    return words.map(word => word.charAt(0).toUpperCase()).join("") + words[words.length - 1].slice(0, 3).toLowerCase();
  }
  return teamName.length > 5 ? teamName.slice(0, 5).toUpperCase() : teamName.toUpperCase();
}

function criarTabela(dados, oddsData, proximosJogos, league) {
  const tabelaBody = document.querySelector(`#${league.tabelaId} tbody`);
  const linhaPercentual = document.getElementById(league.linhaPercentualId);
  const linhaTotalGols = document.getElementById(league.linhaTotalGolsId);
  const linhaAcertosMercado = document.getElementById(league.linhaAcertosMercadoId);
  if (!tabelaBody || !linhaPercentual || !linhaTotalGols || !linhaAcertosMercado) {
    console.error("Elementos da tabela n√£o encontrados!");
    showErrorMessage("Erro interno: Estrutura da tabela n√£o encontrada.");
    return;
  }

  linhaPercentual.innerHTML = "<th>üìä</th>";
  linhaTotalGols.innerHTML = "<th>‚öΩ</th>";
  linhaAcertosMercado.innerHTML = "<th>‚úîÔ∏è</th>";
  tabelaBody.innerHTML = "";

  const seletorHoras = document.querySelector("#seletorHoras");
  const seletorResultado = document.querySelector("#seletorResultado");
  const seletorTipoPlacar = document.querySelector("#seletorTipoPlacar");
  const mostrarTimesSelect = document.querySelector("#mostrarTimes");
  const mostrarHTSelect = document.querySelector("#mostrarHT");
  const mostrarOddsSelect = document.querySelector("#mostrarOdds");
  const mostrarTimes = mostrarTimesSelect ? mostrarTimesSelect.value === "sim" : false;
  const mostrarOdds = mostrarOddsSelect ? mostrarOddsSelect.value === "sim" : false;
  const mostrarHT = mostrarHTSelect ? mostrarHTSelect.value === "sim" : false;

  if (!seletorHoras || !seletorResultado || !seletorTipoPlacar || !mostrarTimesSelect || !mostrarHTSelect || !mostrarOddsSelect) {
    console.error("Seletores n√£o encontrados!");
    showErrorMessage("Erro interno: Seletores do formul√°rio n√£o encontrados.");
    return;
  }

  const horasSelecionadas = parseInt(seletorHoras.value) || 12;

  dados.sort((a, b) => {
    const dataHoraA = new Date(
      `${a.data}T${a.hora.toString().padStart(2, "0")}:${a.minuto.toString().padStart(2, "0")}:00`
    ).getTime();
    const dataHoraB = new Date(
      `${b.data}T${b.hora.toString().padStart(2, "0")}:${b.minuto.toString().padStart(2, "0")}:00`
    ).getTime();
    return dataHoraA - dataHoraB;
  });

  const proximosJogosComHoras = proximosJogos.map(jogo => {
    const { time, date, hour, minute } = extractTimeFromDateTime(jogo.start_time);
    return { ...jogo, time, date, hora: hour, minuto: minute, team_visitante: jogo.team_visit };
  }).sort((a, b) => new Date(a.start_time) - new Date(b.start_time));
  console.log("Pr√≥ximos jogos processados:", proximosJogosComHoras);

  const chavesJaProcessadas = new Set();
  const mapeamentoChaveLinha = {};
  let contagemLinhas = 0;

  const now = new Date();
  proximosJogosComHoras.forEach(jogo => {
    const hora = jogo.hora;
    const dataStr = jogo.date ? jogo.date.toISOString().split("T")[0] : jogo.captured_date.split("/").reverse().join("-");
    const chave = `${dataStr}-${hora}`;
    if (!chavesJaProcessadas.has(chave)) {
      const jogoDateTime = new Date(jogo.start_time);
      const localJogoDateTime = new Date(jogoDateTime.getTime() - 3 * 60 * 60 * 1000);
      if (localJogoDateTime > now) {
        const novaLinha = document.createElement("tr");
        novaLinha.setAttribute("data-chave", chave);
        const colunaHora = document.createElement("td");
        colunaHora.textContent = hora.toString().padStart(2, "0");
        novaLinha.appendChild(colunaHora);
        league.minutosFixos.forEach(() => novaLinha.appendChild(document.createElement("td")));
        novaLinha.appendChild(document.createElement("td")).textContent = "0";
        novaLinha.appendChild(document.createElement("td")).textContent = "0";
        novaLinha.appendChild(document.createElement("td")).textContent = "0%";
        tabelaBody.insertBefore(novaLinha, tabelaBody.firstChild);
        chavesJaProcessadas.add(chave);
        mapeamentoChaveLinha[chave] = novaLinha;
        contagemLinhas++;
        console.log(`Criada linha para hora futura (topo): ${chave}`);
      }
    }
  });

  dados.reverse().forEach((dado) => {
    if (contagemLinhas >= horasSelecionadas) return;
    const dataHora = new Date(dado.data);
    const hora = dado.hora;
    const chave = `${dataHora.toISOString().split("T")[0]}-${hora}`;
    if (!chavesJaProcessadas.has(chave)) {
      const novaLinha = document.createElement("tr");
      novaLinha.setAttribute("data-chave", chave);
      const colunaHora = document.createElement("td");
      colunaHora.textContent = hora.toString().padStart(2, "0");
      novaLinha.appendChild(colunaHora);
      league.minutosFixos.forEach(() => novaLinha.appendChild(document.createElement("td")));
      novaLinha.appendChild(document.createElement("td")).textContent = "0";
      novaLinha.appendChild(document.createElement("td")).textContent = "0";
      novaLinha.appendChild(document.createElement("td")).textContent = "0%";
      tabelaBody.appendChild(novaLinha);
      chavesJaProcessadas.add(chave);
      mapeamentoChaveLinha[chave] = novaLinha;
      contagemLinhas++;
      console.log(`Criada linha para dados passados: ${chave}`);
    }
  });

  function handlePlacarClick(event) {
    if (mostrarTimes) return;
    const placarElement = event.currentTarget.querySelector(".placar-texto") || event.currentTarget;
    const placarClicado = placarElement.textContent.trim();
    if (placarSelecionado === placarClicado) {
      placarSelecionado = null;
      localStorage.removeItem("placarSelecionado");
      selecionarPlacaresIguais(null);
    } else {
      placarSelecionado = placarClicado;
      localStorage.setItem("placarSelecionado", placarClicado);
      selecionarPlacaresIguais(placarClicado);
    }
  }

  function handleTimeClick(event) {
    if (!mostrarTimes) return;
    const timeElement = event.target;
    const timeClicado = timeElement.getAttribute("data-full-time");
    if (!timeClicado) return;
    if (timeSelecionado === timeClicado) {
      timeSelecionado = null;
      localStorage.removeItem("timeSelecionado");
      selecionarJogosPorTime(null);
    } else {
      timeSelecionado = timeClicado;
      localStorage.setItem("timeSelecionado", timeClicado);
      selecionarJogosPorTime(timeClicado);
    }
  }

  function handleOddClick(event) {
    event.stopPropagation();
    const oddClicada = event.currentTarget.textContent.trim();
    if (oddSelecionada === oddClicada) {
      oddSelecionada = null;
      localStorage.removeItem("oddSelecionada");
      selecionarOddsIguais(null);
    } else {
      oddSelecionada = oddClicada;
      localStorage.setItem("oddSelecionada", oddClicada);
      selecionarOddsIguais(oddClicada);
    }
  }

  const totalGolsPorColuna = Array(league.minutosFixos.length).fill(0);
  const totalAcertosPorColuna = Array(league.minutosFixos.length).fill(0);
  const processedMatches = new Set();

  dados.forEach((dado) => {
    const dataHora = new Date(dado.data);
    const hora = dado.hora;
    const chave = `${dataHora.toISOString().split("T")[0]}-${hora}`;
    const linha = mapeamentoChaveLinha[chave];
    const matchKey = `${dado.time_a}-${dado.time_b}-${chave}-${dado.minuto}`;

    if (linha && !processedMatches.has(matchKey)) {
      const indexMinuto = league.minutosFixos.indexOf(dado.minuto);
      if (indexMinuto !== -1) {
        const colunaMinuto = linha.children[1 + indexMinuto];

        if (!colunaMinuto.querySelector(".placar")) {
          const placar = document.createElement("div");
          placar.className = "placar";
          placar.setAttribute("data-time-a", dado.time_a);
          placar.setAttribute("data-time-b", dado.time_b);

          const tipoPlacar = seletorTipoPlacar.value;
          const placarFT = dado.ft;
          const placarHT = dado.ht;

          const placarTexto = document.createElement("div");
          placarTexto.className = "placar-texto";

          let primaryScore = tipoPlacar === "ft" ? placarFT : placarHT;
          let secondaryScore = tipoPlacar === "ft" ? placarHT : placarFT;

          if (mostrarTimes) {
            const timeA = abbreviateTeamName(dado.time_a); // Abreviar para jogos passados
            const timeB = abbreviateTeamName(dado.time_b); // Abreviar para jogos passados
            let textoPlacar = `<span class="time-casa" style="cursor: pointer;" data-full-time="${dado.time_a}">${timeA}</span>`;
            textoPlacar += `<span>${primaryScore}</span>`;
            if (mostrarHT) {
              textoPlacar += `<span>(${secondaryScore})</span>`;
            }
            textoPlacar += `<span class="time-fora" style="cursor: pointer;" data-full-time="${dado.time_b}">${timeB}</span>`;
            placarTexto.innerHTML = textoPlacar;
          } else {
            let textoPlacar = `<span>${primaryScore}</span>`;
            if (mostrarHT) {
              textoPlacar += `<span>(${secondaryScore})</span>`;
            }
            placarTexto.innerHTML = textoPlacar;
          }
          placar.appendChild(placarTexto);

          if (mostrarOdds) {
            const odds = findOddsForMatch(dado, oddsData);
            const oddValue = getOddValue(odds, seletorResultado.value);
            const oddsElement = document.createElement("div");
            oddsElement.className = "odds";
            oddsElement.textContent = `@${oddValue}`;
            oddsElement.addEventListener("click", handleOddClick);
            placar.appendChild(oddsElement);
          }

          placar.addEventListener("click", handlePlacarClick);
          if (mostrarTimes) {
            const timeCasa = placar.querySelector(".time-casa");
            const timeFora = placar.querySelector(".time-fora");
            if (timeCasa) timeCasa.addEventListener("click", handleTimeClick);
            if (timeFora) timeFora.addEventListener("click", handleTimeClick);
          }

          const tooltip = document.createElement("span");
          tooltip.className = "tooltip";
          tooltip.innerHTML = `
            <span class="times">${dado.time_a} vs ${dado.time_b}</span>
            <span class="placares">${placarFT} <span class="placarHT">(${placarHT})</span></span>
          `;
          placar.appendChild(tooltip);

          colunaMinuto.appendChild(placar);
          processedMatches.add(matchKey);
          console.log(`Adicionado resultado passado: ${dado.time_a} vs ${dado.time_b} em ${chave} minuto ${dado.minuto}`);

          if (placarSelecionado && !mostrarTimes && placarTexto.textContent.includes(placarSelecionado)) {
            placar.classList.add("placar-selecionado");
          }
          if (timeSelecionado && mostrarTimes && (dado.time_a === timeSelecionado || dado.time_b === timeSelecionado)) {
            placar.classList.add("time-selecionado");
          }
          if (oddSelecionada && mostrarOdds) {
            const oddElement = placar.querySelector(".odds");
            if (oddElement && oddElement.textContent === oddSelecionada) {
              oddElement.classList.add("odd-selecionada");
            }
          }

          const selecaoResultado = seletorResultado.value;
          let acerto = false;
          const placarAtual = tipoPlacar === "ft" ? placarFT : placarHT;
          const [resultadoA, resultadoB] = placarAtual.split(" x ").map(num => parseInt(num) || 0);

          if (selecaoResultado === "ambasMarcam") {
            acerto = resultadoA > 0 && resultadoB > 0;
          } else if (selecaoResultado === "ambasNaoMarcam") {
            acerto = resultadoA === 0 || resultadoB === 0;
          } else if (selecaoResultado === "over1.5") {
            acerto = resultadoA + resultadoB > 1.5;
          } else if (selecaoResultado === "under1.5") {
            acerto = resultadoA + resultadoB <= 1.5;
          } else if (selecaoResultado === "over2.5") {
            acerto = resultadoA + resultadoB > 2.5;
          } else if (selecaoResultado === "under2.5") {
            acerto = resultadoA + resultadoB <= 2.5;
          } else if (selecaoResultado === "over3.5") {
            acerto = resultadoA + resultadoB > 3.5;
          } else if (selecaoResultado === "under3.5") {
            acerto = resultadoA + resultadoB <= 3.5;
          } else if (selecaoResultado === "over5") {
            acerto = resultadoA + resultadoB >= 5;
          } else if (selecaoResultado === "casaVence") {
            acerto = resultadoA > resultadoB;
          } else if (selecaoResultado === "foraVence") {
            acerto = resultadoB > resultadoA;
          } else if (selecaoResultado === "empate") {
            acerto = resultadoA === resultadoB;
          }

          colunaMinuto.style.backgroundColor = acerto ? "#018b06" : "#be0e02";

          if (acerto) {
            linha.children[linha.children.length - 2].textContent =
              parseInt(linha.children[linha.children.length - 2].textContent) + 1;
            totalAcertosPorColuna[indexMinuto]++;
          }

          const totalGolsCelula = linha.children[linha.children.length - 3];
          const totalGols = resultadoA + resultadoB;
          totalGolsCelula.textContent = parseInt(totalGolsCelula.textContent) + totalGols;

          totalGolsPorColuna[indexMinuto] += totalGols;
        }
      }
    }
  });

  proximosJogosComHoras.forEach(jogo => {
    const dataStr = jogo.date ? jogo.date.toISOString().split("T")[0] : jogo.captured_date.split("/").reverse().join("-");
    const hora = jogo.hora;
    const chave = `${dataStr}-${hora}`;
    const linha = mapeamentoChaveLinha[chave];
    const matchKey = `${jogo.team_home}-${jogo.team_visit}-${chave}-${jogo.minuto}`;

    if (linha && jogo.minuto !== null && !processedMatches.has(matchKey)) {
      const resultadoExistente = dados.find(dado => {
        const dadoData = new Date(dado.data).toISOString().split("T")[0];
        return (
          normalizeString(dado.time_a) === normalizeString(jogo.team_home) &&
          normalizeString(dado.time_b) === normalizeString(jogo.team_visit) &&
          dadoData === dataStr &&
          dado.hora === hora &&
          dado.minuto === jogo.minuto
        );
      });

      if (!resultadoExistente) {
        const indexMinuto = league.minutosFixos.indexOf(jogo.minuto);
        if (indexMinuto !== -1) {
          const colunaMinuto = linha.children[1 + indexMinuto];
          if (!colunaMinuto.querySelector(".placar")) {
            console.log(`Adicionando jogo futuro: ${jogo.team_home} vs ${jogo.team_visit} em ${chave} minuto ${jogo.minuto}`);
            const placar = document.createElement("div");
            placar.className = "placar placar-futuro";
            placar.setAttribute("data-time-a", jogo.team_home);
            placar.setAttribute("data-time-b", jogo.team_visit);

            const placarTexto = document.createElement("div");
            placarTexto.className = "placar-texto";

            if (mostrarTimes) {
              const timeA = abbreviateTeamName(jogo.team_home); // Abreviar para jogos futuros
              const timeB = abbreviateTeamName(jogo.team_visit); // Abreviar para jogos futuros
              placarTexto.innerHTML = `
                <span class="time-casa" style="cursor: pointer;" data-full-time="${jogo.team_home}">${timeA}</span><br>
                <span>vs</span><br>
                <span class="time-fora" style="cursor: pointer;" data-full-time="${jogo.team_visit}">${timeB}</span>
              `;
            } else {
              const timeA = abbreviateTeamName(jogo.team_home); // Abreviar para jogos futuros
              const timeB = abbreviateTeamName(jogo.team_visit); // Abreviar para jogos futuros
              placarTexto.innerHTML = `${timeA}<br>vs<br>${timeB}`;
            }
            placar.appendChild(placarTexto);

            placar.addEventListener("click", handlePlacarClick);
            if (mostrarTimes) {
              const timeCasa = placar.querySelector(".time-casa");
              const timeFora = placar.querySelector(".time-fora");
              if (timeCasa) timeCasa.addEventListener("click", handleTimeClick);
              if (timeFora) timeFora.addEventListener("click", handleTimeClick);
            }

            const tooltip = document.createElement("span");
            tooltip.className = "tooltip";
            tooltip.innerHTML = `<span class="times">${jogo.team_home} vs ${jogo.team_visit}</span>`;
            placar.appendChild(tooltip);

            colunaMinuto.appendChild(placar);
            processedMatches.add(matchKey);

            if (timeSelecionado && mostrarTimes && (jogo.team_home === timeSelecionado || jogo.team_visit === timeSelecionado)) {
              placar.classList.add("time-selecionado");
            }

          }
        } else {
          console.warn(`Minuto ${jogo.minuto} n√£o encontrado em minutosFixos para jogo ${jogo.team_home} vs ${jogo.team_visit}`);
        }
      } else {
        console.log(`Jogo ${jogo.team_home} vs ${jogo.team_visit} j√° tem resultado, n√£o ser√° adicionado como futuro`);
      }
    } else {
      console.warn(`Linha n√£o encontrada para chave ${chave} ou minuto nulo para jogo ${jogo.team_home} vs ${jogo.team_visit}`);
    }
  });

  totalGolsPorColuna.forEach((total, index) => {
    const cell = document.createElement("td");
    cell.className = "total-goals";
    cell.textContent = total;
    linhaTotalGols.appendChild(cell);
  });

  totalAcertosPorColuna.forEach((total, index) => {
    const cell = document.createElement("td");
    cell.className = "market-hits";
    cell.textContent = total;
    linhaAcertosMercado.appendChild(cell);
  });

  for (let i = 0; i < 3; i++) {
    const emptyCellGols = document.createElement("td");
    emptyCellGols.textContent = "";
    linhaTotalGols.appendChild(emptyCellGols);

    const emptyCellMercados = document.createElement("td");
    emptyCellMercados.textContent = "";
    linhaAcertosMercado.appendChild(emptyCellMercados);
  }

  const todasLinhas = Array.from(tabelaBody.querySelectorAll("tr"));
  todasLinhas.forEach((row) => {
    const totalCelsProcessadas = Array.from(row.cells)
      .slice(1, -3)
      .filter((cell) => cell.querySelector(".placar")).length;
    const celsMercado = parseInt(
      row.children[row.children.length - 2].textContent
    );

    const porcentagem =
      totalCelsProcessadas > 0
        ? Math.floor((celsMercado / totalCelsProcessadas) * 100)
        : 0;
    const porcentagemCell = row.children[row.children.length - 1];
    porcentagemCell.textContent = `${porcentagem}%`;

    if (porcentagem >= 50) {
      porcentagemCell.classList.add("porcentagem-verde");
      porcentagemCell.classList.remove("porcentagem-branca");
    } else {
      porcentagemCell.classList.add("porcentagem-branca");
      porcentagemCell.classList.remove("porcentagem-verde");
    }
  });

  const totalColunas = league.minutosFixos.length;
  const totalMercadosPorColuna = Array(totalColunas).fill(0);

  todasLinhas.forEach((row) => {
    Array.from(row.cells)
      .slice(1, -3)
      .forEach((cell, index) => {
        if (cell.querySelector(".placar")) {
          totalMercadosPorColuna[index]++;
        }
      });
  });

  linhaPercentual.innerHTML = "<th>üìà</th>";

  totalMercadosPorColuna.forEach((totalMercados, index) => {
    const cell = document.createElement("td");
    const porcentagemVertical =
      totalMercados > 0
        ? Math.floor((totalAcertosPorColuna[index] / totalMercados) * 100)
        : 0;
    cell.textContent = `${porcentagemVertical}%`;

    if (porcentagemVertical > 49) {
      cell.classList.add("porcentagem-verde");
      cell.classList.remove("porcentagem-branca");
    } else {
      cell.classList.add("porcentagem-branca");
      cell.classList.remove("porcentagem-verde");
    }

    linhaPercentual.appendChild(cell);
  });

  for (let i = 0; i < 3; i++) {
    const emptyCell = document.createElement("td");
    emptyCell.textContent = "";
    linhaPercentual.appendChild(emptyCell);
  }

  const minuteHeaders = document.querySelectorAll(`#${league.tabelaId} thead tr:last-child th.minute-header`);
  minuteHeaders.forEach(header => {
    header.style.backgroundColor = "#2c303b";
  });

  if (placarSelecionado && !mostrarTimes) {
    selecionarPlacaresIguais(placarSelecionado);
  }
  if (timeSelecionado && mostrarTimes) {
    selecionarJogosPorTime(timeSelecionado);
  }
  if (oddSelecionada && mostrarOdds) {
    selecionarOddsIguais(oddSelecionada);
  }
}

async function buscarDados() {
  hideErrorMessage();
  let totalGols = 0;
  let totalHorasJogadas = 0;
  let totalAcertos = 0;
  let totalMercados = 0;

  for (const league of leagues) {
    let dados = [];
    let oddsData = [];
    let proximosJogos = [];

    try {
      dados = await fetchResultados(league.results_url);
    } catch (error) {
      console.error(`Erro ao carregar resultados para ${league.name}: ${error.message}`);
    }

    try {
      oddsData = await fetchOdds(league.odds_url);
    } catch (error) {
      console.error(`Erro ao carregar odds para ${league.name}: ${error.message}. Exibindo tabela sem odds.`);
    }

    try {
      proximosJogos = await fetchProximosJogos(league.proximos_url);
    } catch (error) {
      console.error(`Erro ao carregar pr√≥ximos jogos para ${league.name}: ${error.message}. Exibindo tabela sem jogos futuros.`);
    }

    if (dados.length > 0 || proximosJogos.length > 0) {
      criarTabela(dados, oddsData, proximosJogos, league);
    } else {
      showErrorMessage(`Nenhum dado dispon√≠vel para ${league.name}. Verifique a conex√£o com o servidor.`);
    }

    // Collect stats
    const todasLinhas = Array.from(document.querySelector(`#${league.tabelaId} tbody`)?.querySelectorAll("tr") || []);
    const stats = calculateGoalStats(todasLinhas);
    totalGols += stats.totalGols;
    totalHorasJogadas += todasLinhas.length;

    todasLinhas.forEach((row) => {
      Array.from(row.cells)
        .slice(1, league.minutosFixos.length + 1)
        .forEach((cell) => {
          const placarElem = cell.querySelector(".placar");
          if (placarElem && !placarElem.classList.contains("placar-futuro")) {
            totalMercados++;
            if (cell.style.backgroundColor === "#018b06") {
              totalAcertos++;
            }
          }
        });
    });
  }

  const mediaGolsHora = totalHorasJogadas > 0 ? (totalGols / totalHorasJogadas).toFixed(2) : 0;
  const greenPercentage = totalMercados > 0 ? Math.floor((totalAcertos / totalMercados) * 100) : 0;
  const redPercentage = 100 - greenPercentage;

  document.getElementById("greenPercentage").textContent = `Greens: ${greenPercentage}%`;
  document.getElementById("redPercentage").textContent = `Reds: ${redPercentage}%`;
  document.getElementById("totalGols").textContent = `Gols: ${totalGols}`;
  document.getElementById("mediaGolsHora").textContent = `M√©dias: ${mediaGolsHora}`;
}

buscarDados();
setInterval(buscarDados, 10000);

const seletorHoras = document.querySelector("#seletorHoras");
const seletorResultado = document.querySelector("#seletorResultado");
const seletorTipoPlacar = document.querySelector("#seletorTipoPlacar");
const mostrarTimesSelect = document.querySelector("#mostrarTimes");
const mostrarHTSelect = document.querySelector("#mostrarHT");
const mostrarOddsSelect = document.querySelector("#mostrarOdds");

if (seletorHoras) seletorHoras.addEventListener("change", buscarDados);
if (seletorResultado) seletorResultado.addEventListener("change", buscarDados);
if (seletorTipoPlacar) seletorTipoPlacar.addEventListener("change", buscarDados);
if (mostrarTimesSelect) {
  mostrarTimesSelect.addEventListener("change", () => {
    if (mostrarTimesSelect.value !== "sim") {
      placarSelecionado = null;
      timeSelecionado = null;
      localStorage.removeItem("placarSelecionado");
      localStorage.removeItem("timeSelecionado");
      selecionarPlacaresIguais(null);
      selecionarJogosPorTime(null);
    }
    buscarDados();
  });
}
if (mostrarHTSelect) mostrarHTSelect.addEventListener("change", buscarDados);
if (mostrarOddsSelect) {
  mostrarOddsSelect.addEventListener("change", () => {
    if (mostrarOddsSelect.value !== "sim") {
      oddSelecionada = null;
      localStorage.removeItem("oddSelecionada");
      selecionarOddsIguais(null);
    }
    buscarDados();
  });
}
    </script>


<script>
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header').innerHTML = data;
      });
  </script>
  <script src="redirecionar.js"></script>

<script>
      // Bloqueia o menu de contexto (clique direito)
      document.addEventListener("contextmenu", function(e) {
    e.preventDefault();
});

// Bloqueia atalhos de teclado comuns para ferramentas de desenvolvimento
document.addEventListener("keydown", function(e) {
    // F12
    if (e.key === "F12") {
        e.preventDefault();
    }
    
    // Ctrl + Shift + I
    if (e.ctrlKey && e.shiftKey && e.key === "I") {
        e.preventDefault();
    }
    
    // Ctrl + U (ver c√≥digo fonte)
    if (e.ctrlKey && e.key === "u") {
        e.preventDefault();
    }
    
    // Ctrl + Shift + J (console)
    if (e.ctrlKey && e.shiftKey && e.key === "J") {
        e.preventDefault();
    }
    
    // Ctrl + Shift + C (inspe√ß√£o de elementos)
    if (e.ctrlKey && e.shiftKey && e.key === "C") {
        e.preventDefault();
    }
    
    // Ctrl + S (salvar p√°gina)
    if (e.ctrlKey && e.key === "s") {
        e.preventDefault();
    }
    
    // Ctrl + P (imprimir)
    if (e.ctrlKey && e.key === "p") {
        e.preventDefault();
    }
});

// Detecta abertura de ferramentas de desenvolvimento
const devtools = { open: false };
const element = new Image();
Object.defineProperty(element, 'id', {
    get: function () {
        devtools.open = true;
    }
});

// Adiciona detec√ß√£o alternativa de devtools
(function() {
    const threshold = 160;
    const checkDevTools = function() {
        if ((window.outerWidth - window.innerWidth) > threshold || 
            (window.outerHeight - window.innerHeight) > threshold) {
            devtools.open = true;
        }
    };
    
    window.addEventListener('resize', checkDevTools);
    setInterval(checkDevTools, 500);
})();

// Monitoramento cont√≠nuo
console.log('%c', element);
setInterval(function() {
    if (devtools.open) {
        document.body.innerHTML = '<h1>Acesso n√£o autorizado detectado</h1>';
        // Ou redirecionar:
        // window.location.href = 'about:blank';
        devtools.open = false;
    }
}, 1000);

// Impede sele√ß√£o de texto
document.addEventListener('selectstart', function(e) {
    e.preventDefault();
});

// Impede arrastar e soltar
document.addEventListener('dragstart', function(e) {
    e.preventDefault();
});

// Ofusca console
console.log = function() {};
console.debug = function() {};
console.info = function() {};
  </script>

  <script>
document.addEventListener('DOMContentLoaded', () => {
    const containers = {
        copaAmerica: document.getElementById('jogosfuturos-copaAmerica'),
        tacaGloria: document.getElementById('jogosfuturos-tacaGloria'),
        euro: document.getElementById('jogosfuturos-euro'),
        campeonatoItaliano: document.getElementById('jogosfuturos-campeonatoItaliano'),
        copaEstrelas: document.getElementById('jogosfuturos-copaEstrelas'),
        brasileirao: document.getElementById('jogosfuturos-brasileirao')
    };

    const urls = {
        copaAmerica: 'https://betstat.site/proximos/Copa%20Am%C3%A9rica',
        tacaGloria: 'https://betstat.site/proximos/Ta%C3%A7a%20Gl%C3%B3ria%20Eterna',
        euro: 'https://betstat.site/proximos/Euro',
        campeonatoItaliano: 'https://betstat.site/proximos/Campeonato%20Italiano',
        copaEstrelas: 'https://betstat.site/proximos/Copa%20das%20Estrelas',
        brasileirao: 'https://betstat.site/proximos/Brasileir%C3%A3o%20Betano'
    };

    // Carrega inicialmente todas as ligas
    loadAllJogosFuturos();
    // Inicia a atualiza√ß√£o autom√°tica para todas as ligas
    startAllJogosFuturosAutoUpdate();

    function loadAllJogosFuturos() {
        Object.keys(urls).forEach(league => {
            loadJogosFuturos(league);
        });
    }

    function loadJogosFuturos(league) {
        fetch(urls[league])
            .then(response => response.json())
            .then(data => {
                const proximosJogos = data.slice(0, 6); // Removido o reverse()
                displayJogosFuturos(containers[league], proximosJogos);
            })
            .catch(error => {
                console.error(`Erro ao carregar jogos ${league}:`, error);
                containers[league].innerHTML = '<p>Erro ao carregar jogos</p>';
            });
    }

    function extractTimeFromDateTime(dateTimeStr) {
        if (!dateTimeStr || isNaN(new Date(dateTimeStr))) {
            return { time: "Hor√°rio indispon√≠vel", date: null };
        }
        const date = new Date(dateTimeStr);
        const hour = date.getHours().toString().padStart(2, '0');
        const minute = date.getMinutes().toString().padStart(2, '0');
        return { time: `${hour}:${minute}`, date };
    }

    function timeToMinutes(timeStr) {
        if (!timeStr || timeStr === "Hor√°rio indispon√≠vel") return -1;
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    }

    function displayJogosFuturos(container, proximosJogos) {
        container.innerHTML = '';
        if (!proximosJogos || proximosJogos.length === 0) {
            container.innerHTML = '<p>Nenhum jogo dispon√≠vel</p>';
            return;
        }

        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = currentHour * 60 + currentMinute;
        const currentTimeStr = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;

        const jogosComTempo = proximosJogos.map(jogo => {
            const { time, date } = jogo.time && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(jogo.time) 
                ? { time: jogo.time, date: null }
                : extractTimeFromDateTime(jogo.start_time);
            
            const timeInMinutes = timeToMinutes(time);
            return { 
                jogo, 
                time, 
                timeInMinutes,
                distanceFromNow: timeInMinutes - currentTimeInMinutes
            };
        });

        let indexOfCurrent = -1;
        let smallestPositiveDistance = Infinity;
        
        jogosComTempo.forEach((item, index) => {
            if (item.time === currentTimeStr) {
                indexOfCurrent = index;
            } 
            else if (item.distanceFromNow > 0 && item.distanceFromNow < smallestPositiveDistance) {
                smallestPositiveDistance = item.distanceFromNow;
                if (indexOfCurrent === -1) indexOfCurrent = index;
            }
        });

        if (indexOfCurrent === -1 && jogosComTempo.length > 0) {
            indexOfCurrent = 0;
        }

        // Exibe os jogos na ordem do array jogosComTempo
        jogosComTempo.forEach((item, index) => {
            const box = document.createElement('div');
            box.classList.add('jogosfuturos-game-box');
            
            if (index === indexOfCurrent) {
                box.classList.add('jogosfuturos-current');
            } else if (index === indexOfCurrent + 1 || index === indexOfCurrent + 2) {
                box.classList.add('jogosfuturos-next');
            } else {
                box.classList.add('jogosfuturos-upcoming');
            }

            box.innerHTML = `
                <div class="jogosfuturos-time">üïí ${item.time}</div>
                <div class="jogosfuturos-teams">${item.jogo.team_home.toUpperCase()} x ${item.jogo.team_visit.toUpperCase()}</div>
            `;
            container.appendChild(box);
        });
    }

    function startAllJogosFuturosAutoUpdate() {
        setInterval(() => {
            loadAllJogosFuturos();
        }, 10000);
    }
});
  </script>
  </body>
</html>
