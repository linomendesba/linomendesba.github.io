<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"></script>
    <title>BetStat</title>

    <meta name="description" content="Transforme suas apostas com BetStat - a √∫nica plataforma especializada em futebol virtual Betano. An√°lises precisas, estat√≠sticas confi√°veis e resultados comprovados para investimentos inteligentes." />
    <meta name="keywords" content="BetStat, apostas esportivas, futebol virtual, Betano, estat√≠sticas apostas, an√°lise apostas, investimentos esportivos" />
    <meta property="og:title" content="BetStat | Plataforma de An√°lise para Apostas Esportivas" />
    <meta property="og:description" content="Transforme suas apostas com an√°lises precisas e estat√≠sticas confi√°veis. A √∫nica plataforma especializada em futebol virtual Betano." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.betstat.site/payment.html" />
    <meta property="og:site_name" content="BetStat" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="BetStat" />
    <meta name="canonical" href="https://www.betstat.site/payment.html" />
    
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-4WT805FFHQ");
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  </head>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
  --primary-color: #1fac89;
  --primary-hover: #189976;
  --primary-dark: #01684f;
  --bg-color: #1c1f26;
  --text-color: #ffffff;
  --text-muted: #9ca3af;
  --container-bg: #2a2f3a;
  --border-color: rgba(31, 172, 137, 0.2);
  --border-muted: rgba(255, 255, 255, 0.1);
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.25);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.container {
  max-width: 1500px;
  margin: 0 auto;
  padding: 3rem 2rem;
}

.header {
  text-align: center;
  margin-bottom: 3.5rem;
  animation: fadeInDown 0.6s ease-out;
}

.title {
  font-size: 3rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.75rem;
  letter-spacing: -0.5px;
}

.subtitle {
  font-size: 1.125rem;
  color: var(--text-muted);
  font-weight: 400;
  letter-spacing: 0.3px;
}

.analysis-card {
  background: var(--container-bg);
  border: 1px solid var(--border-muted);
  border-radius: 16px;
  padding: 2.5rem;
  box-shadow: var(--shadow-lg);
  backdrop-filter: blur(10px);
  animation: fadeInUp 0.6s ease-out;
  transition: var(--transition);
}

.analysis-card:hover {
  border-color: var(--border-color);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}

.section {
  margin-bottom: 2.5rem;
}

.section:last-child {
  margin-bottom: 0;
}

.section-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 1.25rem;
  letter-spacing: 0.3px;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 20px;
  background: linear-gradient(180deg, var(--primary-color), var(--primary-hover));
  border-radius: 2px;
}

.btn-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.875rem;
}

.btn {
  background: var(--bg-color);
  color: var(--text-muted);
  border: 1.5px solid var(--border-muted);
  padding: 0.875rem 1.25rem;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
  font-family: inherit;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(31, 172, 137, 0.1), transparent);
  transition: left 0.5s ease;
}

.btn:hover::before {
  left: 100%;
}

.btn:hover {
  color: var(--text-color);
  border-color: var(--primary-color);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(31, 172, 137, 0.2);
}

.btn.active {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  color: var(--text-color);
  border-color: var(--primary-color);
  box-shadow: 0 4px 16px rgba(31, 172, 137, 0.3);
  transform: translateY(-1px);
}

.textarea-container {
  position: relative;
}

.textarea {
  width: 100%;
  min-height: 120px;
  background: var(--bg-color);
  border: 1.5px solid var(--border-muted);
  border-radius: 12px;
  color: var(--text-color);
  padding: 1.25rem;
  font-family: inherit;
  font-size: 0.95rem;
  line-height: 1.7;
  resize: vertical;
  transition: var(--transition);
}

.textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(31, 172, 137, 0.1);
}

.textarea::placeholder {
  color: var(--text-muted);
  opacity: 0.7;
}

.actions {
  display: flex;
  gap: 1rem;
  margin-top: 2.5rem;
}

.action-btn {
  flex: 1;
  padding: 1.125rem 2rem;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-family: inherit;
  position: relative;
  overflow: hidden;
}

.action-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.action-btn:active::after {
  width: 300px;
  height: 300px;
}

.btn-clear {
  background: transparent;
  color: var(--text-muted);
  border: 2px solid var(--border-muted);
}

.btn-clear:hover {
  background: var(--container-bg);
  color: var(--text-color);
  border-color: var(--text-color);
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.btn-generate {
  background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
  color: var(--text-color);
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(31, 172, 137, 0.3);
}

.btn-generate:hover {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(31, 172, 137, 0.4);
}

.btn-generate:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.result-container {
  margin-top: 2.5rem;
  background: var(--container-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 2.5rem;
  display: none;
  animation: fadeInUp 0.6s ease-out;
  box-shadow: var(--shadow-lg);
}

.result-title {
  font-size: 1.5rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1.75rem;
  display: flex;
  align-items: center;
  gap: 0.875rem;
  letter-spacing: -0.3px;
}

.result-content {
  color: var(--text-color);
  line-height: 1.8;
  white-space: pre-wrap;
  font-size: 1rem;
}

.loading {
  display: flex;
  align-items: center;
  gap: 0.875rem;
  color: var(--primary-color);
  font-weight: 500;
}

.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(31, 172, 137, 0.2);
  border-top: 3px solid var(--primary-color);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.error {
  background: rgba(239, 68, 68, 0.1);
  border: 1.5px solid rgba(239, 68, 68, 0.4);
  color: #ef4444;
  padding: 1.5rem;
  border-radius: 12px;
  margin-top: 1.25rem;
  font-weight: 500;
  animation: shake 0.5s ease-in-out;
}

.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: var(--bg-color);
  padding: 1.5rem;
  border-radius: 12px;
  border: 1px solid var(--border-muted);
}

.stat-label {
  color: var(--text-muted);
  font-size: 0.875rem;
  margin-bottom: 0.5rem;
}

.stat-value {
  color: var(--primary-color);
  font-size: 1.5rem;
  font-weight: 700;
}

.pattern-item {
  background: var(--bg-color);
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  border-left: 3px solid var(--primary-color);
}

.pattern-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.pattern-sequence {
  color: var(--text-color);
  font-weight: 500;
}

.pattern-stats {
  color: var(--text-muted);
  font-size: 0.875rem;
}

.opportunity-card {
  background: var(--bg-color);
  padding: 1.5rem;
  border-radius: 12px;
  border: 2px solid var(--primary-color);
  margin-bottom: 1rem;
}

.opportunity-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.opportunity-time {
  color: var(--primary-color);
  font-size: 1.25rem;
  font-weight: 700;
}

.opportunity-match {
  color: var(--text-color);
  margin-bottom: 0.5rem;
}

.opportunity-reason {
  color: var(--text-muted);
  font-size: 0.875rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

@media (max-width: 768px) {
  .container {
    padding: 1.5rem 1rem;
  }
  
  .title {
    font-size: 2.25rem;
  }
  
  .analysis-card {
    padding: 1.75rem;
    border-radius: 12px;
  }
  
  .actions {
    flex-direction: column;
  }
  
  .btn-grid {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
  }
  
  .result-container {
    padding: 1.75rem;
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>

  <body>
      <div id="header"></div>

      <br>
      <br>

      <div class="analysis-card">
        <div class="section">
          <h2 class="section-title">Casa de Aposta</h2>
          <div class="btn-grid" id="casas-group">
            <button class="btn" data-value="betano">Betano</button>
            <button class="btn" data-value="kiron">Kiron</button>
            <button class="btn" data-value="estrela">Estrelabet</button>
            <button class="btn" data-value="bet365">Bet365</button>
          </div>
        </div>

        <div class="section" id="liga-section" style="display: none;">
          <h2 class="section-title">Liga</h2>
          <div class="btn-grid" id="ligas-group"></div>
        </div>

        <div class="section">
          <h2 class="section-title">Mercado da An√°lise</h2>
          <div class="btn-grid" id="mercados-group">
            <button class="btn" data-value="casaVence">Casa Vence</button>
            <button class="btn" data-value="foraVence">Fora Vence</button>
            <button class="btn" data-value="empate">Empate</button>
            <button class="btn" data-value="over1.5">Over 1.5</button>
            <button class="btn" data-value="over2.5">Over 2.5</button>
            <button class="btn" data-value="over3.5">Over 3.5</button>
            <button class="btn" data-value="under1.5">Under 1.5</button>
            <button class="btn" data-value="under2.5">Under 2.5</button>
            <button class="btn" data-value="under3.5">Under 3.5</button>
            <button class="btn" data-value="ambasMarcam">Ambas Sim</button>
            <button class="btn" data-value="ambasNaoMarcam">Ambas N√£o</button>
            <button class="btn" data-value="over5">5+ Gols</button>
            <button class="btn" data-value="exact1">1 Gol Exato</button>
            <button class="btn" data-value="exact2">2 Gols Exatos</button>
            <button class="btn" data-value="exact3">3 Gols Exatos</button>
            <button class="btn" data-value="exact4">4 Gols Exatos</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Estrat√©gia Martingale</h2>
          <div class="btn-grid" id="martingale-group">
            <button class="btn" data-value="0">Nenhum</button>
            <button class="btn" data-value="1">1 Cobertura</button>
            <button class="btn" data-value="2">2 Coberturas</button>
            <button class="btn" data-value="3">3 Coberturas</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Per√≠odo de An√°lise</h2>
          <div class="btn-grid" id="periodo-group">
            <button class="btn" data-value="120">6 Horas</button>
            <button class="btn" data-value="240">12 Horas</button>
            <button class="btn" data-value="480">24 Horas</button>
            <button class="btn" data-value="960">48 Horas</button>
            <button class="btn" data-value="1440">72 Horas</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Observa√ß√µes Adicionais</h2>
          <div class="textarea-container">
            <textarea class="textarea" id="observacao" placeholder="Ex: Priorizar determinados hor√°rios, evitar confrontos diretos entre times fortes, etc..." rows="4"></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="action-btn btn-clear" onclick="limparAnalise()">Nova An√°lise</button>
          <button class="action-btn btn-generate" onclick="gerarAnalise()">Gerar An√°lise</button>
        </div>

        <div class="result-container" id="result-container">
          <h3 class="result-title" id="result-title">
            ‚úì An√°lise Conclu√≠da
          </h3>
          <div class="result-content" id="result-content"></div>
        </div>
      </div>
    </div>

    <script>
const casasConfig = {
  'betano': {
    name: 'Betano',
    ligas: [
      { name: 'Cl√°ssicos da Am√©rica', value: 'Ta√ßa Gl√≥ria Eterna' }, 
      'Copa Am√©rica', 
      'Euro', 
      'Campeonato Italiano', 
      'Copa das Estrelas', 
      'Brasileir√£o Betano'
    ]
  },
  'kiron': { 
    name: 'Kiron', 
    ligas: ['England', 'Italy', 'Spain'], 
    path: 'kiron' 
  },
  'estrela': { 
    name: 'Estrelabet', 
    ligas: ['Copa do Mundo', 'Ligas dos Campe√µes', 'Am√©rica Latina'], 
    path: 'estrela' 
  },
  'bet365': { 
    name: 'Bet365', 
    ligas: ['Copa', 'Euro', 'Super', 'Premier'], 
    path: 'bet365' 
  }
};

document.querySelectorAll('.btn-grid').forEach(group => {
  group.addEventListener('click', event => {
    if (event.target.classList.contains('btn')) {
      const currentActive = group.querySelector('.btn.active');
      if (currentActive) {
        currentActive.classList.remove('active');
      }
      event.target.classList.add('active');
  
      if (group.id === 'casas-group') {
        mostrarLigas(event.target.dataset.value);
      }
    }
  });
});

function mostrarLigas(casa) {
  const ligaSection = document.getElementById('liga-section');
  const ligasGroup = document.getElementById('ligas-group');

  if (!casasConfig[casa]) {
    ligaSection.style.display = 'none';
    return;
  }
  
  ligasGroup.innerHTML = '';
  
  casasConfig[casa].ligas.forEach(ligaItem => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    
    if (typeof ligaItem === 'object') {
        btn.dataset.value = ligaItem.value;
        btn.textContent = ligaItem.name;
    } else {
        btn.dataset.value = ligaItem;
        btn.textContent = ligaItem;
    }
    
    ligasGroup.appendChild(btn);
  });

  ligaSection.style.display = 'block';
}

function getSelectedValue(groupId) {
  const group = document.getElementById(groupId);
  const activeButton = group.querySelector('.btn.active');
  return activeButton ? activeButton.dataset.value : null;
}

function getSelectedText(groupId) {
  const group = document.getElementById(groupId);
  const activeButton = group.querySelector('.btn.active');
  return activeButton ? activeButton.innerText : null;
}

function limparAnalise() {
  document.querySelectorAll('.btn.active').forEach(btn => btn.classList.remove('active'));
  document.getElementById('observacao').value = '';
  document.getElementById('result-container').style.display = 'none';
  document.getElementById('liga-section').style.display = 'none';
}

function calcularRankingTimes(games, mercado) {
  const teamStats = {};
  games.forEach(game => {
    const { time_a, time_b, ft } = game;
    if (!ft || !ft.includes(' x ')) return;
    const [golsA, golsB] = ft.split(' x ').map(Number);
    const totalGols = golsA + golsB;

    [time_a, time_b].forEach(team => {
      if (!teamStats[team]) {
        teamStats[team] = { name: team, totalGames: 0, marketCount: 0 };
      }
    });

    teamStats[time_a].totalGames++;
    teamStats[time_b].totalGames++;

    let marketOccurred = false;
    switch (mercado) {
      case 'ambasMarcam': marketOccurred = golsA > 0 && golsB > 0; break;
      case 'ambasNaoMarcam': marketOccurred = golsA === 0 || golsB === 0; break;
      case 'empate': marketOccurred = golsA === golsB; break;
      case 'over1.5': marketOccurred = totalGols > 1; break;
      case 'under1.5': marketOccurred = totalGols < 2; break;
      case 'over2.5': marketOccurred = totalGols > 2; break;
      case 'under2.5': marketOccurred = totalGols < 3; break;
      case 'over3.5': marketOccurred = totalGols > 3; break;
      case 'under3.5': marketOccurred = totalGols < 4; break;
      case 'over5': marketOccurred = totalGols >= 5; break;
      case 'exact1': marketOccurred = totalGols === 1; break;
      case 'exact2': marketOccurred = totalGols === 2; break;
      case 'exact3': marketOccurred = totalGols === 3; break;
      case 'exact4': marketOccurred = totalGols === 4; break;
    }

    if (marketOccurred) {
      teamStats[time_a].marketCount++;
      teamStats[time_b].marketCount++;
    }
    if (mercado === 'casaVence' && golsA > golsB) teamStats[time_a].marketCount++;
    if (mercado === 'foraVence' && golsB > golsA) teamStats[time_b].marketCount++;
  });

  const statsArray = Object.values(teamStats).map(team => ({
    ...team,
    percentage: team.totalGames > 0 ? ((team.marketCount / team.totalGames) * 100).toFixed(1) : "0.0"
  }));
  statsArray.sort((a, b) => b.marketCount - a.marketCount || parseFloat(b.percentage) - parseFloat(a.percentage));
  return statsArray;
}

async function buscarDadosAPI(casa, liga, numJogos) {
  const config = casasConfig[casa];
  if (!config) throw new Error(`Casa ${casa} n√£o encontrada`);

  const dadosCompletos = { casa: config.name, liga: liga, totalJogos: 0, dadosCru: [] };
  try {
    const ligaEncoded = encodeURIComponent(liga);
    const baseUrl = 'https://betstat.site';
    let resultadosUrl, proximosUrl;
    
    if (config.path) {
      resultadosUrl = `${baseUrl}/resultados/${config.path}/${ligaEncoded}`;
      proximosUrl = `${baseUrl}/proximos/${config.path}/${ligaEncoded}`;
    } else {
      resultadosUrl = `${baseUrl}/resultados/${ligaEncoded}`;
      proximosUrl = `${baseUrl}/proximos/${ligaEncoded}`;
    }

    const [resultados, proximos] = await Promise.all([
      fetch(resultadosUrl).then(r => r.json()),
      fetch(proximosUrl).then(r => r.json())
    ]);
    const jogosRecentes = resultados.slice(-numJogos);
    
    for (const jogo of jogosRecentes) {
      const ftScore = (jogo.ft || "x").split("x").map((s) => parseInt(s.trim(), 10));
      const a = ftScore[0], b = ftScore[1];
      if (Number.isFinite(a) && Number.isFinite(b)) {
        dadosCompletos.dadosCru.push([a, b, a + b, (jogo.time_a || "").trim(), (jogo.time_b || "").trim(), jogo.hora, jogo.minuto]);
      }
    }

    dadosCompletos.proximos = proximos.slice(0, 6);
    dadosCompletos.totalJogos = dadosCompletos.dadosCru.length;
    return dadosCompletos;
  } catch (error) {
    console.error('Erro ao buscar dados da API:', error);
    throw new Error(`Falha ao conectar com a API: ${error.message}`);
  }
}

const ANALYZE_WORKER_SRC = `
  self.onmessage = (e) => {
    const p = e.data;
    if (!p || p.cmd !== 'analyze') return;
    const res = analyzeAll(p.payload);
    self.postMessage({ ok: true, id: p.id, result: res });
  };
  
  function enumerateCombos(tok){
    if(tok.length===1) return tok[0].map(t=>[t]);
    if(tok.length===2){ const out=[];
    for(const a of tok[0]) for(const b of tok[1]) out.push([a,b]); return out;
    }
    if(tok.length===3){ const out=[];
    for(const a of tok[0]) for(const b of tok[1]) for(const c of tok[2]) out.push([a,b,c]); return out;
    }
    const out=[],cur=[];
    (function rec(i){ if(i===tok.length){ out.push(cur.slice()); return; } for(const t of tok[i]){ cur.push(t); rec(i+1); cur.pop(); } })(0);
    return out;
  }
  
  function getOffsetsByTipo(t){
    if(t==='1') return [0];
    if(t==='2') return [0,1];
    if(t==='3') return [0,1,2];
    if(t==='1_pula_1') return [0,2];
    if(t==='1_pula_1_pula_1') return [0,2,4];
    return [0,1];
  }
  
  function tokensDoJogo(a,b,total,mandante,visitante){
    const t = new Set();
    t.add(\`\${a}-\${b}\`);
    t.add(a > 0 && b > 0 ? 'ambasMarcam' : 'ambasNaoMarcam');
    t.add(a > b ? 'casaVence' : (a < b ? 'foraVence' : 'empate'));
    if (total >= 2) t.add('over1.5');
    if (total < 2) t.add('under1.5');
    if (total >= 3) t.add('over2.5');
    if (total < 3) t.add('under2.5');
    if (total >= 4) t.add('over3.5');
    if (total < 4) t.add('under3.5');
    if (total >= 5) t.add('over5');
    if (total === 1) t.add('exact1');
    if (total === 2) t.add('exact2');
    if (total === 3) t.add('exact3');
    if (total === 4) t.add('exact4');
    if (mandante) t.add(mandante.toLowerCase());
    if (visitante) t.add(visitante.toLowerCase());
    return Array.from(t);
  }
  
  function isGreenForMarket(m,a,b,total){
    if (m === 'ambasMarcam') return a > 0 && b > 0;
    if (m === 'ambasNaoMarcam') return a === 0 || b === 0;
    if (m === 'casaVence') return a > b;
    if (m === 'foraVence') return a < b;
    if (m === 'empate') return a === b;
    if (m === 'over1.5') return total >= 2;
    if (m === 'under1.5') return total < 2;
    if (m === 'over2.5') return total >= 3;
    if (m === 'under2.5') return total < 3;
    if (m === 'over3.5') return total >= 4;
    if (m === 'under3.5') return total < 4;
    if (m === 'over5') return total >= 5;
    if (m === 'exact1') return total === 1;
    if (m === 'exact2') return total === 2;
    if (m === 'exact3') return total === 3;
    if (m === 'exact4') return total === 4;
    return false;
  }
  
  function analisarAutoPadroes(dados,tipo,tiros,market,inicio,fim){
    const res=[];
    const offs=getOffsetsByTipo(tipo);
    const last=offs[offs.length-1];
    for(let p=inicio;p<=fim;p++){
      const comb={};
      const need=(last+1)+p+tiros;
      if(dados.length<need) continue;
      for(let i=0;i<=dados.length-need;i++){
        const tok=[];
        for(const o of offs){
          const [a,b,t,mandante,visitante]=dados[i+o];
          tok.push(tokensDoJogo(a,b,t,mandante,visitante));
        }
        const combos=enumerateCombos(tok);
        let green=false;
        const ini=i+last+1+p, fimA=ini+tiros;
        for(let j=ini;j<fimA&&j<dados.length;j++){
          const [a,b,sum]=dados[j];
          if(isGreenForMarket(market,a,b,sum)){ green=true; break; }
        }
        for(const seq of combos){
          const key=seq.join(' | ');
          if(!comb[key]){ comb[key]={ocorrencias:0,greens:0}; }
          comb[key].ocorrencias++;
          if(green) comb[key].greens++;
        }
      }
      for(const k in comb){
        const st=comb[k];
        if(st.ocorrencias>=3){
          res.push({ padrao:k, pular_jogos:p, ocorrencias:st.ocorrencias, greens:st.greens, percentual:((st.greens/st.ocorrencias)*100).toFixed(1) });
        }
      }
    }
    res.sort((a,b)=>parseFloat(b.percentual)-parseFloat(a.percentual)||b.ocorrencias-a.ocorrencias);
    return res.slice(0,15);
  }
  
  function analyzeAll(payload){
    const { dados, tiros, market, combinado } = payload;
    const tipos = combinado ? ['2','3','1_pula_1','1_pula_1_pula_1'] : ['2'];
    let todos=[];
    for(const t of tipos){
      const r = analisarAutoPadroes(dados, t, tiros, market, 1, 10);
      r.forEach(x=>x.tipo_padrao=t);
      todos = todos.concat(r);
    }
    todos.sort((a,b)=>parseFloat(b.percentual)-parseFloat(a.percentual)||b.ocorrencias-a.ocorrencias);
    return { resultados: todos.slice(0,15) };
  }
`;

let ANALYZE_WORKER = null;
function getAnalyzeWorker() {
  if (!ANALYZE_WORKER) {
    const blob = new Blob([ANALYZE_WORKER_SRC], { type: "application/javascript" });
    ANALYZE_WORKER = new Worker(URL.createObjectURL(blob));
  }
  return ANALYZE_WORKER;
}

function analyzeInWorker(dados, opts) {
  return new Promise((resolve, reject) => {
    const w = getAnalyzeWorker();
    const id = Math.random().toString(36).slice(2);
    const onMsg = (ev) => {
      const msg = ev.data;
      if (!msg || msg.id !== id) return;

      w.removeEventListener("message", onMsg);
      if (msg.ok) resolve(msg.result);
      else reject(msg.error || "Erro no worker de an√°lise");
    };
    w.addEventListener("message", onMsg);
    w.postMessage({ cmd: "analyze", id, payload: { dados, ...opts } });
  });
}

function mapMercado(mercadoValue) {
  const map = {
    'ambasMarcam': 'ambasSim',
    'ambasNaoMarcam': 'ambasNao',
    'casaVence': 'casaVence',
    'foraVence': 'foraVence',
    'empate': 'empate',
    'over1.5': 'over1.5',
    'over2.5': 'over2.5',
    'over3.5': 'over3.5',
    'under1.5': 'under1.5',
    'under2.5': 'under2.5',
    'under3.5': 'under3.5',
    'exact1': 'umGolExato',
    'exact2': 'doisGolsExatos',
    'exact3': 'tresGolsExatos',
    'exact4': 'quatroGolsExatos',
    'over5': 'cincoOuMaisGols'
  };
  return map[mercadoValue] || mercadoValue;
}

function checkMarket(market, homeGoals, awayGoals, totalGoals) {
  switch (market) {
    case 'ambasSim': return homeGoals > 0 && awayGoals > 0 ? 1 : 0;
    case 'ambasNao': return homeGoals === 0 || awayGoals === 0 ? 1 : 0;
    case 'casaVence': return homeGoals > awayGoals ? 1 : 0;
    case 'foraVence': return awayGoals > homeGoals ? 1 : 0;
    case 'empate': return homeGoals === awayGoals ? 1 : 0;
    case 'over1.5': return totalGoals > 1.5 ? 1 : 0;
    case 'over2.5': return totalGoals > 2.5 ? 1 : 0;
    case 'over3.5': return totalGoals > 3.5 ? 1 : 0;
    case 'under1.5': return totalGoals < 1.5 ? 1 : 0;
    case 'under2.5': return totalGoals < 2.5 ? 1 : 0;
    case 'under3.5': return totalGoals < 3.5 ? 1 : 0;
    case 'umGolExato': return totalGoals === 1 ? 1 : 0;
    case 'doisGolsExatos': return totalGoals === 2 ? 1 : 0;
    case 'tresGolsExatos': return totalGoals === 3 ? 1 : 0;
    case 'quatroGolsExatos': return totalGoals === 4 ? 1 : 0;
    case 'cincoOuMaisGols': return totalGoals >= 5 ? 1 : 0;
    default: return 0;
  }
}

function calculateMarketAnalysis(dados, searchedMarket, numberOfGames, linesToSum, verifyLines) {
  const combinedData = dados.dadosCru.map(item => [
    `${item[5].toString().padStart(2, '0')}:${item[6].toString().padStart(2, '0')}`,
    item[0],
    item[1],
    item[3],
    item[4],
    item[2],
    dados.liga.toLowerCase()
  ]).slice(-numberOfGames);
  
  if (combinedData.length === 0) {
    return { currentPercentage: 0, top5: [] };
  }

  const recentGames = combinedData.slice(-linesToSum);
  const currentMarketCount = recentGames.reduce((sum, row) => sum + checkMarket(searchedMarket, row[1], row[2], row[5]), 0);
  const currentPercentage = (currentMarketCount / linesToSum * 100).toFixed(0);

  const marketGroups = {};
  combinedData.forEach((row, i) => {
    const [dateTime, homeGoals, awayGoals, homeTeam, awayTeam, totalGoals, league] = row;

    if (i >= linesToSum - 1) {
      const sumMarket = combinedData.slice(i - linesToSum + 1, i + 1).reduce((sum, row) => sum + checkMarket(searchedMarket, row[1], row[2], row[5]), 0);
      const marketPercentage = Math.round(sumMarket / linesToSum * 100);

      let result = "red";
      let greens = 0;
      let reds = 0;

      if (i + verifyLines <= combinedData.length) {
        const nextRows = combinedData.slice(i + 1, i + 1 + verifyLines);
        greens = nextRows.filter(row => checkMarket(searchedMarket, row[1], row[2], row[5]) === 1).length;
        reds = verifyLines - greens;
        const searchResult = nextRows.some(row => checkMarket(searchedMarket, row[1], row[2], row[5]) === 1);
        if (searchResult) {
          result = "green";
        }
      }

      const marketGroup = `${searchedMarket} ${marketPercentage}%`;
      if (!marketGroups[marketGroup]) {
        marketGroups[marketGroup] = { occurrences: 0, greens: 0, reds: 0, totalGreens: greens, totalReds: reds };
      }
      marketGroups[marketGroup].occurrences += 1;
      if (result === "green") {
        marketGroups[marketGroup].greens += 1;
      } else {
        marketGroups[marketGroup].reds += 1;
      }
      marketGroups[marketGroup].totalGreens = greens;
      marketGroups[marketGroup].totalReds = reds;
    }
  });

  const sortedGroups = Object.keys(marketGroups).map(key => {
    const group = marketGroups[key];
    const greenPercentage = (group.greens / group.occurrences * 100).toFixed(2);
    let analysis = '';
    const percentageNum = parseFloat(greenPercentage);

    if (percentageNum > 75) {
      analysis = 'Alta chance de acerto';
    } else if (percentageNum > 50) {
      analysis = 'Moderada chance';
    } else if (percentageNum > 25) {
      analysis = 'Risco elevado';
    } else {
      analysis = 'Alta chance de falha';
    }

    return {
      marketGroup: key,
      marketPercentage: parseFloat(key.split(' ')[1]),
      occurrences: group.occurrences,
      greens: group.greens,
      reds: group.reds,
      greenPercentage: greenPercentage,
      totalGreens: group.totalGreens,
      totalReds: group.totalReds,
      analysis: analysis
    };
  }).sort((a, b) => b.greenPercentage - a.greenPercentage || b.greens - a.greens).slice(0, 100);

  const top5 = sortedGroups.slice(0, 5);
  return { currentPercentage, top5 };
}

function gerarAnaliseLocal(dados, parametros) {
  let analise = '';
  
  // Estat√≠stica Geral
  analise += 'üéØ AN√ÅLISE ESTAT√çSTICA\n\n';
  analise += `Total de jogos analisados: ${dados.totalJogos}\n`;
  analise += `Casa: ${dados.casa}\n`;
  analise += `Liga: ${dados.liga}\n`;
  analise += `Mercado: ${parametros.mercado}\n`;
  analise += `Estrat√©gia Martingale: ${parametros.martingale}\n\n`;
  
  // Top Times
  if (dados.ranking && dados.ranking.length > 0) {
    analise += 'üèÜ TOP 5 TIMES NO MERCADO\n\n';
    dados.ranking.slice(0, 5).forEach((time, index) => {
      analise += `${index + 1}. ${time.name}\n`;
      analise += `   Jogos: ${time.totalGames} | Acertos: ${time.marketCount} | Taxa: ${time.percentage}%\n\n`;
    });
  }
  
  // Padr√µes Encontrados
  if (dados.padroesEncontrados && dados.padroesEncontrados.length > 0) {
    analise += 'üìä PADR√ïES RELEVANTES (Top 5)\n\n';
    dados.padroesEncontrados.slice(0, 5).forEach((padrao, index) => {
      analise += `${index + 1}. Padr√£o: ${padrao.padrao}\n`;
      analise += `   Tipo: ${padrao.tipo_padrao} | Pular: ${padrao.pular_jogos} jogos\n`;
      analise += `   Ocorr√™ncias: ${padrao.ocorrencias} | Greens: ${padrao.greens}\n`;
      analise += `   Taxa de Acerto: ${padrao.percentual}%\n\n`;
    });
  }
  
  // An√°lise de Mercado
  if (dados.marketAnalysis) {
    analise += 'üìà AN√ÅLISE DE GR√ÅFICO DE MERCADO\n\n';
    analise += `Porcentagem Atual do Mercado: ${dados.marketAnalysis.currentPercentage}%\n\n`;
    
    if (dados.marketAnalysis.top5 && dados.marketAnalysis.top5.length > 0) {
      analise += 'Top 5 Melhores Porcentagens:\n\n';
      dados.marketAnalysis.top5.forEach((item, index) => {
        analise += `${index + 1}. ${item.marketGroup}\n`;
        analise += `   Taxa de Green: ${item.greenPercentage}%\n`;
        analise += `   Ocorr√™ncias: ${item.occurrences} | Greens: ${item.greens} | Reds: ${item.reds}\n`;
        analise += `   An√°lise: ${item.analysis}\n\n`;
      });
    }
  }
  
  // Pr√≥ximas Oportunidades
  if (dados.proximos && dados.proximos.length > 0) {
    analise += '‚ö° PR√ìXIMAS OPORTUNIDADES\n\n';
    
    const martingaleNum = parseInt(parametros.martingale.split(' ')[0]) || 0;
    const numJogos = martingaleNum + 1;
    
    const jogosParaAnalise = dados.proximos.slice(0, numJogos);
    
    if (jogosParaAnalise.length > 0) {
      analise += `Liga: ${dados.liga}\n`;
      analise += `Mercado: ${parametros.mercado}\n\n`;
      analise += '‚è∞ Hor√°rios Sugeridos:\n';
      
      jogosParaAnalise.forEach((jogo, index) => {
        const hora = jogo.hora.toString().padStart(2, '0');
        const minuto = jogo.minuto.toString().padStart(2, '0');
        const tipo = index === 0 ? '(Principal)' : `(Cobertura ${index})`;
        analise += `‚ñ∏ ${hora}:${minuto} - ${jogo.time_a} vs ${jogo.time_b} ${tipo}\n`;
      });
      
      analise += '\nJustificativa: ';
      if (dados.padroesEncontrados && dados.padroesEncontrados.length > 0) {
        const melhorPadrao = dados.padroesEncontrados[0];
        analise += `Padr√£o identificado com ${melhorPadrao.percentual}% de taxa de acerto em ${melhorPadrao.ocorrencias} ocorr√™ncias. `;
      }
      
      const timesFortes = dados.ranking.slice(0, 3).map(t => t.name);
      const timesNosProximos = jogosParaAnalise.filter(j => 
        timesFortes.includes(j.time_a) || timesFortes.includes(j.time_b)
      );
      
      if (timesNosProximos.length > 0) {
        analise += `Os pr√≥ximos confrontos incluem times com bom desempenho hist√≥rico neste mercado.`;
      }
      analise += '\n\n';
    }
  }
  
  // Estrat√©gia Martingale
  analise += 'üé≤ ESTRAT√âGIA MARTINGALE\n\n';
  const martingaleNum = parseInt(parametros.martingale.split(' ')[0]) || 0;
  
  if (martingaleNum === 0) {
    analise += 'Sem cobertura Martingale. Estrat√©gia de entrada √∫nica.\n';
    analise += 'Recomendado para padr√µes com taxa de acerto acima de 70%.\n\n';
  } else {
    analise += `Estrat√©gia com ${martingaleNum} cobertura(s).\n`;
    const seguranca = dados.padroesEncontrados && dados.padroesEncontrados.length > 0 && 
                      parseFloat(dados.padroesEncontrados[0].percentual) > 60 ? 
                      'moderadamente segura' : 'de risco elevado';
    analise += `Considerando os padr√µes encontrados, esta estrat√©gia √© ${seguranca}.\n\n`;
  }
  
  // Recomenda√ß√£o Final
  analise += 'üí° RECOMENDA√á√ÉO FINAL\n\n';
  
  if (dados.padroesEncontrados && dados.padroesEncontrados.length > 0) {
    const melhorPadrao = dados.padroesEncontrados[0];
    const taxaAcerto = parseFloat(melhorPadrao.percentual);
    
    if (taxaAcerto >= 70) {
      analise += '‚úì ENTRADA RECOMENDADA\n';
      analise += `Forte conflu√™ncia de padr√µes com ${taxaAcerto}% de taxa de acerto. `;
      analise += `Os dados hist√≥ricos suportam uma entrada nos hor√°rios sugeridos.\n`;
    } else if (taxaAcerto >= 50) {
      analise += '‚ö†Ô∏è ENTRADA COM CAUTELA\n';
      analise += `Padr√£o moderado com ${taxaAcerto}% de taxa de acerto. `;
      analise += `Considere gest√£o de banca conservadora.\n`;
    } else {
      analise += '‚ùå ENTRADA N√ÉO RECOMENDADA\n';
      analise += `Taxa de acerto de ${taxaAcerto}% abaixo do ideal. `;
      analise += `Aguarde melhores oportunidades.\n`;
    }
  } else {
    analise += '‚ö†Ô∏è PADR√ïES INSUFICIENTES\n';
    analise += 'N√£o foram encontrados padr√µes consistentes o suficiente para uma recomenda√ß√£o segura. ';
    analise += 'Considere aumentar o per√≠odo de an√°lise ou aguardar mais dados.\n';
  }
  
  if (parametros.observacao) {
    analise += `\nüìù Observa√ß√µes do Usu√°rio:\n${parametros.observacao}\n`;
  }
  
  return analise;
}

async function gerarAnalise() {
  const MAX_ANALYSES_PER_DAY = 20;
  const COOLDOWN_MINUTES = 1;
  const now = new Date();
  const today = now.toISOString().split('T')[0];

  let usageData = JSON.parse(localStorage.getItem('analysisUsage')) || {};
  if (usageData.date !== today) {
    usageData = { date: today, count: 0, lastAnalysis: null };
  }

  if (usageData.count >= MAX_ANALYSES_PER_DAY) {
    alert('Voc√™ atingiu o limite de 20 an√°lises por dia. Por favor, volte amanh√£.');
    return;
  }

  if (usageData.lastAnalysis) {
    const lastAnalysisTime = new Date(usageData.lastAnalysis);
    const diffMinutes = (now - lastAnalysisTime) / (1000 * 60);
    if (diffMinutes < COOLDOWN_MINUTES) {
      const remainingTime = Math.ceil(COOLDOWN_MINUTES - diffMinutes);
      alert(`Por favor, aguarde ${remainingTime} minuto(s) antes de gerar uma nova an√°lise.`);
      return;
    }
  }

  const casa = getSelectedValue('casas-group');
  const liga = getSelectedValue('ligas-group');
  const mercadoValue = getSelectedValue('mercados-group');
  const mercadoText = getSelectedText('mercados-group');
  const martingaleCoberturas = parseInt(getSelectedValue('martingale-group') || '0', 10);
  const martingaleText = getSelectedText('martingale-group');
  const periodo = getSelectedValue('periodo-group');
  const observacao = document.getElementById('observacao').value;
  
  if (!casa || !liga || !mercadoValue || !periodo) {
    alert('Por favor, selecione Casa, Liga, Mercado e Per√≠odo de An√°lise.');
    return;
  }

  const generateBtn = document.querySelector('.btn-generate');
  const resultContainer = document.getElementById('result-container');
  const resultTitle = document.getElementById('result-title');
  const resultContent = document.getElementById('result-content');

  generateBtn.disabled = true;
  generateBtn.innerHTML = '<div class="spinner"></div> Processando...';
  resultContainer.style.display = 'block';
  resultContent.innerHTML = '';
  
  try {
    resultTitle.innerHTML = `<div class="loading"><div class="spinner"></div>Coletando ${periodo} jogos...</div>`;
    const dados = await buscarDadosAPI(casa, liga, parseInt(periodo));
    
    dados.ranking = calcularRankingTimes(dados.dadosCru.map(j => ({time_a: j[3], time_b: j[4], ft: `${j[0]} x ${j[1]}`})), mercadoValue);
    
    resultTitle.innerHTML = '<div class="loading"><div class="spinner"></div>Analisando padr√µes...</div>';
    const tiros = martingaleCoberturas + 1;
    const { resultados } = await analyzeInWorker(dados.dadosCru, {
      tiros: tiros,
      market: mercadoValue,
      combinado: true 
    });
    dados.padroesEncontrados = resultados;

    const searchedMarket = mapMercado(mercadoValue);
    const linesToSum = (casa === 'kiron') ? 30 : 20;
    const verifyLines = martingaleCoberturas + 1;
    dados.marketAnalysis = calculateMarketAnalysis(dados, searchedMarket, dados.totalJogos, linesToSum, verifyLines);
    
    resultTitle.innerHTML = '<div class="loading"><div class="spinner"></div>Gerando an√°lise...</div>';
    
    const parametros = {
      mercado: mercadoText,
      liga,
      martingale: martingaleText || 'Nenhum',
      periodo: periodo + ' jogos',
      observacao
    };
    
    const analise = gerarAnaliseLocal(dados, parametros);
    
    resultTitle.innerHTML = '‚úì An√°lise Conclu√≠da - ' + casasConfig[casa].name + ' (' + liga + ')';
    resultContent.textContent = analise;

    usageData.count++;
    usageData.lastAnalysis = now.toISOString();
    localStorage.setItem('analysisUsage', JSON.stringify(usageData));

  } catch (error) {
    console.error('Erro no processo de an√°lise:', error);
    resultTitle.innerHTML = '‚úñ Erro na An√°lise';
    resultContent.innerHTML = `<div class="error">
      <strong>Erro:</strong> ${error.message}<br><br>
      <strong>Causas poss√≠veis:</strong> Falha na conex√£o com a API de dados ou erro no processamento.
      Atualize a p√°gina e tente novamente.
    </div>`;
  } finally {
    generateBtn.disabled = false;
    generateBtn.innerHTML = 'Gerar An√°lise';
  }
}

document.addEventListener("contextmenu", function(e) {
  e.preventDefault();
});

document.addEventListener("keydown", function(e) {
  if (e.key === "F12") e.preventDefault();
  if (e.ctrlKey && e.shiftKey && e.key === "I") e.preventDefault();
  if (e.ctrlKey && e.key === "u") e.preventDefault();
  if (e.ctrlKey && e.shiftKey && e.key === "J") e.preventDefault();
  if (e.ctrlKey && e.shiftKey && e.key === "C") e.preventDefault();
  if (e.ctrlKey && e.key === "s") e.preventDefault();
  if (e.ctrlKey && e.key === "p") e.preventDefault();
});
    </script>

       <script>

      document.addEventListener("contextmenu", function(e) {
    e.preventDefault();
});


document.addEventListener("keydown", function(e) {

    if (e.key === "F12") {
        e.preventDefault();
    }
    

    if (e.ctrlKey && e.shiftKey && e.key === "I") {
        e.preventDefault();
    }
    
 
    if (e.ctrlKey && e.key === "u") {
        e.preventDefault();
    }
    

    if (e.ctrlKey && e.shiftKey && e.key === "J") {
        e.preventDefault();
    }
    

    if (e.ctrlKey && e.shiftKey && e.key === "C") {
        e.preventDefault();
    }
    

    if (e.ctrlKey && e.key === "s") {
        e.preventDefault();
    }
    

    if (e.ctrlKey && e.key === "p") {
        e.preventDefault();
    }
});


const devtools = { open: false };
const element = new Image();
Object.defineProperty(element, 'id', {
    get: function () {
        devtools.open = true;
    }
});


(function() {
    const threshold = 160;
    const checkDevTools = function() {
        if ((window.outerWidth - window.innerWidth) > threshold || 
            (window.outerHeight - window.innerHeight) > threshold) {
            devtools.open = true;
        }
    };
    
    window.addEventListener('resize', checkDevTools);
    setInterval(checkDevTools, 500);
})();


console.log('%c', element);
setInterval(function() {
    if (devtools.open) {
        document.body.innerHTML = '<h1>Acesso n√£o autorizado detectado</h1>';
        devtools.open = false;
    }
}, 1000);

// Impede sele√ß√£o de texto
document.addEventListener('selectstart', function(e) {
    e.preventDefault();
});

// Impede arrastar e soltar
document.addEventListener('dragstart', function(e) {
    e.preventDefault();
});

// Ofusca console
console.log = function() {};
console.debug = function() {};
console.info = function() {};
    </script>

<script>
  fetch('header.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header').innerHTML = data;
    });
</script>
<script src="redirecionar.js"></script>
  </body>
</html>