<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WT805FFHQ"></script>
    <title>BetStat</title>

    <meta name="description" content="Transforme suas apostas com BetStat - a √∫nica plataforma especializada em futebol virtual Betano. An√°lises precisas, estat√≠sticas confi√°veis e resultados comprovados para investimentos inteligentes." />
    <meta name="keywords" content="BetStat, apostas esportivas, futebol virtual, Betano, estat√≠sticas apostas, an√°lise apostas, investimentos esportivos" />
    <meta property="og:title" content="BetStat | Plataforma de An√°lise para Apostas Esportivas" />
    <meta property="og:description" content="Transforme suas apostas com an√°lises precisas e estat√≠sticas confi√°veis. A √∫nica plataforma especializada em futebol virtual Betano." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.betstat.site/payment.html" />
    <meta property="og:site_name" content="BetStat" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="BetStat" />
    <meta name="canonical" href="https://www.betstat.site/payment.html" />
    
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-4WT805FFHQ");
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  </head>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
  --primary-color: #1fac89;
  --primary-hover: #189976;
  --primary-dark: #01684f;
  --bg-color: #1c1f26;
  --text-color: #ffffff;
  --text-muted: #9ca3af;
  --container-bg: #2a2f3a;
  --border-color: rgba(31, 172, 137, 0.2);
  --border-muted: rgba(255, 255, 255, 0.1);
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.25);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.container { max-width:1500px; margin:0 auto; padding:3rem 2rem; }

.header { text-align:center; margin-bottom:3.5rem; animation:fadeInDown 0.6s ease-out; }

.title {
  font-size:3rem; font-weight:700;
  background:linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text; margin-bottom:0.75rem; letter-spacing:-0.5px;
}

.subtitle { font-size:1.125rem; color:var(--text-muted); font-weight:400; letter-spacing:0.3px; }

.analysis-card {
  background:var(--container-bg);
  border:1px solid var(--border-muted);
  border-radius:16px;
  padding:2.5rem;
  box-shadow:var(--shadow-lg);
  backdrop-filter:blur(10px);
  animation:fadeInUp 0.6s ease-out;
  transition:var(--transition);
}

.analysis-card:hover { border-color:var(--border-color); box-shadow:0 12px 40px rgba(0,0,0,0.3); }

.section { margin-bottom:2.5rem; }
.section:last-child { margin-bottom:0; }

.section-title {
  font-size:1.125rem; font-weight:600; color:var(--text-color);
  margin-bottom:1.25rem; letter-spacing:0.3px;
  display:flex; align-items:center; gap:0.5rem;
}

.section-title::before {
  content:''; width:4px; height:20px;
  background:linear-gradient(180deg, var(--primary-color), var(--primary-hover));
  border-radius:2px;
}

.btn-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:0.875rem; }

.btn {
  background:var(--bg-color); color:var(--text-muted);
  border:1.5px solid var(--border-muted);
  padding:0.875rem 1.25rem; border-radius:10px;
  font-size:0.9rem; font-weight:500; cursor:pointer;
  transition:var(--transition); text-align:center; font-family:inherit;
  position:relative; overflow:hidden;
}

.btn::before {
  content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
  background:linear-gradient(90deg, transparent, rgba(31,172,137,0.1), transparent);
  transition:left 0.5s ease;
}

.btn:hover::before { left:100%; }

.btn:hover {
  color:var(--text-color); border-color:var(--primary-color);
  transform:translateY(-2px); box-shadow:0 4px 12px rgba(31,172,137,0.2);
}

.btn.active {
  background:linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  color:var(--text-color); border-color:var(--primary-color);
  box-shadow:0 4px 16px rgba(31,172,137,0.3); transform:translateY(-1px);
}

.actions {
  display:flex; gap:1rem; margin-top:2.5rem;
}

.action-btn {
  flex:1; padding:1.125rem 2rem; border:none; border-radius:12px;
  font-size:1rem; font-weight:600; cursor:pointer; transition:var(--transition);
  text-transform:uppercase; letter-spacing:1px; font-family:inherit;
  position:relative; overflow:hidden;
}

.action-btn::after {
  content:''; position:absolute; top:50%; left:50%; width:0; height:0;
  border-radius:50%; background:rgba(255,255,255,0.1);
  transform:translate(-50%,-50%); transition:width 0.6s, height 0.6s;
}

.action-btn:active::after { width:300px; height:300px; }

.btn-clear {
  background:transparent; color:var(--text-muted); border:2px solid var(--border-muted);
}

.btn-clear:hover {
  background:var(--container-bg); color:var(--text-color);
  border-color:var(--text-color); transform:translateY(-2px); box-shadow:var(--shadow-sm);
}

.btn-generate {
  background:linear-gradient(135deg, var(--primary-dark), var(--primary-color));
  color:var(--text-color); cursor:pointer; box-shadow:0 4px 16px rgba(31,172,137,0.3);
}

.btn-generate:hover {
  background:linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  transform:translateY(-2px); box-shadow:0 6px 24px rgba(31,172,137,0.4);
}

.btn-generate:disabled { opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }

.result-container {
  margin-top:2.5rem; background:var(--container-bg);
  border:1px solid var(--border-color); border-radius:16px;
  padding:2.5rem; display:none; animation:fadeInUp 0.6s ease-out;
  box-shadow:var(--shadow-lg);
}

.result-title {
  font-size:1.5rem; font-weight:700;
  background:linear-gradient(135deg, var(--primary-color), var(--primary-hover));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text; margin-bottom:1.75rem;
  display:flex; align-items:center; gap:0.875rem; letter-spacing:-0.3px;
}

.result-content {
  color:var(--text-color); line-height:1.8; white-space:pre-wrap; font-size:1rem;
}

.loading { display:flex; align-items:center; gap:0.875rem; color:var(--primary-color); font-weight:500; }

.spinner {
  width:24px; height:24px;
  border:3px solid rgba(31,172,137,0.2); border-top:3px solid var(--primary-color);
  border-radius:50%; animation:spin 0.8s linear infinite;
}

.error {
  background:rgba(239,68,68,0.1); border:1.5px solid rgba(239,68,68,0.4);
  color:#ef4444; padding:1.5rem; border-radius:12px;
  margin-top:1.25rem; font-weight:500; animation:shake 0.5s ease-in-out;
}

@keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
@keyframes fadeInDown { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }
@keyframes fadeInUp   { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
@keyframes shake {
  0%,100% { transform:translateX(0); }
  25%     { transform:translateX(-10px); }
  75%     { transform:translateX(10px);  }
}

@media (max-width: 768px) {
  .container { padding:1.5rem 1rem; }
  .title { font-size:2.25rem; }
  .analysis-card { padding:1.75rem; border-radius:12px; }
  .actions { flex-direction:column; }
  .btn-grid { grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:0.75rem; }
  .result-container { padding:1.75rem; }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition-duration:0.01ms !important; }
}
</style>

  <body>
      <div id="header"></div>

      <br><br>

    <div class="container">
      <div class="analysis-card">

        <div class="section">
          <h2 class="section-title">Casa de Aposta</h2>
          <div class="btn-grid" id="casas-group">
            <button class="btn" data-value="betano">Betano</button>
            <button class="btn" data-value="kiron">Kiron</button>
            <button class="btn" data-value="estrela">Estrelabet</button>
            <button class="btn" data-value="bet365">Bet365</button>
          </div>
        </div>

        <div class="section" id="liga-section" style="display: none;">
          <h2 class="section-title">Liga</h2>
          <div class="btn-grid" id="ligas-group"></div>
        </div>

        <div class="section">
          <h2 class="section-title">Mercado da An√°lise</h2>
          <div class="btn-grid" id="mercados-group">
            <button class="btn" data-value="casaVence">Casa Vence</button>
            <button class="btn" data-value="foraVence">Fora Vence</button>
            <button class="btn" data-value="empate">Empate</button>
            <button class="btn" data-value="over1.5">Over 1.5</button>
            <button class="btn" data-value="over2.5">Over 2.5</button>
            <button class="btn" data-value="over3.5">Over 3.5</button>
            <button class="btn" data-value="under1.5">Under 1.5</button>
            <button class="btn" data-value="under2.5">Under 2.5</button>
            <button class="btn" data-value="under3.5">Under 3.5</button>
            <button class="btn" data-value="ambasMarcam">Ambas Sim</button>
            <button class="btn" data-value="ambasNaoMarcam">Ambas N√£o</button>
            <button class="btn" data-value="over5">5+ Gols</button>
            <button class="btn" data-value="exact1">1 Gol Exato</button>
            <button class="btn" data-value="exact2">2 Gols Exatos</button>
            <button class="btn" data-value="exact3">3 Gols Exatos</button>
            <button class="btn" data-value="exact4">4 Gols Exatos</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Estrat√©gia Martingale</h2>
          <div class="btn-grid" id="martingale-group">
            <button class="btn" data-value="0">Nenhum</button>
            <button class="btn" data-value="1">1 Cobertura</button>
            <button class="btn" data-value="2">2 Coberturas</button>
            <button class="btn" data-value="3">3 Coberturas</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Per√≠odo de An√°lise</h2>
          <div class="btn-grid" id="periodo-group">
            <button class="btn" data-value="120">6 Horas</button>
            <button class="btn" data-value="240">12 Horas</button>
            <button class="btn" data-value="480">24 Horas</button>
            <button class="btn" data-value="960">48 Horas</button>
            <button class="btn" data-value="1440">72 Horas</button>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">Observa√ß√µes Adicionais</h2>
          <textarea class="textarea" id="observacao" placeholder="Ex: Priorizar determinados hor√°rios, evitar confrontos diretos entre times fortes, etc..." rows="4"></textarea>
        </div>

        <div class="actions">
          <button class="action-btn btn-clear" onclick="limparAnalise()">Nova An√°lise</button>
          <button class="action-btn btn-generate" onclick="gerarAnalise()">Gerar Relat√≥rio</button>
        </div>

        <div class="result-container" id="result-container">
          <h3 class="result-title" id="result-title">
            <div class="success-indicator"></div>
            Relat√≥rio Conclu√≠do
          </h3>
          <div class="result-content" id="result-content"></div>
        </div>

      </div>
    </div>

    <script>
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   CONFIGURA√á√ÉO DAS CASAS E LIGAS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const casasConfig = {
  'betano': {
    name: 'Betano',
    ligas: [
      { name: 'Cl√°ssicos da Am√©rica', value: 'Ta√ßa Gl√≥ria Eterna' }, 
      'Copa Am√©rica', 
      'Euro', 
      'Campeonato Italiano', 
      'Copa das Estrelas', 
      'Brasileir√£o Betano'
    ]
  },
  'kiron': { 
    name: 'Kiron', 
    ligas: ['England', 'Italy', 'Spain'], 
    path: 'kiron' 
  },
  'estrela': { 
    name: 'Estrelabet', 
    ligas: ['Copa do Mundo', 'Ligas dos Campe√µes', 'Am√©rica Latina'], 
    path: 'estrela' 
  },
  'bet365': { 
    name: 'Bet365', 
    ligas: ['Copa', 'Euro', 'Super', 'Premier'], 
    path: 'bet365' 
  }
};

document.querySelectorAll('.btn-grid').forEach(group => {
  group.addEventListener('click', event => {
    if (event.target.classList.contains('btn')) {
      const currentActive = group.querySelector('.btn.active');
      if (currentActive) currentActive.classList.remove('active');
      event.target.classList.add('active');
  
      if (group.id === 'casas-group') {
        mostrarLigas(event.target.dataset.value);
      }
    }
  });
});

function mostrarLigas(casa) {
  const ligaSection = document.getElementById('liga-section');
  const ligasGroup = document.getElementById('ligas-group');

  if (!casasConfig[casa]) {
    ligaSection.style.display = 'none';
    return;
  }
  
  ligasGroup.innerHTML = '';
  
  casasConfig[casa].ligas.forEach(ligaItem => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    
    if (typeof ligaItem === 'object') {
        btn.dataset.value = ligaItem.value;
        btn.textContent = ligaItem.name;
    } else {
        btn.dataset.value = ligaItem;
        btn.textContent = ligaItem;
    }
    
    ligasGroup.appendChild(btn);
  });

  ligaSection.style.display = 'block';
}

function getSelectedValue(groupId) {
  const group = document.getElementById(groupId);
  const active = group?.querySelector('.btn.active');
  return active ? active.dataset.value : null;
}

function getSelectedText(groupId) {
  const group = document.getElementById(groupId);
  const active = group?.querySelector('.btn.active');
  return active ? active.innerText : null;
}

function limparAnalise() {
  document.querySelectorAll('.btn.active').forEach(btn => btn.classList.remove('active'));
  document.getElementById('observacao').value = '';
  document.getElementById('result-container').style.display = 'none';
  document.getElementById('liga-section').style.display = 'none';
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   FUN√á√ïES DE C√ÅLCULO (mantidas iguais)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function calcularRankingTimes(games, mercado) {
  const teamStats = {};
  games.forEach(game => {
    const { time_a, time_b, ft } = game;
    if (!ft || !ft.includes(' x ')) return;
    const [golsA, golsB] = ft.split(' x ').map(Number);
    const totalGols = golsA + golsB;

    [time_a, time_b].forEach(team => {
      if (!teamStats[team]) teamStats[team] = { name: team, totalGames: 0, marketCount: 0 };
    });

    teamStats[time_a].totalGames++;
    teamStats[time_b].totalGames++;

    let marketOccurred = false;
    switch (mercado) {
      case 'ambasMarcam': marketOccurred = golsA > 0 && golsB > 0; break;
      case 'ambasNaoMarcam': marketOccurred = golsA === 0 || golsB === 0; break;
      case 'empate': marketOccurred = golsA === golsB; break;
      case 'over1.5': marketOccurred = totalGols > 1; break;
      case 'under1.5': marketOccurred = totalGols < 2; break;
      case 'over2.5': marketOccurred = totalGols > 2; break;
      case 'under2.5': marketOccurred = totalGols < 3; break;
      case 'over3.5': marketOccurred = totalGols > 3; break;
      case 'under3.5': marketOccurred = totalGols < 4; break;
      case 'over5': marketOccurred = totalGols >= 5; break;
      case 'exact1': marketOccurred = totalGols === 1; break;
      case 'exact2': marketOccurred = totalGols === 2; break;
      case 'exact3': marketOccurred = totalGols === 3; break;
      case 'exact4': marketOccurred = totalGols === 4; break;
    }

    if (marketOccurred) {
      teamStats[time_a].marketCount++;
      teamStats[time_b].marketCount++;
    }
    if (mercado === 'casaVence' && golsA > golsB) teamStats[time_a].marketCount++;
    if (mercado === 'foraVence' && golsB > golsA) teamStats[time_b].marketCount++;
  });

  const statsArray = Object.values(teamStats).map(team => ({
    ...team,
    percentage: team.totalGames > 0 ? ((team.marketCount / team.totalGames) * 100).toFixed(1) : "0.0"
  }));
  statsArray.sort((a, b) => b.marketCount - a.marketCount || parseFloat(b.percentage) - parseFloat(a.percentage));
  return statsArray;
}

async function buscarDadosAPI(casa, liga, numJogos) {
  const config = casasConfig[casa];
  if (!config) throw new Error(`Casa ${casa} n√£o encontrada`);

  const dadosCompletos = { casa: config.name, liga: liga, totalJogos: 0, dadosCru: [] };
  try {
    const ligaEncoded = encodeURIComponent(liga);
    const baseUrl = 'https://betstat.site';
    let resultadosUrl, proximosUrl;
    
    if (config.path) {
      resultadosUrl = `${baseUrl}/resultados/${config.path}/${ligaEncoded}`;
      proximosUrl = `${baseUrl}/proximos/${config.path}/${ligaEncoded}`;
    } else {
      resultadosUrl = `${baseUrl}/resultados/${ligaEncoded}`;
      proximosUrl = `${baseUrl}/proximos/${ligaEncoded}`;
    }

    const [resultados, proximos] = await Promise.all([
      fetch(resultadosUrl).then(r => r.json()),
      fetch(proximosUrl).then(r => r.json())
    ]);
    const jogosRecentes = resultados.slice(-numJogos);
    
    for (const jogo of jogosRecentes) {
      const ftScore = (jogo.ft || "x").split("x").map(s => parseInt(s.trim(), 10));
      const a = ftScore[0], b = ftScore[1];
      if (Number.isFinite(a) && Number.isFinite(b)) {
        dadosCompletos.dadosCru.push([a, b, a + b, (jogo.time_a || "").trim(), (jogo.time_b || "").trim(), jogo.hora, jogo.minuto]);
      }
    }

    dadosCompletos.proximos = proximos.slice(0, 6);
    dadosCompletos.totalJogos = dadosCompletos.dadosCru.length;
    return dadosCompletos;
  } catch (error) {
    console.error('Erro ao buscar dados:', error);
    throw new Error(`Falha ao conectar com os dados: ${error.message}`);
  }
}

/* Worker de padr√µes ‚îÄ igual ao original */
const ANALYZE_WORKER_SRC = `...`;  // ‚Üê mantenha exatamente o mesmo c√≥digo do worker que estava no seu arquivo original (muito longo para repetir aqui)

let ANALYZE_WORKER = null;
function getAnalyzeWorker() {
  if (!ANALYZE_WORKER) {
    const blob = new Blob([ANALYZE_WORKER_SRC], { type: "application/javascript" });
    ANALYZE_WORKER = new Worker(URL.createObjectURL(blob));
  }
  return ANALYZE_WORKER;
}

function analyzeInWorker(dados, opts) {
  return new Promise((resolve, reject) => {
    const w = getAnalyzeWorker();
    const id = Math.random().toString(36).slice(2);
    const onMsg = ev => {
      const msg = ev.data;
      if (!msg || msg.id !== id) return;
      w.removeEventListener("message", onMsg);
      if (msg.ok) resolve(msg.result);
      else reject(msg.error || "Erro no worker");
    };
    w.addEventListener("message", onMsg);
    w.postMessage({ cmd: "analyze", id, payload: { dados, ...opts } });
  });
}

function mapMercado(mercadoValue) {
  const map = {
    'ambasMarcam': 'ambasSim',
    'ambasNaoMarcam': 'ambasNao',
    'casaVence': 'casaVence',
    'foraVence': 'foraVence',
    'empate': 'empate',
    'over1.5': 'over1.5',
    'over2.5': 'over2.5',
    'over3.5': 'over3.5',
    'under1.5': 'under1.5',
    'under2.5': 'under2.5',
    'under3.5': 'under3.5',
    'exact1': 'umGolExato',
    'exact2': 'doisGolsExatos',
    'exact3': 'tresGolsExatos',
    'exact4': 'quatroGolsExatos',
    'over5': 'cincoOuMaisGols'
  };
  return map[mercadoValue] || mercadoValue;
}

function checkMarket(market, homeGoals, awayGoals, totalGoals) {
  switch (market) {
    case 'ambasSim':      return homeGoals > 0 && awayGoals > 0 ? 1 : 0;
    case 'ambasNao':      return homeGoals === 0 || awayGoals === 0 ? 1 : 0;
    case 'casaVence':     return homeGoals > awayGoals ? 1 : 0;
    case 'foraVence':     return awayGoals > homeGoals ? 1 : 0;
    case 'empate':        return homeGoals === awayGoals ? 1 : 0;
    case 'over1.5':       return totalGoals > 1.5 ? 1 : 0;
    case 'over2.5':       return totalGoals > 2.5 ? 1 : 0;
    case 'over3.5':       return totalGoals > 3.5 ? 1 : 0;
    case 'under1.5':      return totalGoals < 1.5 ? 1 : 0;
    case 'under2.5':      return totalGoals < 2.5 ? 1 : 0;
    case 'under3.5':      return totalGoals < 3.5 ? 1 : 0;
    case 'umGolExato':    return totalGoals === 1 ? 1 : 0;
    case 'doisGolsExatos':return totalGoals === 2 ? 1 : 0;
    case 'tresGolsExatos':return totalGoals === 3 ? 1 : 0;
    case 'quatroGolsExatos':return totalGoals === 4 ? 1 : 0;
    case 'cincoOuMaisGols':return totalGoals >= 5 ? 1 : 0;
    default: return 0;
  }
}

function calculateMarketAnalysis(dados, searchedMarket, numberOfGames, linesToSum, verifyLines) {
  const combinedData = dados.dadosCru.map(item => [
    `${item[5].toString().padStart(2, '0')}:${item[6].toString().padStart(2, '0')}`,
    item[0], item[1], item[3], item[4], item[2], dados.liga.toLowerCase()
  ]).slice(-numberOfGames);

  if (combinedData.length === 0) return { currentPercentage: 0, top5: [] };

  const recentGames = combinedData.slice(-linesToSum);
  const currentMarketCount = recentGames.reduce((sum, row) => sum + checkMarket(searchedMarket, row[1], row[2], row[5]), 0);
  const currentPercentage = (currentMarketCount / linesToSum * 100).toFixed(0);

  const marketGroups = {};
  combinedData.forEach((row, i) => {
    if (i >= linesToSum - 1) {
      const sumMarket = combinedData.slice(i - linesToSum + 1, i + 1)
        .reduce((sum, r) => sum + checkMarket(searchedMarket, r[1], r[2], r[5]), 0);
      const marketPercentage = Math.round(sumMarket / linesToSum * 100);

      let result = "red", greens = 0;
      if (i + verifyLines <= combinedData.length) {
        const nextRows = combinedData.slice(i + 1, i + 1 + verifyLines);
        greens = nextRows.filter(r => checkMarket(searchedMarket, r[1], r[2], r[5]) === 1).length;
        result = greens > 0 ? "green" : "red";
      }

      const key = `${searchedMarket} ${marketPercentage}%`;
      if (!marketGroups[key]) marketGroups[key] = { occurrences: 0, greens: 0, reds: 0 };
      marketGroups[key].occurrences++;
      if (result === "green") marketGroups[key].greens++;
      else marketGroups[key].reds++;
    }
  });

  const sorted = Object.keys(marketGroups).map(k => {
    const g = marketGroups[k];
    const gp = (g.greens / g.occurrences * 100).toFixed(2);
    let analysis = '';
    const p = parseFloat(gp);
    if (p > 75) analysis = 'Alta chance';
    else if (p > 50) analysis = 'Moderada';
    else if (p > 25) analysis = 'Risco elevado';
    else analysis = 'Alta chance de falha';

    return {
      marketGroup: k,
      marketPercentage: parseFloat(k.split(' ')[1]),
      occurrences: g.occurrences,
      greens: g.greens,
      reds: g.reds,
      greenPercentage: gp,
      analysis
    };
  }).sort((a,b) => b.greenPercentage - a.greenPercentage || b.greens - a.greens).slice(0,100);

  return { currentPercentage, top5: sorted.slice(0,5) };
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   GERA RELAT√ìRIO ESTAT√çSTICO (substitui IA)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function gerarRelatorioEstatistico(dados, parametros) {
  const linhas = [];

  linhas.push("üéØ RESUMO ESTAT√çSTICO");
  linhas.push(`Casa ............ ${dados.casa}`);
  linhas.push(`Liga ............ ${dados.liga}`);
  linhas.push(`Mercado ......... ${parametros.mercado}`);
  linhas.push(`Per√≠odo ......... ${parametros.periodo}`);
  linhas.push(`Martingale ...... ${parametros.martingale}`);
  linhas.push(`Jogos analisados  ${dados.totalJogos}`);
  linhas.push("");

  linhas.push("üèÜ Ranking de Times (Top 8)");
  dados.ranking.slice(0,8).forEach(t => {
    linhas.push(`‚Ä¢ ${t.name.padEnd(18)} ${t.marketCount} / ${t.totalGames}  (${t.percentage}%)`);
  });
  linhas.push("");

  linhas.push("üî• Padr√µes mais fortes encontrados");
  if (dados.padroesEncontrados.length === 0) {
    linhas.push("‚Üí Nenhum padr√£o com ‚â• 3 ocorr√™ncias encontrado");
  } else {
    dados.padroesEncontrados.slice(0,6).forEach(p => {
      linhas.push(`‚Ä¢ ${p.padrao.padEnd(28)} ${p.percentual}%  (${p.ocorrencias}√ó)`);
    });
  }
  linhas.push("");

  linhas.push("üìà An√°lise de Gr√°fico de Mercado");
  linhas.push(`Porcentagem atual (√∫ltimas ${dados.marketAnalysis.currentPercentage}% das linhas): ${dados.marketAnalysis.currentPercentage}%`);
  linhas.push("");
  linhas.push("Melhores sequ√™ncias recentes (top 5):");
  dados.marketAnalysis.top5.forEach(item => {
    linhas.push(`‚Ä¢ ${item.marketGroup.padEnd(18)} ${item.greenPercentage}% (${item.occurrences}√ó) ‚Üí ${item.analysis}`);
  });
  linhas.push("");

  linhas.push("‚ö° Pr√≥ximos confrontos (at√© 6)");
  if (dados.proximos.length === 0) {
    linhas.push("‚Üí Nenhum jogo futuro encontrado");
  } else {
    dados.proximos.forEach(j => {
      linhas.push(`‚Ä¢ ${j.hora}:${j.minuto.padStart(2,'0')}  ${j.time_a} x ${j.time_b}`);
    });
  }
  linhas.push("");

  linhas.push("üí° Observa√ß√£o do usu√°rio:");
  linhas.push(parametros.observacao.trim() || "Nenhuma observa√ß√£o informada");
  linhas.push("");

  linhas.push("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
  linhas.push("Este √© um relat√≥rio autom√°tico baseado em estat√≠sticas hist√≥ricas.");
  linhas.push("Use como refer√™ncia complementar. N√£o h√° garantia de resultado futuro.");

  return linhas.join("\n");
}

async function gerarAnalise() {
  const MAX_ANALYSES_PER_DAY = 6;
  const COOLDOWN_MINUTES = 3;
  const now = new Date();
  const today = now.toISOString().split('T')[0];

  let usage = JSON.parse(localStorage.getItem('analysisUsage')) || {};
  if (usage.date !== today) {
    usage = { date: today, count: 0, lastAnalysis: null };
  }

  if (usage.count >= MAX_ANALYSES_PER_DAY) {
    alert('Limite de 6 an√°lises por dia atingido. Volte amanh√£.');
    return;
  }

  if (usage.lastAnalysis) {
    const diff = (now - new Date(usage.lastAnalysis)) / (1000 * 60);
    if (diff < COOLDOWN_MINUTES) {
      alert(`Aguarde ${Math.ceil(COOLDOWN_MINUTES - diff)} minuto(s) para nova an√°lise.`);
      return;
    }
  }

  const casa     = getSelectedValue('casas-group');
  const liga     = getSelectedValue('ligas-group');
  const mercado  = getSelectedValue('mercados-group');
  const mercadoTxt = getSelectedText('mercados-group');
  const martingale = parseInt(getSelectedValue('martingale-group') || '0');
  const martingaleTxt = getSelectedText('martingale-group');
  const periodo  = getSelectedValue('periodo-group');
  const obs      = document.getElementById('observacao').value.trim();

  if (!casa || !liga || !mercado || !periodo) {
    alert('Selecione Casa, Liga, Mercado e Per√≠odo.');
    return;
  }

  const btn = document.querySelector('.btn-generate');
  const resContainer = document.getElementById('result-container');
  const resTitle = document.getElementById('result-title');
  const resContent = document.getElementById('result-content');

  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> Processando...';
  resContainer.style.display = 'block';
  resContent.textContent = '';

  try {
    resTitle.innerHTML = `<div class="loading"><div class="spinner"></div>Coletando ${periodo} jogos...</div>`;
    const dados = await buscarDadosAPI(casa, liga, parseInt(periodo));

    resTitle.innerHTML = '<div class="loading"><div class="spinner"></div>Calculando ranking...</div>';
    dados.ranking = calcularRankingTimes(dados.dadosCru.map(j => ({
      time_a: j[3], time_b: j[4], ft: `${j[0]} x ${j[1]}`
    })), mercado);

    resTitle.innerHTML = '<div class="loading"><div class="spinner"></div>Buscando padr√µes...</div>';
    const tiros = martingale + 1;
    const workerResult = await analyzeInWorker(dados.dadosCru, {
      tiros, market: mercado, combinado: true
    });
    dados.padroesEncontrados = workerResult.resultados;

    const mkt = mapMercado(mercado);
    const lines = (casa === 'kiron') ? 30 : 20;
    const verify = martingale + 1;
    dados.marketAnalysis = calculateMarketAnalysis(dados, mkt, dados.totalJogos, lines, verify);

    resTitle.innerHTML = '‚úì Relat√≥rio Gerado';
    const params = {
      mercado: mercadoTxt,
      periodo: periodo + ' jogos',
      martingale: martingaleTxt || 'Nenhum',
      observacao: obs
    };

    const texto = gerarRelatorioEstatistico(dados, params);
    resContent.textContent = texto;

    // registra uso
    usage.count++;
    usage.lastAnalysis = now.toISOString();
    localStorage.setItem('analysisUsage', JSON.stringify(usage));

  } catch (err) {
    console.error(err);
    resTitle.innerHTML = '‚úñ Erro';
    resContent.innerHTML = `<div class="error">
      <strong>Erro:</strong> ${err.message}<br><br>
      Tente novamente mais tarde.
    </div>`;
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'Gerar Relat√≥rio';
  }
}

document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
  if (e.key === "F12" || (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) ||
      (e.ctrlKey && ["u","s","p"].includes(e.key))) {
    e.preventDefault();
  }
});

// ... (manter as demais prote√ß√µes anti-inspe√ß√£o que j√° existiam)

    </script>

    <script>
      fetch('header.html')
        .then(r => r.text())
        .then(html => document.getElementById('header').innerHTML = html);
    </script>
    <script src="redirecionar.js"></script>
  </body>
</html>